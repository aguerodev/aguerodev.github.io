<?xml version="1.0" encoding="UTF-8"?>
<rss  xmlns:atom="http://www.w3.org/2005/Atom" 
      xmlns:media="http://search.yahoo.com/mrss/" 
      xmlns:content="http://purl.org/rss/1.0/modules/content/" 
      xmlns:dc="http://purl.org/dc/elements/1.1/" 
      version="2.0">
<channel>
<title>Aprende Tidyverse</title>
<link>https://aprendetidyverse.com/index2.html</link>
<atom:link href="https://aprendetidyverse.com/index2.xml" rel="self" type="application/rss+xml"/>
<description></description>
<generator>quarto-1.6.42</generator>
<lastBuildDate>Tue, 04 Mar 2025 06:00:00 GMT</lastBuildDate>
<item>
  <title>Automatización de la descarga de datos de delitos en Costa Rica</title>
  <dc:creator>Carlos Agüero B</dc:creator>
  <link>https://aprendetidyverse.com/posts/003_descargar_delitos_costarica.html</link>
  <description><![CDATA[ 




<meta property="og:title" content="Automatización de la descarga de datos de delitos en Costa Rica">
<meta property="og:description" content="En este post aprenderemos cómo automatizar desde R la descarga, unificación y limpieza de datos sobre delitos en Costa Rica, obtenidos desde la plataforma del Poder Judicial.">
<meta property="og:type" content="video.other">
<meta property="og:url" content="https://aprendetidyverse.com/automatizacion-delitos">
<meta property="og:image" content="https://aprendetidyverse.com/images/oij.png">
<meta property="og:site_name" content="Aprende Tidyverse">
<meta property="og:locale" content="es_ES">
<meta property="article:published_time" content="2025-03-04T00:00:00+00:00">
<meta property="article:modified_time" content="2025-03-04T00:00:00+00:00">
<!-- Open Graph Video Preview -->
<meta property="og:video" content="https://player.vimeo.com/video/710119524?badge=0&amp;autopause=0&amp;player_id=0&amp;app_id=58479">
<meta property="og:video:secure_url" content="https://player.vimeo.com/video/710119524?badge=0&amp;autopause=0&amp;player_id=0&amp;app_id=58479">
<meta property="og:video:type" content="text/html">
<meta property="og:video:width" content="1280">
<meta property="og:video:height" content="720">
<section id="introducción-por-qué-hacer-esto" class="level2">
<h2 class="anchored" data-anchor-id="introducción-por-qué-hacer-esto">Introducción: ¿Por qué hacer esto?</h2>
<p>Todos los días escuchamos en las noticias acerca del incremento en los homicidios y la inseguridad en Costa Rica. Por un lado, se dice que la inseguridad está fatal, por otro, que <em>“es solo percepción”</em> y que <em>“se matan entre ellos”</em> (refiriéndose a los delincuentes). Entre <em>dimes y diretes</em>, creo que este extracto del libro la sociedad del cansancio representa cómo nos podemos sentir.</p>
<blockquote class="blockquote">
<p>En la era digital, el exceso de información nos satura hasta el punto de la apatía; el bombardeo constante de datos nos impide distinguir lo esencial y nos sumerge en un estado de desconfianza generalizada. - Byung-Chul Han, la sociedad del cansancio (2012).</p>
</blockquote>
<p>Veamos algunas de esas noticias:</p>
<br>
<div class="iframely-embed">
<div class="iframely-responsive" style="height: 140px; padding-bottom: 0;">
<a href="https://semanariouniversidad.com/pais/con-880-homicidios-2024-cerro-como-el-segundo-ano-mas-violento-de-la-historia/" data-iframely-url="//cdn.iframe.ly/api/iframe?card=small&amp;url=http%3A%2F%2Fsemanariouniversidad.com%2Fpais%2Fcon-880-homicidios-2024-cerro-como-el-segundo-ano-mas-violento-de-la-historia%2F&amp;key=82791205449a6b87420b0f7a75017b28"></a>
</div>
</div>
<script async="" src="//cdn.iframe.ly/embed.js" charset="utf-8"></script>
<br> <iframe style="border-radius:12px" src="https://open.spotify.com/embed/episode/08JtqQzvLNuXolKz4gm4oF?utm_source=generator" width="100%" height="152" frameborder="0" allowfullscreen="" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" loading="lazy"></iframe> <br> <br>
<div class="iframely-embed">
<div class="iframely-responsive" style="height: 140px; padding-bottom: 0;">
<a href="https://www.nacion.com/sucesos/crimenes/costa-rica-supera-100-homicidios-en-apenas-42-dias/4IYB2XIVJVHJDDLVONXBPHJR7E/story/" data-iframely-url="//cdn.iframe.ly/api/iframe?card=small&amp;url=https%3A%2F%2Fwww.nacion.com%2Fsucesos%2Fcrimenes%2Fcosta-rica-supera-100-homicidios-en-apenas-42-dias%2F4IYB2XIVJVHJDDLVONXBPHJR7E%2Fstory%2F&amp;key=82791205449a6b87420b0f7a75017b28"></a>
</div>
</div>
<script async="" src="//cdn.iframe.ly/embed.js" charset="utf-8"></script>
<p><br></p>
<p>Creo que es fundamental que, como ciudadanos, tengamos acceso a la información para que podamos comprobar de manera independiente los datos que nos bombardean desde todas partes. No me malentiendan, no se trata de negar las instituciones ni de estar en contra de la prensa, para nada, sino de poder, dentro de lo posible, acceder a las fuentes y echar un vistazo a lo que pasa en el país, incluso más como un ejercicio de empatía que de análisis de datos.</p>
<p>Con esa idea en mente, surge este mini tutorial, en el cual veremos, paso a paso, cómo utilizar R para descargar y unificar la información proporcionada por el <a href="https://pjenlinea3.poder-judicial.go.cr/estadisticasoij/">Poder Judicial</a>.</p>
</section>
<section id="automatizar-la-descarga" class="level2">
<h2 class="anchored" data-anchor-id="automatizar-la-descarga">Automatizar la descarga</h2>
<p>El primer problema aparecio al ver que la <a href="https://pjenlinea3.poder-judicial.go.cr/estadisticasoij/">plataforma del poder judicial</a> sólo permite descargar los datos de un año por consulta (o al menos a mí me da error si intento descargar varios años juntos). Hacerlo manualmente para 10 años no era mi opción preferida, así que vamos a automatizarlo.</p>
<p>Para lograr esto, vamos a utilizar los paquetes <a href="https://ashbythorpe.github.io/selenider/index.html">selenider</a> y <a href="https://rstudio.github.io/chromote/">chromote</a>, una combinación que he venido probando desde hace poco con muy buenos resultados, nos permite hacer web scraping de forma sencilla y resuelve muchos de los problemas que teníamos al trabajar con <a href="https://docs.ropensci.org/RSelenium/">RSelenium</a>.</p>
<section id="selenider-en-1-minuto" class="level3">
<h3 class="anchored" data-anchor-id="selenider-en-1-minuto">Selenider en 1 minuto:</h3>
<ol type="1">
<li>Levantas una sesión que controla el navegador por defecto, Chrome.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(selenider)</span>
<span id="cb1-2"></span>
<span id="cb1-3">session <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">selenider_session</span>(</span>
<span id="cb1-4">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"chromote"</span>,</span>
<span id="cb1-5">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">timeout =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>,</span>
<span id="cb1-6">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">options =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">chromote_options</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">headless =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>)</span>
<span id="cb1-7">)</span></code></pre></div>
</div>
<ol start="2" type="1">
<li>Abrir una url</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">open_url</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://www.r-project.org/"</span>)</span></code></pre></div>
</div>
<ol start="3" type="1">
<li>Seleccionas elementos de la web usando CSS o XPath.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># selecciona los elementos con el id css rStudioHeader</span></span>
<span id="cb3-2">header <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">s</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#rStudioHeader"</span>) </span></code></pre></div>
</div>
<ol start="3" type="1">
<li>Realizas acciones como clic, llenar información, hacer scroll, etc.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">s</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">".claseBoton"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb4-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">elem_click</span>()</span></code></pre></div>
</div>
<ol type="1">
<li><code>elem_click()</code></li>
</ol>
<p>Realiza un clic en el elemento especificado.</p>
<ol start="2" type="1">
<li><code>elem_right_click()</code></li>
</ol>
<p>Ejecuta un clic derecho sobre el elemento.</p>
<ol start="3" type="1">
<li><code>elem_double_click()</code></li>
</ol>
<p>Realiza un doble clic en el elemento.</p>
<ol start="4" type="1">
<li><code>elem_hover()</code></li>
</ol>
<p>Posiciona el cursor sobre el elemento, simulando la acción de pasar el mouse por encima.</p>
<ol start="5" type="1">
<li><code>elem_scroll_to()</code></li>
</ol>
<p>Desplaza la vista hasta el elemento indicado, lo cual es útil si el elemento no está visible antes de realizar un clic o interacción.</p>
<p>Veamos cómo es el proceso manual para identificar qué es lo que debemos automatizar:</p>
<ol type="1">
<li>Indicar las fechas de inicio y fin.</li>
</ol>
<p><img src="https://aprendetidyverse.com/posts/images/fechas_oij.png" class="img-fluid" style="width:50.0%"></p>
<ol start="2" type="1">
<li>Indicar el lugar del suceso.</li>
</ol>
<p><img src="https://aprendetidyverse.com/posts/images/lugar_suceso.png" class="img-fluid" style="width:50.0%"></p>
<ol start="3" type="1">
<li>Seleccionar la categoría delictiva.</li>
</ol>
<p><img src="https://aprendetidyverse.com/posts/images/categoria_delictiva.png" class="img-fluid" style="width:50.0%"></p>
<ol start="4" type="1">
<li>Indicar si se trata de víctima policial.</li>
</ol>
<p><img src="https://aprendetidyverse.com/posts/images/victima_policial.png" class="img-fluid" style="width:50.0%"></p>
<ol start="5" type="1">
<li>Hacer clic en el botón de descargar Excel.</li>
</ol>
<p><img src="https://aprendetidyverse.com/posts/images/guardar_excel.png" class="img-fluid" style="width:50.0%"></p>
<blockquote class="blockquote">
<p>Acá me quedé pegado en un buen rato intentando como explicar el código, y llegué a la conclusión de que lo más razonable es un video corto.</p>
</blockquote>
<hr>
<div style="padding:56.25% 0 0 0;position:relative;">
<iframe src="https://player.vimeo.com/video/1063262719?badge=0&amp;autopause=0&amp;player_id=0&amp;app_id=58479" frameborder="0" allow="autoplay; fullscreen; picture-in-picture; clipboard-write; encrypted-media" style="position:absolute;top:0;left:0;width:100%;height:100%;" title="GMT20250306-153558_Recording_1920x1080">
</iframe>
</div>
<script src="https://player.vimeo.com/api/player.js"></script>
<hr>
<div class="cell">
<details class="code-fold">
<summary>Puedes ver el código completo acá.</summary>
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(rvest)</span>
<span id="cb5-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(selenider)</span>
<span id="cb5-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(lubridate)</span>
<span id="cb5-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(fs)</span>
<span id="cb5-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(purrr)</span>
<span id="cb5-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(janitor)</span>
<span id="cb5-7"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(glue)</span>
<span id="cb5-8"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(chromote)</span>
<span id="cb5-9"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(dplyr)</span>
<span id="cb5-10"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(readr)</span>
<span id="cb5-11"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(stringr)</span>
<span id="cb5-12"></span>
<span id="cb5-13">wait_for_download <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span>(download_dir, filename, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">timeout =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">60</span>) {</span>
<span id="cb5-14">  start_time <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">Sys.time</span>()</span>
<span id="cb5-15">  file_path <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">file.path</span>(download_dir, filename)</span>
<span id="cb5-16">  <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">while</span> (</span>
<span id="cb5-17">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.numeric</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">difftime</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">Sys.time</span>(), start_time, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">units =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"secs"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;=</span> timeout</span>
<span id="cb5-18">  ) {</span>
<span id="cb5-19">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> (</span>
<span id="cb5-20">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">file.exists</span>(file_path) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;&amp;</span></span>
<span id="cb5-21">        <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list.files</span>(download_dir, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pattern =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">.crdownload$"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span></span>
<span id="cb5-22">    ) {</span>
<span id="cb5-23">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(<span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span>
<span id="cb5-24">    }</span>
<span id="cb5-25">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">Sys.sleep</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb5-26">  }</span>
<span id="cb5-27">  cli<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cli_abort</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Se acabó el tiempo de espera"</span>)</span>
<span id="cb5-28">}</span>
<span id="cb5-29"></span>
<span id="cb5-30">download_dataset_pj <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span>(</span>
<span id="cb5-31">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">date =</span> lubridate<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">today</span>(),</span>
<span id="cb5-32">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">download_dir =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data"</span>,</span>
<span id="cb5-33">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">filename =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Estadisticas.xls"</span></span>
<span id="cb5-34">) {</span>
<span id="cb5-35">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dir.create</span>(download_dir, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">showWarnings =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">recursive =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span>
<span id="cb5-36">  full_path <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">file.path</span>(download_dir, filename)</span>
<span id="cb5-37"></span>
<span id="cb5-38">  session <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">selenider_session</span>(</span>
<span id="cb5-39">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"chromote"</span>,</span>
<span id="cb5-40">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">timeout =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>,</span>
<span id="cb5-41">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">options =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">chromote_options</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">headless =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span>
<span id="cb5-42">  )</span>
<span id="cb5-43">  session<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>driver<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Browser<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">setDownloadBehavior</span>(</span>
<span id="cb5-44">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">behavior =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"allow"</span>,</span>
<span id="cb5-45">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">downloadPath =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">normalizePath</span>(download_dir)</span>
<span id="cb5-46">  )</span>
<span id="cb5-47"></span>
<span id="cb5-48">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">open_url</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://pjenlinea3.poder-judicial.go.cr/estadisticasoij/"</span>)</span>
<span id="cb5-49"></span>
<span id="cb5-50">  start_date <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">format</span>(date, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"%d/%m/%Y"</span>)</span>
<span id="cb5-51">  end_date <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">update</span>(date, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">month =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">day =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">31</span>)</span>
<span id="cb5-52">  end_date <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">if_else</span>(end_date <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">today</span>(), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">today</span>(), end_date)</span>
<span id="cb5-53">  end_date <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">format</span>(end_date, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"%d/%m/%Y"</span>)</span>
<span id="cb5-54"></span>
<span id="cb5-55">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">execute_js_expr</span>(</span>
<span id="cb5-56">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"document.getElementById('txtFechaFinal').removeAttribute('readonly',0);"</span></span>
<span id="cb5-57">  )</span>
<span id="cb5-58">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">execute_js_expr</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">glue</span>(</span>
<span id="cb5-59">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"document.getElementById('txtFechaFinal').value = '{end_date}';"</span>,</span>
<span id="cb5-60">  ))</span>
<span id="cb5-61"></span>
<span id="cb5-62">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">execute_js_expr</span>(</span>
<span id="cb5-63">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"document.getElementById('txtFechaInicio').removeAttribute('readonly',0);"</span></span>
<span id="cb5-64">  )</span>
<span id="cb5-65">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">execute_js_expr</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">glue</span>(</span>
<span id="cb5-66">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"document.getElementById('txtFechaInicio').value = '{start_date}';"</span>,</span>
<span id="cb5-67">  ))</span>
<span id="cb5-68"></span>
<span id="cb5-69">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">execute_js_expr</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"document.getElementById('chbTodoPais').click();"</span>)</span>
<span id="cb5-70">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">execute_js_expr</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"document.getElementById('chbTodoDelitos').click();"</span>)</span>
<span id="cb5-71">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">execute_js_expr</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"document.getElementById('chbTodaVictima').click();"</span>)</span>
<span id="cb5-72"></span>
<span id="cb5-73">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">execute_js_expr</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"document.getElementById('btnExcel').click();"</span>)</span>
<span id="cb5-74"></span>
<span id="cb5-75">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">wait_for_download</span>(download_dir, filename)</span>
<span id="cb5-76"></span>
<span id="cb5-77">  new_filename <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"delitos_"</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">format</span>(date, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"%Y-%m-%d"</span>), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">".html"</span>)</span>
<span id="cb5-78">  new_path <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">file.path</span>(download_dir, new_filename)</span>
<span id="cb5-79">  fs<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">file_move</span>(full_path, new_path)</span>
<span id="cb5-80"></span>
<span id="cb5-81">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(new_path)</span>
<span id="cb5-82">}</span>
<span id="cb5-83"></span>
<span id="cb5-84">.years <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ymd</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2025-01-01"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">years</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">11</span>)</span>
<span id="cb5-85"></span>
<span id="cb5-86">df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map</span>(</span>
<span id="cb5-87">  .years,</span>
<span id="cb5-88">  \(x) {</span>
<span id="cb5-89">    .file <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">download_dataset_pj</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">date =</span> x)</span>
<span id="cb5-90">    df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read_html</span>(.file) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb5-91">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">html_table</span>()</span>
<span id="cb5-92">    df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> df[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]]</span>
<span id="cb5-93">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(df)</span>
<span id="cb5-94">  },</span>
<span id="cb5-95">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.progress =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span></span>
<span id="cb5-96">) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb5-97">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list_rbind</span>()</span>
<span id="cb5-98"></span>
<span id="cb5-99">df <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb5-100">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">clean_names</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb5-101">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb5-102">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">across</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">where</span>(is.character), str_to_title),</span>
<span id="cb5-103">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fecha =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ymd</span>(fecha)</span>
<span id="cb5-104">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb5-105">  readr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">write_rds</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">glue</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data/delitos_{today()}.rds"</span>))</span></code></pre></div>
</details>
</div>
</section>
</section>
<section id="problemas-con-el-archivo-descargado" class="level2">
<h2 class="anchored" data-anchor-id="problemas-con-el-archivo-descargado">Problemas con el archivo descargado</h2>
<p>Despues de descargar los datos apareció un problema. al intentar abrir el archivo desde R, aparece un error, el archivo parecía corrupto o mal formateado. Raro, porque si abría el archivo directamente desde Excel, todo funcionaba bien.</p>
<p>Revisando el código fuente de la web, pude encontrar que el archivo se genera a partir de una tabla <code>HTML</code> que se codifica en <code>Base64</code>, asignándole la extensión <code>.xls</code> <em>(Excel viejito)</em> y un MIME type de Excel. Esto quiere decir que, aunque aparenta ser un archivo de Excel, el contenido real es HTML y no el formato binario nativo de Excel (xls). Excel, que siempre que puede resuelve, logra detectar el contenido y mostrar la tabla sin problema, pero el paquete <code>readxl</code>, que utiliza la librería <code>libxls</code>, necesita el formato binario de Excel para poder funcionar. Por eso, al intentar abrirlo en R se produce el error <em>libxls error: Unable to open file</em>, porque, <strong>sorpresa, ¡no es un archivo de Excel!</strong></p>
<p>La solución fue sencilla, si es un archivo <code>HTML</code>, basta con cambiarle la extensión de <code>.xls</code> a <code>.html</code> y usar la función <code>read_html</code> del paquete <code>rvest</code>. Una vez resuelto eso, queda completamente automatizada la descarga de 10 años de registros en un clic.</p>
</section>
<section id="limpieza-y-normalización-de-los-datos" class="level2">
<h2 class="anchored" data-anchor-id="limpieza-y-normalización-de-los-datos">Limpieza y normalización de los datos</h2>
<p>A partir de aquí, el trabajo de limpieza es muy corto. Se normalizan los nombres de las columnas y se ajustan las variables de tipo texto para evitar tener todo en mayúsculas.</p>
<p>Aquí, alguien podría preguntarse: <em>¿por qué, entonces, no descargar directamente el archivo <code>.csv</code> en lugar del excel?</em> Pasa que, por algún motivo, al archivo <code>CSV</code> le falta la columna <code>distrito</code>. Asumo que está relacionado con la forma en que se genera a partir de la tabla HTML original, pero, la verdad, no lo investigué.</p>
<p>Puedes descargar los datos en el siguiente enlace <a href="../data/delitos_2025-03-03.zip">descargar datos</a></p>
</section>
<section id="y-ahora-qué" class="level2">
<h2 class="anchored" data-anchor-id="y-ahora-qué">¿Y ahora qué?</h2>
<p>Esta es la primera parte del trabajo. Ahora que tenemos los datos, estamos listos para realizar un análisis. En el siguiente post hablaremos sobre el tema de los homicidios en Costa Rica.</p>
<p>Finalmente, un reconocimiento especial al Poder Judicial por el esfuerzo y la transparencia de poner estos datos a disposición de todos.</p>


</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Cómo citar</h2><div><div class="quarto-appendix-secondary-label">BibTeX</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{agüero_b2025,
  author = {Agüero B, Carlos},
  title = {Automatización de la descarga de datos de delitos en Costa
    Rica},
  date = {2025-03-04},
  url = {https://aprendetidyverse.com/posts/003_descargar_delitos_costarica.html},
  langid = {es}
}
</code></pre><div class="quarto-appendix-secondary-label">Por favor, cita este trabajo como:</div><div id="ref-agüero_b2025" class="csl-entry quarto-appendix-citeas">
Agüero B, Carlos. 2025. <span>“Automatización de la descarga de datos de
delitos en Costa Rica.”</span> March 4, 2025. <a href="https://aprendetidyverse.com/posts/003_descargar_delitos_costarica.html">https://aprendetidyverse.com/posts/003_descargar_delitos_costarica.html</a>.
</div></div></section></div> ]]></description>
  <category>webscraping</category>
  <category>selenider</category>
  <guid>https://aprendetidyverse.com/posts/003_descargar_delitos_costarica.html</guid>
  <pubDate>Tue, 04 Mar 2025 06:00:00 GMT</pubDate>
  <media:content url="https://aprendetidyverse.com/posts/images/oij.png" medium="image" type="image/png" height="73" width="144"/>
</item>
<item>
  <title>Cómo crear leyendas personalizadas en tus gráficos utilizando ggplot2</title>
  <dc:creator>Carlos Aguero B</dc:creator>
  <link>https://aprendetidyverse.com/posts/002_custom_legend_ggplot2.html</link>
  <description><![CDATA[ 




<p>Cada tanto, cuando tengo tiempo libre, me siento a revisar artículos y noticias. En Twitter, me topé con el siguiente artículo del Wall Street Journal, titulado <strong>‘The Rough Years That Turned Gen Z Into America’s Most Disillusioned Voters’</strong><sup>1</sup>. Este habla sobre cómo lo que se puede entender como generación Z tiene menores expectativas de tener una carrera, entre otras cuestiones. Pero lo que me llamó la atención inmediatamente fue este gráfico tan curioso.</p>
<div id="fig-original" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-original-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="https://aprendetidyverse.com/posts/images/ejemplo_twsj.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-original-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;1: Imagen publicada por <a href="https://www.wsj.com/politics/elections/gen-z-voters-election-tiktok-5bcdc524">The Wall Street Journal</a>
</figcaption>
</figure>
</div>
<p>Resulta que justo en las últimas semanas, el blog de <a href="https://www.tidyverse.org">tidyverse.org</a> publicaba algunas de las <a href="https://www.tidyverse.org/blog/2024/02/ggplot2-3-5-0-legends/">novedades de ggplot2 3.5</a>, entre las que se encuentran el poder agregar leyendas personalizadas utilizando el paquete grid. Ahora, entonces, me entra la duda de si es posible recrear este gráfico usando código de R, vamos a intentarlo.</p>
<p>Este no es un tutorial; el objetivo no es que entiendas cómo funciona todo, ya que el código es algo largo, sino que lo tengas como referencia y exploremos juntos las capacidades del paquete.</p>
<section id="paso-1-cargar-las-dependencias" class="level2">
<h2 class="anchored" data-anchor-id="paso-1-cargar-las-dependencias">Paso 1 : Cargar las dependencias</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(tidyverse)</span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(ggplot2)</span>
<span id="cb1-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(grid)</span>
<span id="cb1-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(ggh4x)</span>
<span id="cb1-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(ggrepel)</span>
<span id="cb1-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(colorspace)</span></code></pre></div>
</div>
</section>
<section id="paso-2-crear-la-primer-leyenda" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="paso-2-crear-la-primer-leyenda">Paso 2: Crear la primer leyenda</h2>
<p>El paquete grid nos permite crear gráficos, pero a diferencia de ggplot2, grid nos provee de funciones más de bajo nivel, como dibujar un círculo, una línea, un rectángulo, lo cual nos da mucha libertad para componer estos elementos de la forma en que queramos.</p>

<div class="no-row-height column-margin column-container"><div class="">
<p>Una de las mejores lecturas para comprender el funcionamiento del paquete grid y su relación con ggplot2 es el libro <a href="https://www.stat.auckland.ac.nz/~paul/RG2e/">R Graphics, Second Edition, de Paul Murrell</a>, el autor del paquete grid.</p>
</div></div><p>Usaremos las funciones <code>circleGrob</code>, <code>segmentsGrob</code> y <code>textGrob</code> para replicar la primera leyenda, que en la Figura&nbsp;1 se encuentra a la derecha.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1">circulos <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">circleGrob</span>(</span>
<span id="cb2-2">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">r =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.07</span>,</span>
<span id="cb2-3">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.35</span>),</span>
<span id="cb2-4">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>),</span>
<span id="cb2-5">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">gp =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">gpar</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lwd =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb2-6">)</span>
<span id="cb2-7"></span>
<span id="cb2-8">lineas <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">segmentsGrob</span>(</span>
<span id="cb2-9">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x0 =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.35</span>),</span>
<span id="cb2-10">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x1 =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.35</span>),</span>
<span id="cb2-11">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y0 =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.35</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.65</span>),</span>
<span id="cb2-12">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y1 =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.42</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.58</span>),</span>
<span id="cb2-13">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">gp =</span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">gpar</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lwd =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb2-14">)</span>
<span id="cb2-15"></span>
<span id="cb2-16">texto <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">textGrob</span>(</span>
<span id="cb2-17">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Lower than start"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Higher than start"</span>),</span>
<span id="cb2-18">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.35</span>),</span>
<span id="cb2-19">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.3</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.75</span>),</span>
<span id="cb2-20">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">gp =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">gpar</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lwd =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fontsize =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>),</span>
<span id="cb2-21">  )</span>
<span id="cb2-22"></span>
<span id="cb2-23">legend1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">gTree</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">children =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">gList</span>(circulos, lineas,texto))</span>
<span id="cb2-24"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">grid.draw</span>(legend1)</span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://aprendetidyverse.com/posts/002_custom_legend_ggplot2_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid figure-img" width="1600"></p>
</figure>
</div>
</div>
</div>
<p>No está mal, se parece bastante. Ahora vamos a utilizar la función <code>guides</code> y la nueva función <code>guide_custom</code> para agregar este objeto llamado <code>legend1</code> a un gráfico de ggplot2. Además, se hacen algunos ajustes de tamaño y márgenes con la función <code>theme.</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb3-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">guides</span>(</span>
<span id="cb3-3">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">custom =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">guide_custom</span>(</span>
<span id="cb3-4">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">width =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unit</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"cm"</span>),</span>
<span id="cb3-5">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">height =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unit</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"cm"</span>),</span>
<span id="cb3-6">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">grob =</span> legend1,</span>
<span id="cb3-7">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">order =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb3-8">  )) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(</span>
<span id="cb3-9">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.position =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"top"</span>,</span>
<span id="cb3-10">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.justification =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"center"</span>,</span>
<span id="cb3-11">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.margin =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">margin</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">t =</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">b =</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>),</span>
<span id="cb3-12">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">plot.margin =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">margin</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">t =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>)</span>
<span id="cb3-13">  )</span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://aprendetidyverse.com/posts/002_custom_legend_ggplot2_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid figure-img" width="3400"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="paso-3-crear-la-segunda-leyenda" class="level2">
<h2 class="anchored" data-anchor-id="paso-3-crear-la-segunda-leyenda">Paso 3: Crear la segunda leyenda</h2>
<p>Vemos que, a diferencia de la primera leyenda, esta segunda Figura&nbsp;1, que se encuentra a la izquierda del gráfico, es un poco más compleja; tiene más formas, textos y colores. Sin embargo, aunque requiere más código, no es en sí una tarea complicada.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1">rect1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">roundrectGrob</span>(</span>
<span id="cb4-2">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">r=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unit</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"snpc"</span>),</span>
<span id="cb4-3">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.10</span>,</span>
<span id="cb4-4">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>,</span>
<span id="cb4-5">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">width =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.2</span>,</span>
<span id="cb4-6">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">height =</span>  <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.065</span>,</span>
<span id="cb4-7">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">gp =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">gpar</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lty =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#b4d6f0"</span>)</span>
<span id="cb4-8">)</span>
<span id="cb4-9"></span>
<span id="cb4-10">rect2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">roundrectGrob</span>(</span>
<span id="cb4-11">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">r =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unit</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"snpc"</span>),</span>
<span id="cb4-12">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.325</span>,</span>
<span id="cb4-13">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>,</span>
<span id="cb4-14">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">width =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.25</span>,</span>
<span id="cb4-15">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">height =</span>  <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.065</span>,</span>
<span id="cb4-16">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">gp =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">gpar</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lty =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#76bbe8"</span>)</span>
<span id="cb4-17">)</span>
<span id="cb4-18"></span>
<span id="cb4-19">rect3 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">roundrectGrob</span>(</span>
<span id="cb4-20">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">r =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unit</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"snpc"</span>),</span>
<span id="cb4-21">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.575</span>,</span>
<span id="cb4-22">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>,</span>
<span id="cb4-23">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">width =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.25</span>,</span>
<span id="cb4-24">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">height =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.065</span>,</span>
<span id="cb4-25">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">gp =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">gpar</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lty =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#2598dd"</span>)</span>
<span id="cb4-26">)</span>
<span id="cb4-27"></span>
<span id="cb4-28">rect4 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">roundrectGrob</span>(</span>
<span id="cb4-29">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">r =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unit</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"snpc"</span>),</span>
<span id="cb4-30">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.825</span>,</span>
<span id="cb4-31">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>,</span>
<span id="cb4-32">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">width =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.25</span>,</span>
<span id="cb4-33">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">height =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.065</span>,</span>
<span id="cb4-34">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">gp =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">gpar</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lty =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#673c8e"</span>)</span>
<span id="cb4-35">)</span>
<span id="cb4-36"></span>
<span id="cb4-37">point1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">circleGrob</span>(</span>
<span id="cb4-38">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">r =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.05</span>,</span>
<span id="cb4-39">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.02</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.2</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.45</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.70</span>),</span>
<span id="cb4-40">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>),</span>
<span id="cb4-41">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">gp =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">gpar</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lty =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#b2d9f9"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#559dd7"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#1d70c9"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#09217a"</span>))</span>
<span id="cb4-42">)</span>
<span id="cb4-43"></span>
<span id="cb4-44">stick1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">segmentsGrob</span>(</span>
<span id="cb4-45">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x0 =</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.02</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.2</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.45</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.70</span>),</span>
<span id="cb4-46">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x1 =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.02</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.2</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.45</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.70</span>),</span>
<span id="cb4-47">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y0 =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.65</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.42</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.65</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.42</span>),</span>
<span id="cb4-48">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y1 =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.58</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.35</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.58</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.35</span>),</span>
<span id="cb4-49">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">gp =</span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">gpar</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lwd =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span>
<span id="cb4-50">)</span>
<span id="cb4-51"></span>
<span id="cb4-52">label1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">textGrob</span>(</span>
<span id="cb4-53">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Baby</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">Boomers"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Gen X"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Milenials"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Gen Z"</span>),</span>
<span id="cb4-54">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.02</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.2</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.45</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.70</span>),</span>
<span id="cb4-55">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.3</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.75</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.3</span>),</span>
<span id="cb4-56">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">gp =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">gpar</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lwd =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fontsize =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lineheight =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7</span>))</span>
<span id="cb4-57"></span>
<span id="cb4-58">circle1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">circleGrob</span>(</span>
<span id="cb4-59">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">r =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.080</span>,</span>
<span id="cb4-60">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.02</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.2</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.45</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.70</span>),</span>
<span id="cb4-61">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>),</span>
<span id="cb4-62">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">gp =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">gpar</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lty =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>)</span>
<span id="cb4-63">)</span>
<span id="cb4-64"></span>
<span id="cb4-65">legend2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">gTree</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">children =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">gList</span>(rect1, rect2, rect3,rect4,</span>
<span id="cb4-66">                                 point1,stick1,label1,circle1))</span>
<span id="cb4-67"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">grid.draw</span>(legend2)</span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://aprendetidyverse.com/posts/002_custom_legend_ggplot2_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" width="2400"></p>
</figure>
</div>
</div>
</div>
<p>Ahora, al igual que en el paso anterior, vamos a agregarlo a un gráfico con ggplot2 para verificar cómo se ve.</p>
<div class="callout callout-style-simple callout-note">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container">
<p>Al ajustar la dimensión de los elementos, es mejor verificarla contra la versión que ya está integrada en el plot de ggplot2, porque pueden variar mucho.</p>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">guides</span>(</span>
<span id="cb5-3">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">custom =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">guide_custom</span>(</span>
<span id="cb5-4">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">width =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unit</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"cm"</span>),</span>
<span id="cb5-5">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">height =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unit</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"cm"</span>),</span>
<span id="cb5-6">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">grob =</span> legend2,</span>
<span id="cb5-7">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">order =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb5-8">  )) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(</span>
<span id="cb5-9">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.position =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"top"</span>,</span>
<span id="cb5-10">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.justification =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"center"</span>,</span>
<span id="cb5-11">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.margin =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">margin</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">t =</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">b =</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>),</span>
<span id="cb5-12">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">plot.margin =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">margin</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">t =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>)</span>
<span id="cb5-13">  )</span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://aprendetidyverse.com/posts/002_custom_legend_ggplot2_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="3400"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="paso-4-necesitamos-los-datos" class="level2">
<h2 class="anchored" data-anchor-id="paso-4-necesitamos-los-datos">Paso 4: Necesitamos los datos</h2>
<p>Llega el momento de replicar el gráfico y necesitamos datos. Para esto, después de varios intentos fallidos y un dolor de cabeza de por medio, me topé con esta herramienta: <a href="https://plotdigitizer.com">plot digitizer</a>, que nos facilita el pasar de un plot ya creado a los datos.</p>
<p>A continuación, mucho código de poco valor pero necesario para obtener los datos.</p>
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb6-1">df1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> tibble<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tribble</span>(</span>
<span id="cb6-2">                             <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>fecha,                 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>valor,</span>
<span id="cb6-3">               <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1975.99610136452</span>,    <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">30.306338028169</span>,</span>
<span id="cb6-4">               <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1976.77582846004</span>,   <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">31.4007042253521</span>,</span>
<span id="cb6-5">               <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1978.49122807018</span>,   <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">31.9478873239437</span>,</span>
<span id="cb6-6">               <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1978.72514619883</span>,   <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">33.2767605633803</span>,</span>
<span id="cb6-7">               <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1979.19298245614</span>,   <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">34.3711267605634</span>,</span>
<span id="cb6-8">                 <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1979.738791423</span>,   <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">36.0908450704225</span>,</span>
<span id="cb6-9">               <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1980.36257309942</span>,   <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">37.1070422535211</span>,</span>
<span id="cb6-10">               <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1981.37621832359</span>,   <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">36.0908450704225</span>,</span>
<span id="cb6-11">               <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1982.31189083821</span>,   <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">35.7</span>,</span>
<span id="cb6-12">               <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1983.63742690058</span>,   <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">36.4035211267606</span>,</span>
<span id="cb6-13">                <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1984.5730994152</span>,   <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">37.2633802816901</span>,</span>
<span id="cb6-14">               <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1985.27485380117</span>,   <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">38.9049295774648</span>,</span>
<span id="cb6-15">               <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1985.82066276803</span>,   <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">40.0774647887324</span>,</span>
<span id="cb6-16">                <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1986.6783625731</span>,   <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">42.7352112676056</span>,</span>
<span id="cb6-17">               <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1986.28849902534</span>,   <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">41.3281690140845</span>,</span>
<span id="cb6-18">               <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1987.30214424951</span>,   <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">44.2204225352113</span>,</span>
<span id="cb6-19">               <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1987.92592592593</span>,   <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">45.3929577464789</span>,</span>
<span id="cb6-20">               <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1989.56335282651</span>,   <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">45.9401408450704</span>,</span>
<span id="cb6-21">               <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1990.49902534113</span>,   <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">47.7380281690141</span>,</span>
<span id="cb6-22">               <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1989.95321637427</span>,    <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">46.956338028169</span>,</span>
<span id="cb6-23">                <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1991.2007797271</span>,   <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">49.3014084507042</span>,</span>
<span id="cb6-24">               <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1991.66861598441</span>,   <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">51.0211267605634</span>,</span>
<span id="cb6-25">               <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1992.05847953216</span>,   <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">51.9591549295775</span>,</span>
<span id="cb6-26">               <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1994.24171539961</span>,   <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">54.2260563380282</span>,</span>
<span id="cb6-27">               <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1994.24171539961</span>,   <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">54.2260563380282</span>,</span>
<span id="cb6-28">               <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1995.56725146199</span>,   <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">54.8514084507042</span>,</span>
<span id="cb6-29">               <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1995.56725146199</span>,   <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">54.8514084507042</span>,</span>
<span id="cb6-30">               <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1996.50292397661</span>,   <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">55.7112676056338</span>,</span>
<span id="cb6-31">               <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1997.90643274854</span>,   <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">56.2584507042254</span>,</span>
<span id="cb6-32">               <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1998.99805068226</span>,   <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">56.1</span>,</span>
<span id="cb6-33">               <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2000.40155945419</span>,   <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">55.7112676056338</span>,</span>
<span id="cb6-34">               <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2000.40155945419</span>,   <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">55.7112676056338</span>,</span>
<span id="cb6-35">               <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2001.57115009747</span>,   <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">56.6492957746479</span>,</span>
<span id="cb6-36">               <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2003.05263157895</span>,   <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">56.3366197183098</span>,</span>
<span id="cb6-37">               <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2004.06627680312</span>,   <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">55.9457746478873</span>,</span>
<span id="cb6-38">               <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2004.06627680312</span>,   <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">55.9457746478873</span>,</span>
<span id="cb6-39">                <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2005.3918128655</span>,   <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">56.8056338028169</span>,</span>
<span id="cb6-40">               <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2006.48343079922</span>,   <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">56.0239436619718</span>,</span>
<span id="cb6-41">               <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2006.48343079922</span>,   <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">56.0239436619718</span>,</span>
<span id="cb6-42">               <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2007.34113060429</span>,   <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">57.1964788732394</span>,</span>
<span id="cb6-43">               <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2008.19883040936</span>,    <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">58.369014084507</span>,</span>
<span id="cb6-44">               <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2009.21247563353</span>,   <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">58.9943661971831</span>,</span>
<span id="cb6-45">               <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2010.77192982456</span>,   <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">59.0725352112676</span>,</span>
<span id="cb6-46">               <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2011.86354775828</span>,   <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">58.1345070422535</span>,</span>
<span id="cb6-47">               <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2012.56530214425</span>,   <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">56.9</span>,</span>
<span id="cb6-48">               <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2013.34502923977</span>,   <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">56.4147887323944</span>,</span>
<span id="cb6-49">               <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2013.34502923977</span>,   <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">56.4147887323944</span>,</span>
<span id="cb6-50">               <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2014.82651072125</span>,    <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">57.430985915493</span>,</span>
<span id="cb6-51">               <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2016.85380116959</span>,   <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">56.8056338028169</span>,</span>
<span id="cb6-52">               <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2016.85380116959</span>,   <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">56.8056338028169</span>,</span>
<span id="cb6-53">               <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2018.02339181287</span>,   <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">55.5549295774648</span>,</span>
<span id="cb6-54">               <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2018.49122807018</span>,   <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">54.3042253521127</span>,</span>
<span id="cb6-55">               <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2018.80311890838</span>,   <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">53.1316901408451</span>,</span>
<span id="cb6-56">               <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2018.80311890838</span>,   <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">53.1316901408451</span>,</span>
<span id="cb6-57">               <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2019.19298245614</span>,    <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">52.506338028169</span>,</span>
<span id="cb6-58">               <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2019.19298245614</span>,    <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">52.506338028169</span>,</span>
<span id="cb6-59">               <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2020.28460038986</span>,    <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">51.880985915493</span>,</span>
<span id="cb6-60">               <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2020.28460038986</span>,    <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">51.880985915493</span>,</span>
<span id="cb6-61">               <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2020.75243664717</span>,   <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">50.3957746478873</span>,</span>
<span id="cb6-62">               <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2020.75243664717</span>,   <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">50.3957746478873</span>,</span>
<span id="cb6-63">               <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2020.90838206628</span>,   <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">49.2232394366197</span>,</span>
<span id="cb6-64">               <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2020.90838206628</span>,   <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">49.2232394366197</span>,</span>
<span id="cb6-65">               <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2021.06432748538</span>,   <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">48.1288732394366</span>,</span>
<span id="cb6-66">               <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2021.06432748538</span>,   <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">48.1288732394366</span>,</span>
<span id="cb6-67">               <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2022</span>,   <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">46.8</span></span>
<span id="cb6-68">             )<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb6-69">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb6-70">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fecha =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(fecha),</span>
<span id="cb6-71">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fecha =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ymd</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(fecha,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"-01-01"</span>))</span>
<span id="cb6-72">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb6-73">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summarise</span>(</span>
<span id="cb6-74">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">valor =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(valor),<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>),</span>
<span id="cb6-75">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.by =</span> fecha</span>
<span id="cb6-76">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb6-77">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb6-78">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pregunta =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Expect graduate or</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">professional degree"</span></span>
<span id="cb6-79">  )</span></code></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1">df2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> tibble<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tribble</span>(</span>
<span id="cb7-2">                            <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>fecha,                 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>valor,</span>
<span id="cb7-3">              <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1976.40358744395</span>,   <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">48.1413978494624</span>,</span>
<span id="cb7-4">              <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1976.83408071749</span>,   <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">49.2682795698925</span>,</span>
<span id="cb7-5">              <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1977.55156950673</span>,   <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">50.1134408602151</span>,</span>
<span id="cb7-6">              <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1978.62780269058</span>,   <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">50.6064516129032</span>,</span>
<span id="cb7-7">              <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1979.20179372197</span>,   <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">51.5924731182796</span>,</span>
<span id="cb7-8">              <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1979.34529147982</span>,   <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">52.5784946236559</span>,</span>
<span id="cb7-9">              <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1979.63228699552</span>,   <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">53.6349462365591</span>,</span>
<span id="cb7-10">              <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1979.99103139013</span>,    <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">54.902688172043</span>,</span>
<span id="cb7-11">              <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1980.42152466368</span>,   <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">55.8887096774194</span>,</span>
<span id="cb7-12">              <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1981.13901345291</span>,   <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">55.9591397849462</span>,</span>
<span id="cb7-13">              <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1982</span>,   <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">56.1</span>,</span>
<span id="cb7-14">               <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1983.5067264574</span>,   <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">54.1279569892473</span>,</span>
<span id="cb7-15">               <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1984.7264573991</span>,   <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">53.9870967741935</span>,</span>
<span id="cb7-16">              <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1985.30044843049</span>,    <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">54.902688172043</span>,</span>
<span id="cb7-17">              <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1985.87443946188</span>,   <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">56.1704301075269</span>,</span>
<span id="cb7-18">              <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1986.59192825112</span>,    <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">57.297311827957</span>,</span>
<span id="cb7-19">              <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1986.87892376682</span>,   <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">58.2129032258065</span>,</span>
<span id="cb7-20">               <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1987.7399103139</span>,    <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">59.058064516129</span>,</span>
<span id="cb7-21">              <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1988.60089686099</span>,   <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">59.9736559139785</span>,</span>
<span id="cb7-22">              <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1989.31838565022</span>,   <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">60.3962365591398</span>,</span>
<span id="cb7-23">              <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1989.82062780269</span>,   <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">61.7344086021505</span>,</span>
<span id="cb7-24">              <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1990.25112107623</span>,   <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">62.9317204301075</span>,</span>
<span id="cb7-25">              <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1991.54260089686</span>,   <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">63.4247311827957</span>,</span>
<span id="cb7-26">              <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1992.04484304933</span>,   <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">64.9741935483871</span>,</span>
<span id="cb7-27">              <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1992.83408071749</span>,   <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">65.8193548387097</span>,</span>
<span id="cb7-28">              <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1993.98206278027</span>,   <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">66.1010752688172</span>,</span>
<span id="cb7-29">              <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1995.56053811659</span>,    <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">66.241935483871</span>,</span>
<span id="cb7-30">              <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1996.42152466368</span>,   <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">67.2983870967742</span>,</span>
<span id="cb7-31">              <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1997.13901345291</span>,   <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">67.8618279569892</span>,</span>
<span id="cb7-32">              <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1998</span>            ,   <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">69.2</span>,</span>
<span id="cb7-33">              <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1999.79372197309</span>,    <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">69.763440860215</span>,</span>
<span id="cb7-34">              <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2000.22421524664</span>,   <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">70.7494623655914</span>,</span>
<span id="cb7-35">              <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2001.51569506726</span>,   <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">70.4677419354839</span>,</span>
<span id="cb7-36">              <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2002.66367713004</span>,    <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">69.833870967742</span>,</span>
<span id="cb7-37">              <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2003.38116591928</span>,    <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">68.636559139785</span>,</span>
<span id="cb7-38">              <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2004.74439461883</span>,   <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">68.7069892473118</span>,</span>
<span id="cb7-39">              <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2005.39013452915</span>,    <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">69.763440860215</span>,</span>
<span id="cb7-40">              <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2006.32286995516</span>,   <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">68.7774193548387</span>,</span>
<span id="cb7-41">              <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2007.61434977578</span>,   <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">68.9182795698925</span>,</span>
<span id="cb7-42">               <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2008.2600896861</span>,   <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">68.1435483870968</span>,</span>
<span id="cb7-43">              <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2009.19282511211</span>,   <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">68.7774193548387</span>,</span>
<span id="cb7-44">              <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2010.48430493274</span>,   <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">68.3548387096774</span>,</span>
<span id="cb7-45">              <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2011</span>,   <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">68.4252688172043</span>,</span>
<span id="cb7-46">              <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2012.</span>           ,   <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">61.1</span>,</span>
<span id="cb7-47">              <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2013.42600896861</span>,   <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">64.4532258064516</span>,</span>
<span id="cb7-48">              <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2013.64125560538</span>,   <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">65.3263440860215</span>,</span>
<span id="cb7-49">              <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2013.78475336323</span>,   <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">64.1994623655914</span>,</span>
<span id="cb7-50">              <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2013.92825112108</span>,   <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">62.7908602150538</span>,</span>
<span id="cb7-51">              <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2014.21524663677</span>,   <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">61.3822580645161</span>,</span>
<span id="cb7-52">              <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2015.43497757848</span>,   <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">61.9456989247312</span>,</span>
<span id="cb7-53">              <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2016.86995515695</span>,    <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">62.086559139785</span>,</span>
<span id="cb7-54">              <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2018.37668161435</span>,   <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">62.2274193548387</span>,</span>
<span id="cb7-55">              <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2019.23766816144</span>,   <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">61.3822580645161</span>,</span>
<span id="cb7-56">              <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2019.81165919282</span>,    <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">60.255376344086</span>,</span>
<span id="cb7-57">              <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2020.52914798206</span>,   <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">58.6354838709677</span>,</span>
<span id="cb7-58">              <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2021.31838565022</span>,   <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">57.0155913978495</span>,</span>
<span id="cb7-59">              <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2022</span>            ,   <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">52.1</span></span>
<span id="cb7-60">            ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb7-61">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb7-62">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fecha =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(fecha),</span>
<span id="cb7-63">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fecha =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ymd</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(fecha,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"-01-01"</span>))</span>
<span id="cb7-64">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb7-65">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summarise</span>(</span>
<span id="cb7-66">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">valor =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(valor),<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>),</span>
<span id="cb7-67">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.by =</span> fecha</span>
<span id="cb7-68">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb7-69">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb7-70">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pregunta =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Expect professional job"</span></span>
<span id="cb7-71">  )</span></code></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1">df3 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> tibble<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tribble</span>(</span>
<span id="cb8-2">                         <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>fecha,                 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>valor,</span>
<span id="cb8-3">           <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1976.04830917874</span>,   <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">47.2409090909091</span>,</span>
<span id="cb8-4">           <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1977.05314009662</span>,               <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">48.4</span>,</span>
<span id="cb8-5">           <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1978.21256038647</span>,              <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">49.25</span>,</span>
<span id="cb8-6">           <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1979.75845410628</span>,   <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">49.0181818181818</span>,</span>
<span id="cb8-7">           <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1980.45410628019</span>,   <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">51.0272727272727</span>,</span>
<span id="cb8-8">           <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1981.45410628019</span>,   <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">53.0272727272727</span>,</span>
<span id="cb8-9">           <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1982</span>,   <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">53.5</span>,</span>
<span id="cb8-10">           <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1983.46859903382</span>,   <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">55.8954545454545</span>,</span>
<span id="cb8-11">           <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1984.24154589372</span>,   <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">57.1318181818182</span>,</span>
<span id="cb8-12">           <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1984.70531400966</span>,   <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">58.2909090909091</span>,</span>
<span id="cb8-13">           <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1985.71014492754</span>,   <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">58.7545454545455</span>,</span>
<span id="cb8-14">           <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1986.56038647343</span>,   <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">59.7590909090909</span>,</span>
<span id="cb8-15">           <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1987.33333333333</span>,   <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">60.9954545454545</span>,</span>
<span id="cb8-16">           <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1988.49275362319</span>,   <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">61.8454545454545</span>,</span>
<span id="cb8-17">           <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1989.42028985507</span>,   <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">62.4636363636364</span>,</span>
<span id="cb8-18">           <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1990.27053140097</span>,   <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">62.9272727272727</span>,</span>
<span id="cb8-19">           <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1991.42995169082</span>,   <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">63.6227272727273</span>,</span>
<span id="cb8-20">            <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1992.3574879227</span>,   <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">62.6181818181818</span>,</span>
<span id="cb8-21">            <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1993.2077294686</span>,   <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">61.3045454545455</span>,</span>
<span id="cb8-22">           <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1994.21256038647</span>,   <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">60.6863636363636</span>,</span>
<span id="cb8-23">           <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1995.44927536232</span>,   <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">60.3772727272727</span>,</span>
<span id="cb8-24">           <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1996.1</span>,   <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">60.6090909090909</span>,</span>
<span id="cb8-25">           <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1998</span>,   <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">62.0</span>,</span>
<span id="cb8-26">           <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1999.77777777778</span>,   <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">63.0818181818182</span>,</span>
<span id="cb8-27">           <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2000.93719806763</span>,   <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">63.6227272727273</span>,</span>
<span id="cb8-28">           <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2001.86473429952</span>,   <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">62.5409090909091</span>,</span>
<span id="cb8-29">           <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2002.86956521739</span>,   <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">61.6136363636364</span>,</span>
<span id="cb8-30">           <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2003.25603864734</span>,   <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">60.3772727272727</span>,</span>
<span id="cb8-31">           <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2003.71980676329</span>,   <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">59.1409090909091</span>,</span>
<span id="cb8-32">           <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2005.11111111111</span>,   <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">59.1409090909091</span>,</span>
<span id="cb8-33">           <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2006.27053140097</span>,   <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">59.2954545454545</span>,</span>
<span id="cb8-34">           <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2007.42995169082</span>,   <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">58.7545454545455</span>,</span>
<span id="cb8-35">           <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2008.51207729469</span>,   <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">58.1363636363636</span>,</span>
<span id="cb8-36">            <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2009</span>,   <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">57.1318181818182</span>,</span>
<span id="cb8-37">            <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">201</span>,   <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">57.1318181818182</span>,</span>
<span id="cb8-38">           <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2011.1</span>,   <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">56.6681818181818</span>,</span>
<span id="cb8-39">           <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2012</span>,   <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">59.6</span>,</span>
<span id="cb8-40">           <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2013.38164251208</span>,   <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">58.7545454545455</span>,</span>
<span id="cb8-41">           <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2013.45893719807</span>,   <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">59.6045454545455</span>,</span>
<span id="cb8-42">            <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2014.7729468599</span>,   <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">58.9863636363636</span>,</span>
<span id="cb8-43">           <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2015.54589371981</span>,   <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">57.9818181818182</span>,</span>
<span id="cb8-44">           <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2016.55072463768</span>,   <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">56.8227272727273</span>,</span>
<span id="cb8-45">           <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2017.71014492754</span>,   <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">54.8909090909091</span>,</span>
<span id="cb8-46">           <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2017.71014492754</span>,   <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">54.8909090909091</span>,</span>
<span id="cb8-47">           <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2018.48309178744</span>,   <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">53.5772727272727</span>,</span>
<span id="cb8-48">           <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2019.10144927536</span>,   <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">52.4181818181818</span>,</span>
<span id="cb8-49">           <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2019.10144927536</span>,   <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">52.4181818181818</span>,</span>
<span id="cb8-50">           <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2020.02898550725</span>,   <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">52.7272727272727</span>,</span>
<span id="cb8-51">           <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2020.02898550725</span>,   <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">52.7272727272727</span>,</span>
<span id="cb8-52">            <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2020.4154589372</span>,   <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">53.8863636363636</span>,</span>
<span id="cb8-53">           <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2021</span>,   <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">54.6</span>,</span>
<span id="cb8-54">           <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2022</span>,   <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">54.6</span></span>
<span id="cb8-55">         )<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb8-56">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb8-57">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fecha =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(fecha),</span>
<span id="cb8-58">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fecha =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ymd</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(fecha,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"-01-01"</span>))</span>
<span id="cb8-59">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb8-60">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summarise</span>(</span>
<span id="cb8-61">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">valor =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(valor),<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>),</span>
<span id="cb8-62">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.by =</span> fecha</span>
<span id="cb8-63">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb8-64">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb8-65">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pregunta =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Expect own more</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">than parents"</span></span>
<span id="cb8-66">  )</span></code></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb9-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(tidyverse)</span>
<span id="cb9-2"></span>
<span id="cb9-3">df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">bind_rows</span>(df1, df2, df3) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb9-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb9-5">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">generacion =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">case_when</span>(</span>
<span id="cb9-6">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">between</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">year</span>(fecha),<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1976</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1981</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Baby</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">Boomers"</span>,</span>
<span id="cb9-7">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">between</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">year</span>(fecha),<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1982</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1998</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Gen X"</span>,</span>
<span id="cb9-8">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">between</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">year</span>(fecha),<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1999</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2010</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Milenials"</span>,</span>
<span id="cb9-9">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">between</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">year</span>(fecha),<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2011</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2023</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Gen Z"</span>,</span>
<span id="cb9-10">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.default =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA_character_</span></span>
<span id="cb9-11">    )</span>
<span id="cb9-12">  )</span>
<span id="cb9-13"></span>
<span id="cb9-14">df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> df <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb9-15">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb9-16">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">if_else</span>(</span>
<span id="cb9-17">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">condition =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">year</span>(fecha) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1982</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1998</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2011</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2022</span>),</span>
<span id="cb9-18">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">true =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(valor,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"%"</span>),</span>
<span id="cb9-19">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">false =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span></span>
<span id="cb9-20">    ),</span>
<span id="cb9-21">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pregunta =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">fct_relevel</span>(pregunta,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Expect own more</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">than parents"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">after =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">Inf</span>)</span>
<span id="cb9-22">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb9-23">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb9-24">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">dir_label =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">if_else</span>(</span>
<span id="cb9-25">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">condition =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tail</span>(valor,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(valor,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb9-26">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">true =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"abajo"</span>,</span>
<span id="cb9-27">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">false =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"arriba"</span></span>
<span id="cb9-28">    ),</span>
<span id="cb9-29">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.by =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(pregunta, generacion)</span>
<span id="cb9-30">  ) </span></code></pre></div>
</details>
</div>
</section>
<section id="paso-5-crea-el-gráfico-final" class="level2">
<h2 class="anchored" data-anchor-id="paso-5-crea-el-gráfico-final">Paso 5: Crea el gráfico final</h2>
<p>Estuve varios días pensando en cómo explicar este código de forma sencilla y mi conclusión, en la que puedo estar equivocado perfectamente, es que si hay una explicación, sería muy larga para un post de este blog. Por lo tanto, hagamos un trato: por ahora, intenta ejecutar el código y experimenta con él. En futuras entregas, iremos agregando gráficos más simples que te ayudarán a entender lo que se necesita para generar este plot.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb10-1">format_date <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> \(x){</span>
<span id="cb10-2">  x <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">year</span>(x)</span>
<span id="cb10-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">if_else</span>(x<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%%</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb10-4">          <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"'"</span>,x<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%%</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>),</span>
<span id="cb10-5">          <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.character</span>(x))</span>
<span id="cb10-6">}</span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb11-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(</span>
<span id="cb11-2">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> df,</span>
<span id="cb11-3">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(</span>
<span id="cb11-4">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> fecha,</span>
<span id="cb11-5">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> valor,</span>
<span id="cb11-6">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> generacion,</span>
<span id="cb11-7">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> label,</span>
<span id="cb11-8">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">group =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb11-9">  )</span>
<span id="cb11-10">) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb11-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(</span>
<span id="cb11-12">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Future outcome expectations among U.S. 12th graders"</span>,</span>
<span id="cb11-13">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>,</span>
<span id="cb11-14">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span></span>
<span id="cb11-15">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb11-16">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2.5</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lineend =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"round"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb11-17">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(</span>
<span id="cb11-18">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(df, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">is.na</span>(label)),</span>
<span id="cb11-19">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(</span>
<span id="cb11-20">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">stage</span>(</span>
<span id="cb11-21">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">start =</span> generacion,</span>
<span id="cb11-22">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">after_scale =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">darken</span>(color, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.2</span>)</span>
<span id="cb11-23">        )</span>
<span id="cb11-24">    ),</span>
<span id="cb11-25">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2.5</span></span>
<span id="cb11-26">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb11-27">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(</span>
<span id="cb11-28">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(df, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">is.na</span>(label)),</span>
<span id="cb11-29">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>,</span>
<span id="cb11-30">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>,</span>
<span id="cb11-31">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">shape =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">21</span>,</span>
<span id="cb11-32">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span></span>
<span id="cb11-33">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb11-34">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_text_repel</span>(</span>
<span id="cb11-35">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">direction =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"y"</span>,</span>
<span id="cb11-36">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>,</span>
<span id="cb11-37">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nudge_y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">if_else</span>(</span>
<span id="cb11-38">      df<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>dir_label <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"arriba"</span>,</span>
<span id="cb11-39">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">true =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>,</span>
<span id="cb11-40">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">false =</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span></span>
<span id="cb11-41">    ),</span>
<span id="cb11-42">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hjust =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>,</span>
<span id="cb11-43">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fontface =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bold"</span>,</span>
<span id="cb11-44">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">4.5</span>,</span>
<span id="cb11-45">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">point.padding =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7</span></span>
<span id="cb11-46">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb11-47">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_color_manual</span>(</span>
<span id="cb11-48">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(</span>
<span id="cb11-49">      <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Baby</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">Boomers"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#b4d6f0"</span>,</span>
<span id="cb11-50">      <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Gen X"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#76bbe8"</span>,</span>
<span id="cb11-51">      <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Milenials"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#2598dd"</span>,</span>
<span id="cb11-52">      <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Gen Z"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#673c8e"</span></span>
<span id="cb11-53">    ),</span>
<span id="cb11-54">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">guide =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"none"</span></span>
<span id="cb11-55">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb11-56">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(</span>
<span id="cb11-57">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">25</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">75</span>),</span>
<span id="cb11-58">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expand_scale</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.25</span>)),</span>
<span id="cb11-59">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">labels =</span> \(x) <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(x,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"%"</span>)</span>
<span id="cb11-60">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb11-61">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_date</span>(</span>
<span id="cb11-62">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">labels =</span> format_date,</span>
<span id="cb11-63">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">minor_breaks =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ymd</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"1976-01-01"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">years</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">45</span>),</span>
<span id="cb11-64">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">guide =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"axis_minor"</span>,</span>
<span id="cb11-65">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expand_scale</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.05</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span>))</span>
<span id="cb11-66">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb11-67">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">facet_wrap</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>pregunta)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb11-68">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">guides</span>(</span>
<span id="cb11-69">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">custom2 =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">guide_custom</span>(</span>
<span id="cb11-70">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">width =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unit</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"cm"</span>),</span>
<span id="cb11-71">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">height =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unit</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"cm"</span>),</span>
<span id="cb11-72">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">grob =</span> legend1,</span>
<span id="cb11-73">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">order =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span></span>
<span id="cb11-74">    ),</span>
<span id="cb11-75">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">custom =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">guide_custom</span>(</span>
<span id="cb11-76">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">width =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unit</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"cm"</span>),</span>
<span id="cb11-77">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">height =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unit</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"cm"</span>),</span>
<span id="cb11-78">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">grob =</span> legend2,</span>
<span id="cb11-79">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">order =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb11-80">  )) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb11-81">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">base_size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb11-82">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(</span>
<span id="cb11-83">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.position =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"top"</span>,</span>
<span id="cb11-84">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.justification =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"center"</span>,</span>
<span id="cb11-85">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.margin =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">margin</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">t =</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">b =</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>),</span>
<span id="cb11-86">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">plot.margin =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">margin</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>),</span>
<span id="cb11-87">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">plot.title =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(</span>
<span id="cb11-88">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">face =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bold"</span>,</span>
<span id="cb11-89">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hjust =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.45</span>,</span>
<span id="cb11-90">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>,</span>
<span id="cb11-91">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">margin =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">margin</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">b =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">15</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">t =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>)</span>
<span id="cb11-92">      ),</span>
<span id="cb11-93">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">strip.text =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(</span>
<span id="cb11-94">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>,</span>
<span id="cb11-95">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">margin =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">margin</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">b =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">t =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">15</span>)),</span>
<span id="cb11-96">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.grid.major.x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb11-97">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.grid.minor.x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb11-98">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.grid.minor.y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb11-99">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.ticks.x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_line</span>(),</span>
<span id="cb11-100">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.ticks.length =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unit</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"pt"</span>),</span>
<span id="cb11-101">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ggh4x.axis.ticks.length.minor =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rel</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>)</span>
<span id="cb11-102">  )</span></code></pre></div>
</div>
<p><img src="https://aprendetidyverse.com/posts/plot_wsj.jpg" class="img-fluid"></p>
</section>
<section id="conclusión" class="level2">
<h2 class="anchored" data-anchor-id="conclusión">Conclusión</h2>
<p>Aunque hay diferencias notables, como el uso de las tipografías, colores y otros detalles, creo que logramos una similitud razonable. El gráfico original está hecho con la herramienta <a href="https://www.datawrapper.de">Datawrapper</a>, muy usada por periodistas y una excelente alternativa si te quieres evitar tanto código, pero… como dije al inicio de este post, solo buscamos explorar las capacidades del paquete.</p>
<hr>
<script defer="" src="https://rstudio-commentoplusplus.n5hlxm.easypanel.host/js/commento.js"></script>
<div id="commento">

</div>


</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document"><h2 class="anchored quarto-appendix-heading">Notas</h2>

<ol>
<li id="fn1"><p>Restuccia, Andrew, y Eliza Collins. 2024. “The Rough Years That Turned Gen Z Into America’s Most Disillusioned Voters.” The Wall Street Journal, March 15. https://archive.ph/0E2Bw (<a href="https://archive.ph/0E2Bw">Leer publicación</a>).↩︎</p></li>
</ol>
</section></div> ]]></description>
  <category>Guías Paso a Paso</category>
  <category>ggplot2</category>
  <guid>https://aprendetidyverse.com/posts/002_custom_legend_ggplot2.html</guid>
  <pubDate>Fri, 01 Nov 2024 06:00:00 GMT</pubDate>
  <media:content url="https://aprendetidyverse.com/posts/images/legend_example.png" medium="image" type="image/png" height="58" width="144"/>
</item>
<item>
  <title>Actualizando el mapa de cantones de Costa Rica con R</title>
  <dc:creator>Carlos Aguero</dc:creator>
  <link>https://aprendetidyverse.com/posts/001_mapa_cantones_cr.html</link>
  <description><![CDATA[ 




<p>A inicios de 2024 en Costa Rica, se realizaron elecciones municipales. Una vez publicados los resultados, tuve la idea de replicar un gráfico sencillo: un mapa con <code>ggplot2</code> de los cantones de Costa Rica, y pintar en colores el partido político que ha ganado en cada una de las regiones. Para ahorrar tiempo hago una búsqueda rápida en google <strong>“shapefile cantones Costa Rica”</strong> al descargar los datos y ejecutar mi código, resulta que me hacen falta cantones. Después de un par de segundos de duda, recordé que en los últimos años se han creado nuevos cantones. Río Cuarto<sup>1</sup> se separa del cantón de Grecia, Monteverde<sup>2</sup> de Puntarenas, y uno para mi muy sonado, ya que está muy cerca de donde vivo, Puerto Jiménez<sup>3</sup> se separa de Golfito y pasa a ser un cantón.</p>
<p>Si a esto le sumamos que algunos cantones han cambiado de nombre, Alfaro Ruiz ahora es conocido como Zarcero<sup>4</sup>, Valverde Vega se ha transformado en Sarchí<sup>5</sup>, y Aguirre ha pasado a llamarse Quepos<sup>6</sup>. En este punto, algo que creí serían 10 líneas de código, un problema de copiar y pegar, se convertía en algo más interesante. <strong>Así que en esta guia veremos cómo realizar un gráfico actualizado de los cantones de Costa Rica, utilizando como fuente de datos los servicios del <a href="https://www.snitcr.go.cr/ign_ign">Instituto Geográfico Nacional</a>.</strong></p>
<section id="obtener-datos-actualizados-del-ign" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="obtener-datos-actualizados-del-ign">Obtener datos actualizados del IGN</h2>
<section id="ante-de-comenzar" class="level3">
<h3 class="anchored" data-anchor-id="ante-de-comenzar">Ante de comenzar</h3>
<p>Verifica que tengas instalados los siguientes paquetes:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(tidyverse)</span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(sf)</span>
<span id="cb1-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(httr2)</span>
<span id="cb1-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(ows4R)</span>
<span id="cb1-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(rmapshaper)</span>
<span id="cb1-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(janitor)</span></code></pre></div>
</div>
<div class="callout callout-style-simple callout-note">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container">
<p>Si en Windows tienes errores al instalar alguno de los paquetes, quizás falte instalar Rtools. Descárgalo de este <a href="https://cran.r-project.org/bin/windows/Rtools/">enlace</a> y reinicia antes de intentar de nuevo.</p>
</div>
</div>
</div>
</section>
<section id="descargar-datos-del-ign" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="descargar-datos-del-ign">Descargar datos del IGN</h3>
<p>El <a href="https://www.snitcr.go.cr/ign_ign">Instituto Geográfico Nacional</a> es la principal fuente de cartografía en Costa Rica, ofreciendo datos geoespaciales actualizados. Para obtener un shapefile específico para nuestro mapa, recurriremos al servicio WFS en R, enfocándonos en la división cantonal.</p>
<ul>
<li><strong>Paso 1:</strong> Acceder al IGN</li>
</ul>
<p>Visita la página de <a href="https://www.snitcr.go.cr/ico_servicios_ogc">servicios OGC</a> del IGN. En la sección de nodos locales, selecciona el servicio <strong>IGN Cartografía 1:5mil CO.</strong></p>
<p><img src="https://aprendetidyverse.com/posts/images/ign_01.png" class="img-fluid" style="width:30.0%"></p>
<ul>
<li><strong>Paso 2:</strong> Identificar la URL del Servicio WFS</li>
</ul>
<p>A continuación, localizaremos la URL del servicio WFS que utilizaremos, tal como se muestra en la imagen adjunta.</p>
<p><img src="https://aprendetidyverse.com/posts/images/ign_02.png" class="img-fluid" style="width:80.0%"></p>
<ul>
<li><strong>Paso 3:</strong> Identificar las capas disponibles</li>
</ul>
<p>Mediante el uso del paquete <code>ows4R</code> en R, consultaremos los identificadores de las capas disponibles. Esto nos permitirá seleccionar y descargar la capa adecuada, ya sea a nivel de provincia, cantón o distrito.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1">url_wfs <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://geos.snitcr.go.cr/be/IGN_5_CO/wfs?"</span></span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1">bwk_client <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> WFSClient<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">new</span>(</span>
<span id="cb3-2">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">url =</span> url_wfs,</span>
<span id="cb3-3">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">serviceVersion =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2.0.0"</span></span>
<span id="cb3-4">)</span>
<span id="cb3-5"></span>
<span id="cb3-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as_tibble</span>(bwk_client<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">getFeatureTypes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pretty =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 2
  name                         title                                            
  &lt;chr&gt;                        &lt;chr&gt;                                            
1 IGN_5_CO:curvas_5000_2017    Curvas de nivel cada 10 metros 1:5.000 año 2017 …
2 IGN_5_CO:limitedistrital_5k  DTA (Límite Distrital)                           
3 IGN_5_CO:limitecantonal_5k   Límite Cantonal                                  
4 IGN_5_CO:limiteprovincial_5k Límite Provincial                                </code></pre>
</div>
</div>

<div class="no-row-height column-margin column-container"><div class="">
<p>El código para usar servicios WFS proviene del post “Spatial WFS Services” por Thierry Onkelinx, Hans Van Calster, y Floris Vanderhaeghe. <a href="https://inbo.github.io/tutorials/tutorials/spatial_wfs_services/">Leer más</a></p>
<hr>
<p>Adaptamos funciones para migrar a httr2 desde httr. Consulta <a href="https://httr2.r-lib.org/articles/httr2.html">httr2</a> para detalles.</p>
</div></div><ul>
<li><strong>Paso 4:</strong> Descargar los datos</li>
</ul>
<p>Para descargar los cantones de Costa Rica, utilizaremos la capa denominada <strong>IGN_5_CO:limitecantonal_5k</strong>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1">url <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">url_parse</span>(url_wfs)</span>
<span id="cb5-2">url<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>query <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(</span>
<span id="cb5-3">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">service =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"wfs"</span>,</span>
<span id="cb5-4">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">request =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"GetFeature"</span>,</span>
<span id="cb5-5">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">typename =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"IGN_5_CO:limitecantonal_5k"</span>,</span>
<span id="cb5-6">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">srsName =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"EPSG:4326"</span></span>
<span id="cb5-7">  )</span>
<span id="cb5-8">request <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">url_build</span>(url) </span>
<span id="cb5-9"></span>
<span id="cb5-10">regiones <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read_sf</span>(request) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb5-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(</span>
<span id="cb5-12">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"CÓDIGO_DE_PROVINCIA"</span>,</span>
<span id="cb5-13">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"PROVINCIA"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"CÓDIGO_CANTÓN"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"CANTÓN"</span></span>
<span id="cb5-14">  )</span>
<span id="cb5-15"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_crs</span>(regiones) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_crs</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4326</span>)</span></code></pre></div>
</div>

<div class="no-row-height column-margin column-container"><div class="">
<p>Un agradecimiento a Manuel Eduardo Saavedra Núñez, quien, con un comentario en Facebook, nos hizo ver que el resultado de <code>read_sf(request)</code> contiene nombres de columnas duplicados. Por lo tanto, nos quedaremos desde el inicio solamente con las columnas que nos interesan.</p>
</div></div><p>Ahora, revisemos lo descargado: encontramos nombres de cantones, sus provincias correspondientes y <code>SHAPE</code>, el polígono que representa a cada cantón en el mapa.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb6-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">glimpse</span>(regiones)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 84
Columns: 5
$ CÓDIGO_DE_PROVINCIA &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,…
$ PROVINCIA           &lt;chr&gt; "San José", "San José", "San José", "San José", "S…
$ CÓDIGO_CANTÓN       &lt;int&gt; 101, 102, 103, 104, 105, 106, 107, 108, 109, 110, …
$ CANTÓN              &lt;chr&gt; "San José", "Escazú", "Desamparados", "Puriscal", …
$ SHAPE               &lt;MULTIPOLYGON [°]&gt; MULTIPOLYGON (((-84.17302 9..., MULTI…</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1">x <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">object.size</span>(regiones)</span>
<span id="cb8-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">print</span>(x, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">units =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"auto"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>20.3 Mb</code></pre>
</div>
</div>
<p>Al mirar el peso del objeto <code>regiones</code>, notamos que es considerablemente grande. Esto se debe a que, para asegurar una cartografía precisa del país, el IGN emplea una precisión mucho mayor de la necesaria para la mayoría de los mapas que crearemos con ggplot2.</p>
<p>Para concluir este paso, crearemos un mapa con el paquete ggplot2, usando específicamente la geometría <code>geom_sf()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb10-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(</span>
<span id="cb10-2">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> regiones</span>
<span id="cb10-3">) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb10-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_sf</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"white"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#365486"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb10-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>()</span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://aprendetidyverse.com/posts/001_mapa_cantones_cr_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" width="3200"></p>
</figure>
</div>
</div>
</div>
<ul>
<li><strong>Paso 5:</strong> Simplificar el mapa</li>
</ul>
<p>Dado que el mapa está formado por polígonos, podemos simplificar estos polígonos eliminando lados. Esto reduce la precisión, pero a la escala de un mapa común creado con <code>ggplot2</code>, será imperceptible. Sin embargo, lograremos reducir considerablemente el tamaño del objeto, facilitando el trabajo en equipos con recursos limitados.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb11-1">regiones_simplificadas <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ms_simplify</span>(</span>
<span id="cb11-2">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">input =</span> regiones,</span>
<span id="cb11-3">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">keep =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.05</span>,</span>
<span id="cb11-4">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">keep_shapes =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span></span>
<span id="cb11-5">)</span>
<span id="cb11-6"></span>
<span id="cb11-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># eliminar la isla del coco</span></span>
<span id="cb11-8">regiones_simplificadas <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ms_filter_islands</span>(</span>
<span id="cb11-9">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">input =</span> regiones_simplificadas,</span>
<span id="cb11-10">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">min_area =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">24000000</span></span>
<span id="cb11-11">)</span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb12-1">x <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">object.size</span>(regiones_simplificadas)</span>
<span id="cb12-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">print</span>(x, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">units =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"auto"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>1.3 Mb</code></pre>
</div>
</div>
<ul>
<li><strong>Paso 6:</strong> Guardar los datos localmente</li>
</ul>
<p>Con los datos ya listos, procederemos a guardarlos localmente. Aunque es posible usar el formato shapefile o GeoJSON, en este caso optaremos por GeoJSON.</p>

<div class="no-row-height column-margin column-container"><div class="">
<p>Recomiendo la lectura del post “Limitaciones e inconvenientes del shapefile” <a href="https://www.gisandbeers.com/limitaciones-e-inconvenientes-del-shapefile/">Leer más</a>. ¡Gracias, Roberto, por tu excelente contenido!</p>
</div></div><div class="cell">
<div class="sourceCode cell-code" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb14-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">write_sf</span>(</span>
<span id="cb14-2">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">obj =</span> regiones_simplificadas, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">dsn =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"cantones_cr.geojson"</span>)</span></code></pre></div>
</div>
<ul>
<li><strong>Paso 7:</strong> Leer archivos GeoJSON</li>
</ul>
<p>Si después de un tiempo deseamos utilizar nuevamente los datos, podemos leerlos fácilmente con la función <code>st_read()</code> de la librería <code>sf</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb15-1">cantones <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_read</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"cantones_cr.geojson"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">quiet =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb16-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(</span>
<span id="cb16-2">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> cantones</span>
<span id="cb16-3">) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb16-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_sf</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"white"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#365486"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb16-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>()</span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://aprendetidyverse.com/posts/001_mapa_cantones_cr_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" width="3200"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="graficar-resultados-de-las-elecciones-municipales-2024" class="level2">
<h2 class="anchored" data-anchor-id="graficar-resultados-de-las-elecciones-municipales-2024">Graficar resultados de las elecciones municipales 2024</h2>
<p>Ahora que contamos con el “lienzo” para dibujar nuestros datos, agregaremos al mapa los resultados electorales del pasado 4 de febrero. Lo primero será leer los datos almacenados en formato <code>GeoJSON</code>, seleccionando únicamente las columnas que nos interesan: <code>provincia</code>, <code>canton</code> y <code>geometry</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb17-1">cantones <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_read</span>(</span>
<span id="cb17-2">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">dsn =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"cantones_cr.geojson"</span>,</span>
<span id="cb17-3">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">quiet =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span></span>
<span id="cb17-4">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb17-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">clean_names</span>()</span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb18" style="background: #f1f3f5;"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb18-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">glimpse</span>(cantones)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 84
Columns: 5
$ codigo_de_provincia &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,…
$ canton              &lt;chr&gt; "San José", "Escazú", "Desamparados", "Puriscal", …
$ provincia           &lt;chr&gt; "San José", "San José", "San José", "San José", "S…
$ codigo_canton       &lt;int&gt; 101, 102, 103, 104, 105, 106, 107, 108, 109, 110, …
$ geometry            &lt;MULTIPOLYGON [°]&gt; MULTIPOLYGON (((-84.15569 9..., MULTI…</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb20" style="background: #f1f3f5;"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb20-1">cantones <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> cantones <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb20-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(</span>
<span id="cb20-3">    provincia, canton</span>
<span id="cb20-4">  )</span>
<span id="cb20-5"></span>
<span id="cb20-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">glimpse</span>(cantones)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 84
Columns: 3
$ provincia &lt;chr&gt; "San José", "San José", "San José", "San José", "San José", …
$ canton    &lt;chr&gt; "San José", "Escazú", "Desamparados", "Puriscal", "Tarrazú",…
$ geometry  &lt;MULTIPOLYGON [°]&gt; MULTIPOLYGON (((-84.15569 9..., MULTIPOLYGON ((…</code></pre>
</div>
</div>
<p>Ahora vamos a leer los datos de los resultados electorales, enfocándonos en seleccionar solamente el nombre del cantón y el partido ganador en ese cantón. Afortunadamente, en Costa Rica los nombres de provincias y cantones son únicos y pueden servir como identificadores, una ventaja que no se extiende a los distritos.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22" style="background: #f1f3f5;"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb22-1">resultados_tse <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read_csv</span>(</span>
<span id="cb22-2">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">file =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"elecciones_municipales_2024.csv"</span>,</span>
<span id="cb22-3">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">show_col_types =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span></span>
<span id="cb22-4">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb22-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">clean_names</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb22-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(canton, ganador)</span>
<span id="cb22-7"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">glimpse</span>(resultados_tse)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 84
Columns: 2
$ canton  &lt;chr&gt; "San José", "Escazú", "Desamparados", "Puriscal", "Tarrazú", "…
$ ganador &lt;chr&gt; "Juntos San José", "PNG", "PLN", "PLN", "PUSC", "PLN", "PLP", …</code></pre>
</div>
</div>
<p>Realizamos la unión de ambas tablas usando el nombre del cantón como clave y presentamos los resultados con <code>ggplot2</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24" style="background: #f1f3f5;"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb24-1">mapa <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">left_join</span>(</span>
<span id="cb24-2">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> cantones,</span>
<span id="cb24-3">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> resultados_tse,</span>
<span id="cb24-4">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">join_by</span>(canton <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> canton)</span>
<span id="cb24-5">)</span>
<span id="cb24-6"></span>
<span id="cb24-7"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">glimpse</span>(mapa)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 84
Columns: 4
$ provincia &lt;chr&gt; "San José", "San José", "San José", "San José", "San José", …
$ canton    &lt;chr&gt; "San José", "Escazú", "Desamparados", "Puriscal", "Tarrazú",…
$ ganador   &lt;chr&gt; "Juntos San José", "PNG", "PLN", "PLN", "PUSC", "PLN", "PLP"…
$ geometry  &lt;MULTIPOLYGON [°]&gt; MULTIPOLYGON (((-84.15569 9..., MULTIPOLYGON ((…</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb26" style="background: #f1f3f5;"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb26-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(</span>
<span id="cb26-2">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> mapa,</span>
<span id="cb26-3">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(</span>
<span id="cb26-4">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> ganador</span>
<span id="cb26-5">  )</span>
<span id="cb26-6">) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb26-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_sf</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"white"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb26-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>()</span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://aprendetidyverse.com/posts/001_mapa_cantones_cr_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid figure-img" width="3200"></p>
</figure>
</div>
</div>
</div>
<p>Buen intento, pero vemos un par de problemas: demasiadas etiquetas, colores muy similares y ese <code>NA</code>, ¿de dónde salió? Comencemos por ese <code>NA</code>; hagamos un filtro para ver cuál de los cantones tiene como ganador <code>NA</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27" style="background: #f1f3f5;"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb27-1">mapa <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb27-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">is.na</span>(ganador))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 1 feature and 3 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: -84.15433 ymin: 9.636876 xmax: -83.97105 ymax: 9.75103
Geodetic CRS:  WGS 84
  provincia             canton ganador                       geometry
1  San José León Cortés Castro    &lt;NA&gt; MULTIPOLYGON (((-83.98673 9...</code></pre>
</div>
</div>
<p>Vemos que es el cantón León Cortés Castro; en la gran mayoría de las ocasiones, esto se produce por dos razones: no hay datos para el cantón o en ambas tablas se usan nombres diferentes para el mismo cantón. Ya que estas son elecciones nacionales y participan todos los cantones, descartamos la primera opción, así que vamos a ver cómo aparece el nombre de León Cortés Castro en la tabla de resultados.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29" style="background: #f1f3f5;"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb29-1">resultados_tse <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb29-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_detect</span>(canton, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"León"</span>))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 2
  canton      ganador      
  &lt;chr&gt;       &lt;chr&gt;        
1 León Cortés Frente Amplio</code></pre>
</div>
</div>
<p>Vemos que en la tabla de resultados se utiliza la forma “León Cortés”, una forma muy común de referirse al lugar pero no su nombre oficial. En este caso, modificaremos el nombre del cantón.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31" style="background: #f1f3f5;"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb31-1">resultados_tse <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> resultados_tse <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb31-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb31-3">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">canton =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">if_else</span>(</span>
<span id="cb31-4">      canton <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"León Cortés"</span>,</span>
<span id="cb31-5">      <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"León Cortés Castro"</span>,</span>
<span id="cb31-6">      canton</span>
<span id="cb31-7">    )</span>
<span id="cb31-8">  )</span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb32" style="background: #f1f3f5;"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb32-1">mapa <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">left_join</span>(</span>
<span id="cb32-2">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> cantones,</span>
<span id="cb32-3">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> resultados_tse,</span>
<span id="cb32-4">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">join_by</span>(canton <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> canton)</span>
<span id="cb32-5">)</span></code></pre></div>
</div>
<p>Ahora repetimos el gráfico y vemos que ya no tenemos valores ausentes.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33" style="background: #f1f3f5;"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb33-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(</span>
<span id="cb33-2">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> mapa,</span>
<span id="cb33-3">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(</span>
<span id="cb33-4">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> ganador</span>
<span id="cb33-5">  )</span>
<span id="cb33-6">) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb33-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_sf</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"white"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb33-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>()</span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://aprendetidyverse.com/posts/001_mapa_cantones_cr_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid figure-img" width="3200"></p>
</figure>
</div>
</div>
</div>
<p>Para términos del ejemplo, vamos a simplificar la cantidad de partidos políticos agrupando como “Otros” aquellos que no tengan como mínimo 5 alcaldías a nivel nacional.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34" style="background: #f1f3f5;"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb34-1">mapa <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> mapa <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb34-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb34-3">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ganador =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">fct_lump_min</span>(ganador, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">min =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>,</span>
<span id="cb34-4">                           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">other_level =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Otros"</span>)</span>
<span id="cb34-5">  )</span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb35" style="background: #f1f3f5;"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb35-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(ggokabeito)</span>
<span id="cb35-2"></span>
<span id="cb35-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(</span>
<span id="cb35-4">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> mapa,</span>
<span id="cb35-5">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(</span>
<span id="cb35-6">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> ganador</span>
<span id="cb35-7">  )</span>
<span id="cb35-8">) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb35-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_sf</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"white"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb35-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_fill_okabe_ito</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb35-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb35-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(</span>
<span id="cb35-13">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.position =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bottom"</span></span>
<span id="cb35-14">  )</span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://aprendetidyverse.com/posts/001_mapa_cantones_cr_files/figure-html/unnamed-chunk-25-1.png" class="img-fluid figure-img" width="3200"></p>
</figure>
</div>
</div>
</div>
<p>Listo, fueron muchos más pasos de los que creí inicialmente, pero espero que este ejemplo te pueda servir como referencia para mantener tus mapas actualizados. Resumen rápido:</p>
<ol type="1">
<li>Se crean nuevos cantones.</li>
<li>Los cantones cambian de nombre.</li>
<li>Es preferible usar fuentes oficiales del estado y no de sitios web de terceros.</li>
<li>Se debe tener cuidado con las faltas de ortografía o cambios de nombres al unir las tablas.</li>
</ol>
</section>
<section id="obeservaciones-finales" class="level2">
<h2 class="anchored" data-anchor-id="obeservaciones-finales">Obeservaciones finales</h2>
<p>Ya terminado este post, me puse a pensar que realmente no tengo ningún criterio formado sobre el tema de los nuevos cantones. ¿Es bueno para la administración del país? Pues no tengo idea. Me dejé a mí mismo de tarea leer más sobre el tema y creo que todos los residentes del país deberíamos tomar un par de minutos para pensarlo.</p>
<p>Laura Fernández Delgado, ministra de planificación nacional y política económica, en un oficio a los diputados 20 de febrero de 2024, dice:</p>
<blockquote class="blockquote">
<p>Las decisiones que tome la Asamblea Legislativa de creación de cantonatos pueden derivar en problemas de coordinación, de articulación y fragmentación del territorio; y adicionalmente, en ausencia de estudios técnicos y económicos pueden repercutir en una afectación a los ciudadanos habitantes de esos territorios <strong>derivada de la incapacidad para la prestación de los servicios públicos municipales por ausencia de sostenibilidad financiera</strong>, entre otros de estos nuevos cantones. <sup>7</sup></p>
</blockquote>
<p>Justo el día anterior 19 de febrero del 2024, en primer debate se aprobó el expediente 22643 para la creación del cantón Colorado<sup>8</sup> en Guanacaste y existen 6 proyectos de ley vigentes para crear nuevos cantones.</p>
<ol type="1">
<li><p>Expediente 24.062: Creación del Cantón de Cervantes, Cantón IX de la Provincia de Cartago.</p></li>
<li><p>Expediente 23.406: Creación del Cantón XVII de la Provincia de Alajuela, Peñas Blancas.</p></li>
<li><p>Expediente 23.403: Creación del Cantón Jicaral, Cantón XIV de la Provincia de Puntarenas.</p></li>
<li><p>Expediente 23.109: Creación del Cantón Cóbano.</p></li>
<li><p>Expediente 23.055: Creación del Cantón de Paquera, Cantón XIV de la Provincia de Puntarenas.</p></li>
<li><p>Expediente 22.874: Creación del Cantón Ojo de Agua, Cantón XVII de la Provincia de Alajuela.</p></li>
</ol>
<p>Así que menos mal que ya sabemos cómo tener el mapa actualizado, porque si por la fecha se saca el día, lo vamos a tener que hacer con frecuencia en los próximos años.</p>
<script defer="" src="https://rstudio-commentoplusplus.n5hlxm.easypanel.host/js/commento.js"></script>
<div id="commento">

</div>


</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document"><h2 class="anchored quarto-appendix-heading">Notas</h2>

<ol>
<li id="fn1"><p>Delfino.cr. (26 de abril de 2018). Expediente 20787: Reforma y Adiciones a la Ley N° 9440, Creación del Cantón XVI Río Cuarto de la Provincia de Alajuela, de 20 de Mayo de 2017. Delfino.cr. <a href="https://delfino.cr/asamblea/proyecto/20787">Leer más</a>↩︎</p></li>
<li id="fn2"><p>Delfino.cr. (25 de septiembre de 2019). Expediente 21618: Creación del Cantón de Monteverde, Cantón XII de la Provincia de Puntarenas. Delfino.cr. <a href="https://delfino.cr/asamblea/proyecto/21618">Leer más</a>↩︎</p></li>
<li id="fn3"><p>Delfino.cr. (21 de octubre de 2021). Expediente 22749: Creación del Cantón de Puerto Jiménez, Cantón XIII de la Provincia de Puntarenas. Delfino.cr. <a href="https://delfino.cr/asamblea/proyecto/22749">Leer más</a>↩︎</p></li>
<li id="fn4"><p>República de Costa Rica. (16 de junio de 2010). Ley N° 8808: Declara oficial para efectos administrativos, la aprobación de la División Territorial Administrativa de la República N° 41548-MGP [Cambio de nombre del cantón de Alfaro Ruiz a Zarcero]. La Gaceta, N° 116. <a href="https://www.pgrweb.go.cr/scij/Busqueda/Normativa/Normas/nrm_texto_completo.aspx?param1=NRTC&amp;nValor1=1&amp;nValor2=88416&amp;nValor3=115607&amp;strTipM=TC">Leer más</a>↩︎</p></li>
<li id="fn5"><p>Delfino.cr. (11 de febrero de 2015). Expediente 19469: Cambio de Denominación del Cantón XII, Valverde Vega, de la Provincia de Alajuela, para que en Adelante se Denomine Sarchí. Delfino.cr. <a href="https://delfino.cr/asamblea/proyecto/19469">Leer más</a>↩︎</p></li>
<li id="fn6"><p>Presidencia de la República de Costa Rica. (11 de febrero de 2015). Cambio de nombre del Cantón VI de la provincia de Puntarenas para que en adelante se denomine Quepos. Recuperado de <a href="https://www.pgrweb.go.cr/scij/Busqueda/Normativa/Normas/nrm_texto_completo.aspx?param1=NRTC&amp;nValor1=1&amp;nValor2=79730&amp;nValor3=100935&amp;strTipM=TC">Leer más</a>↩︎</p></li>
<li id="fn7"><p>San José, 20 de febrero del 2024 MIDEPLAN-DM-OF-0277-2024 A: Directorio Legislativo, Jefaturas de Fracción, Asamblea Legislativa de Costa Rica Asunto: Opinión de MIDEPLAN sobre el Primer Debate del Proyecto de Ley N°22.643, “Creación del Cantón Colorado, Cantón Duodécimo de la Provincia de Guanacaste”. Disponible en: <a href="https://d1qqtien6gys07.cloudfront.net/wp-content/uploads/2024/02/MIDEPLAN-DM-OF-0277-2024-Reaccion-del-MIDEPLAN-respecto-a-la-aprobacion-en-Primer-Debate-del-Proyecto-de-Ley-22.643-firmado-sellado.pdf">enlace</a>↩︎</p></li>
<li id="fn8"><p>Delfino.cr. (19 de febrero de 2024). Expediente 22643: Creación del Cantón Colorado, Cantón Duodécimo de la Provincia de Guanacaste. Delfino.cr. <a href="https://delfino.cr/asamblea/proyecto/22643">Leer más</a>↩︎</p></li>
</ol>
</section><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Cómo citar</h2><div><div class="quarto-appendix-secondary-label">BibTeX</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{aguero2024,
  author = {Aguero, Carlos},
  title = {Actualizando el mapa de cantones de Costa Rica con R},
  date = {2024-02-08},
  url = {https://aprendetidyverse.com/posts/001_mapa_cantones_cr.html},
  langid = {es}
}
</code></pre><div class="quarto-appendix-secondary-label">Por favor, cita este trabajo como:</div><div id="ref-aguero2024" class="csl-entry quarto-appendix-citeas">
Aguero, Carlos. 2024. <span>“Actualizando el mapa de cantones de Costa
Rica con R.”</span> February 8, 2024. <a href="https://aprendetidyverse.com/posts/001_mapa_cantones_cr.html">https://aprendetidyverse.com/posts/001_mapa_cantones_cr.html</a>.
</div></div></section></div> ]]></description>
  <category>Guías Paso a Paso</category>
  <category>ggplot2</category>
  <category>sf</category>
  <category>geojson</category>
  <guid>https://aprendetidyverse.com/posts/001_mapa_cantones_cr.html</guid>
  <pubDate>Thu, 08 Feb 2024 06:00:00 GMT</pubDate>
  <media:content url="https://aprendetidyverse.com/posts/images/mapa_cr_ggplot2.png" medium="image" type="image/png" height="75" width="144"/>
</item>
</channel>
</rss>
