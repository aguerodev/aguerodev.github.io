<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="es" xml:lang="es"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.28">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Carlos Aguero">
<meta name="description" content="Explora los recientes cambios territoriales y de nombres en los cantones de Costa Rica a través de esta guía que te enseñará a crear mapas actualizados con ggplot2, utilizando los datos del Instituto Geográfico Nacional.">

<title>Aprende Tidyverse – Actualizando el mapa de cantones de Costa Rica con R</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../favicon.ico" rel="icon">
<script src="../site_libs/cookie-consent/cookie-consent.js"></script>
<link href="../site_libs/cookie-consent/cookie-consent.css" rel="stylesheet">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/quarto-contrib/fontawesome6-0.1.0/all.css" rel="stylesheet">
<link href="../site_libs/quarto-contrib/fontawesome6-0.1.0/latex-fontsize.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "Sin resultados",
    "search-matching-documents-text": "documentos encontrados",
    "search-copy-link-title": "Copiar el enlace en la búsqueda",
    "search-hide-matches-text": "Ocultar resultados adicionales",
    "search-more-match-text": "resultado adicional en este documento",
    "search-more-matches-text": "resultados adicionales en este documento",
    "search-clear-button-title": "Borrar",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancelar",
    "search-submit-button-title": "Enviar",
    "search-label": "Buscar"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-7HH46G4FS3"></script>

<script type="text/plain" cookie-consent="tracking">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-7HH46G4FS3', { 'anonymize_ip': true});
</script>

<script type="text/javascript" charset="UTF-8">
document.addEventListener('DOMContentLoaded', function () {
cookieconsent.run({
  "notice_banner_type":"headline",
  "consent_type":"express",
  "palette":"light",
  "language":"en",
  "page_load_consent_levels":["strictly-necessary"],
  "notice_banner_reject_button_hide":false,
  "preferences_center_close_button_hide":false,
  "website_name":""
  ,
"language":"es"
  });
});
</script> 
  


<meta property="og:title" content="Actualizando el mapa de cantones de Costa Rica con R">
<meta property="og:description" content="Explora los recientes cambios territoriales y de nombres en los cantones de Costa Rica a través de esta guía que te enseñará a crear mapas actualizados con ggplot2, utilizando los datos del Instituto Geográfico Nacional.">
<meta property="og:image" content="https://aprendetidyverse.com/posts/images/mapa_cr_ggplot2.png">
<meta property="og:site_name" content="aprendetidyverse.com">
<meta property="og:locale" content="es_ES">
<meta property="og:image:height" content="663">
<meta property="og:image:width" content="1280">
<meta name="twitter:title" content="Actualizando el mapa de cantones de Costa Rica con R">
<meta name="twitter:description" content="Explora los recientes cambios territoriales y de nombres en los cantones de Costa Rica a través de esta guía que te enseñará a crear mapas actualizados con ggplot2, utilizando los datos del Instituto Geográfico Nacional.">
<meta name="twitter:image" content="https://aprendetidyverse.com/posts/images/mapa_cr_ggplot2.png">
<meta name="twitter:creator" content="@dev_aguero">
<meta name="twitter:site" content="@dev_aguero">
<meta name="twitter:image-height" content="663">
<meta name="twitter:image-width" content="1280">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="floating nav-fixed slimcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../images/logo.png" alt="" class="navbar-logo">
    </a>
  </div>
            <div id="quarto-search" class="" title="Buscar"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Navegación de palanca" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html"> 
<span class="menu-text">Inicio</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-cursos" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Cursos</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-cursos">    
        <li class="dropdown-header">Cursos de R</li>
        <li>
    <a class="dropdown-item" href="../courses/r4ds.html"><i class="bi bi-graph-up-arrow" role="img">
</i> 
 <span class="dropdown-text">R para ciencia de datos (novato)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../courses/intro_shiny.html"><i class="bi bi-window-split" role="img">
</i> 
 <span class="dropdown-text">Desarrollo de aplicaciones con shiny (intermedio)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../courses/web_scraping.html"><i class="bi bi-bug" role="img">
</i> 
 <span class="dropdown-text">Web Scraping con R (avanzado)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../courses/avz_ggplot2.html"><i class="bi bi-palette" role="img">
</i> 
 <span class="dropdown-text">ggplot2 Avanzado</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Programas especiales</li>
        <li>
    <a class="dropdown-item" href="../courses/r4ds.html"><i class="bi bi-book" role="img">
</i> 
 <span class="dropdown-text">R para la investigación en ciencias sociales</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../courses/r4ds.html"><i class="bi bi-hospital" role="img">
</i> 
 <span class="dropdown-text">R para la investigación en ciencias medicas</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="../lunes_pr.html"> 
<span class="menu-text">Sesiones de Consultas</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../posts.html"> 
<span class="menu-text">Blog</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/dev_aguero"> <i class="bi bi-twitter" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.instagram.com/aprende.tidyverse/"> <i class="bi bi-instagram" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.facebook.com/aprende.tidyverse"> <i class="bi bi-facebook" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/carlos-aguero-cr/"> <i class="bi bi-linkedin" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">En esta página</h2>
   
  <ul>
  <li><a href="#obtener-datos-actualizados-del-ign" id="toc-obtener-datos-actualizados-del-ign" class="nav-link active" data-scroll-target="#obtener-datos-actualizados-del-ign">Obtener datos actualizados del IGN</a>
  <ul class="collapse">
  <li><a href="#ante-de-comenzar" id="toc-ante-de-comenzar" class="nav-link" data-scroll-target="#ante-de-comenzar">Ante de comenzar</a></li>
  <li><a href="#descargar-datos-del-ign" id="toc-descargar-datos-del-ign" class="nav-link" data-scroll-target="#descargar-datos-del-ign">Descargar datos del IGN</a></li>
  </ul></li>
  <li><a href="#graficar-resultados-de-las-elecciones-municipales-2024" id="toc-graficar-resultados-de-las-elecciones-municipales-2024" class="nav-link" data-scroll-target="#graficar-resultados-de-las-elecciones-municipales-2024">Graficar resultados de las elecciones municipales 2024</a></li>
  <li><a href="#obeservaciones-finales" id="toc-obeservaciones-finales" class="nav-link" data-scroll-target="#obeservaciones-finales">Obeservaciones finales</a></li>
  </ul>
<div class="quarto-other-links"><h2>Otros Enlaces</h2><ul><li><a href="https://www.snitcr.go.cr/ign_ign"><i class="bi bi-link-45deg"></i>Instituto Geográfico Nacional</a></li><li><a href="https://github.com/aguerodev/aguerodev.github.io/blob/main/posts/elecciones_municipales_2024.csv"><i class="bi bi-filetype-csv"></i>Datos elecciones municipales 2024</a></li></ul></div><div class="quarto-code-links"><h2>Enlaces de código</h2><ul><li><a href="https://github.com/aguerodev/aguerodev.github.io/blob/main/posts/001_mapa_cantones_cr.R"><i class="bi bi-file-code"></i>Descargar código completo</a></li></ul></div></nav>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
    </div>
<!-- main -->
<main class="content page-columns page-full" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Actualizando el mapa de cantones de Costa Rica con R</h1>
  </div>

<div>
  <div class="description">
    Explora los recientes cambios territoriales y de nombres en los cantones de Costa Rica a través de esta guía que te enseñará a crear mapas actualizados con ggplot2, utilizando los datos del Instituto Geográfico Nacional.
  </div>
</div>

<div class="quarto-title-meta-author">
  <div class="quarto-title-meta-heading">Autor/a</div>
  <div class="quarto-title-meta-heading">Afiliación</div>
  
    <div class="quarto-title-meta-contents">
    <p class="author">Carlos Aguero </p>
  </div>
  <div class="quarto-title-meta-contents">
        <p class="affiliation">
            <a href="https://aprendetidyverse.com/">
            Aprende Tidyverse
            </a>
          </p>
      </div>
  </div>

<div class="quarto-title-meta">

      
    <div>
    <div class="quarto-title-meta-heading">Fecha de publicación</div>
    <div class="quarto-title-meta-contents">
      <p class="date">8 de febrero de 2024</p>
    </div>
  </div>
  
    <div>
    <div class="quarto-title-meta-heading">Fecha de modificación</div>
    <div class="quarto-title-meta-contents">
      <p class="date-modified">12 de abril de 2024</p>
    </div>
  </div>
    
  </div>
  


</header>


<p>A inicios de 2024 en Costa Rica, se realizaron elecciones municipales. Una vez publicados los resultados, tuve la idea de replicar un gráfico sencillo: un mapa con <code>ggplot2</code> de los cantones de Costa Rica, y pintar en colores el partido político que ha ganado en cada una de las regiones. Para ahorrar tiempo hago una búsqueda rápida en google <strong>“shapefile cantones Costa Rica”</strong> al descargar los datos y ejecutar mi código, resulta que me hacen falta cantones. Después de un par de segundos de duda, recordé que en los últimos años se han creado nuevos cantones. Río Cuarto<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> se separa del cantón de Grecia, Monteverde<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> de Puntarenas, y uno para mi muy sonado, ya que está muy cerca de donde vivo, Puerto Jiménez<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a> se separa de Golfito y pasa a ser un cantón.</p>
<p>Si a esto le sumamos que algunos cantones han cambiado de nombre, Alfaro Ruiz ahora es conocido como Zarcero<a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a>, Valverde Vega se ha transformado en Sarchí<a href="#fn5" class="footnote-ref" id="fnref5" role="doc-noteref"><sup>5</sup></a>, y Aguirre ha pasado a llamarse Quepos<a href="#fn6" class="footnote-ref" id="fnref6" role="doc-noteref"><sup>6</sup></a>. En este punto, algo que creí serían 10 líneas de código, un problema de copiar y pegar, se convertía en algo más interesante. <strong>Así que en esta guia veremos cómo realizar un gráfico actualizado de los cantones de Costa Rica, utilizando como fuente de datos los servicios del <a href="https://www.snitcr.go.cr/ign_ign">Instituto Geográfico Nacional</a>.</strong></p>
<section id="obtener-datos-actualizados-del-ign" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="obtener-datos-actualizados-del-ign">Obtener datos actualizados del IGN</h2>
<section id="ante-de-comenzar" class="level3">
<h3 class="anchored" data-anchor-id="ante-de-comenzar">Ante de comenzar</h3>
<p>Verifica que tengas instalados los siguientes paquetes:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="fu">library</span>(sf)</span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="fu">library</span>(httr2)</span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="fu">library</span>(ows4R)</span>
<span id="cb1-5"><a href="#cb1-5"></a><span class="fu">library</span>(rmapshaper)</span>
<span id="cb1-6"><a href="#cb1-6"></a><span class="fu">library</span>(janitor)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-simple callout-note">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container">
<p>Si en Windows tienes errores al instalar alguno de los paquetes, quizás falte instalar Rtools. Descárgalo de este <a href="https://cran.r-project.org/bin/windows/Rtools/">enlace</a> y reinicia antes de intentar de nuevo.</p>
</div>
</div>
</div>
</section>
<section id="descargar-datos-del-ign" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="descargar-datos-del-ign">Descargar datos del IGN</h3>
<p>El <a href="https://www.snitcr.go.cr/ign_ign">Instituto Geográfico Nacional</a> es la principal fuente de cartografía en Costa Rica, ofreciendo datos geoespaciales actualizados. Para obtener un shapefile específico para nuestro mapa, recurriremos al servicio WFS en R, enfocándonos en la división cantonal.</p>
<ul>
<li><strong>Paso 1:</strong> Acceder al IGN</li>
</ul>
<p>Visita la página de <a href="https://www.snitcr.go.cr/ico_servicios_ogc">servicios OGC</a> del IGN. En la sección de nodos locales, selecciona el servicio <strong>IGN Cartografía 1:5mil CO.</strong></p>
<p><img src="images/ign_01.png" class="img-fluid" style="width:30.0%"></p>
<ul>
<li><strong>Paso 2:</strong> Identificar la URL del Servicio WFS</li>
</ul>
<p>A continuación, localizaremos la URL del servicio WFS que utilizaremos, tal como se muestra en la imagen adjunta.</p>
<p><img src="images/ign_02.png" class="img-fluid" style="width:80.0%"></p>
<ul>
<li><strong>Paso 3:</strong> Identificar las capas disponibles</li>
</ul>
<p>Mediante el uso del paquete <code>ows4R</code> en R, consultaremos los identificadores de las capas disponibles. Esto nos permitirá seleccionar y descargar la capa adecuada, ya sea a nivel de provincia, cantón o distrito.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a>url_wfs <span class="ot">&lt;-</span> <span class="st">"https://geos.snitcr.go.cr/be/IGN_5_CO/wfs?"</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a>bwk_client <span class="ot">&lt;-</span> WFSClient<span class="sc">$</span><span class="fu">new</span>(</span>
<span id="cb3-2"><a href="#cb3-2"></a>  <span class="at">url =</span> url_wfs,</span>
<span id="cb3-3"><a href="#cb3-3"></a>  <span class="at">serviceVersion =</span> <span class="st">"2.0.0"</span></span>
<span id="cb3-4"><a href="#cb3-4"></a>)</span>
<span id="cb3-5"><a href="#cb3-5"></a></span>
<span id="cb3-6"><a href="#cb3-6"></a><span class="fu">as_tibble</span>(bwk_client<span class="sc">$</span><span class="fu">getFeatureTypes</span>(<span class="at">pretty =</span> <span class="cn">TRUE</span>))</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 2
  name                         title                                            
  &lt;chr&gt;                        &lt;chr&gt;                                            
1 IGN_5_CO:curvas_5000_2017    Curvas de nivel cada 10 metros 1:5.000 año 2017 …
2 IGN_5_CO:limitedistrital_5k  DTA (Límite Distrital)                           
3 IGN_5_CO:limitecantonal_5k   Límite Cantonal                                  
4 IGN_5_CO:limiteprovincial_5k Límite Provincial                                </code></pre>
</div>
</div>

<div class="no-row-height column-margin column-container"><div class="">
<p>El código para usar servicios WFS proviene del post “Spatial WFS Services” por Thierry Onkelinx, Hans Van Calster, y Floris Vanderhaeghe. <a href="https://inbo.github.io/tutorials/tutorials/spatial_wfs_services/">Leer más</a></p>
<hr>
<p>Adaptamos funciones para migrar a httr2 desde httr. Consulta <a href="https://httr2.r-lib.org/articles/httr2.html">httr2</a> para detalles.</p>
</div></div><ul>
<li><strong>Paso 4:</strong> Descargar los datos</li>
</ul>
<p>Para descargar los cantones de Costa Rica, utilizaremos la capa denominada <strong>IGN_5_CO:limitecantonal_5k</strong>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a>url <span class="ot">&lt;-</span> <span class="fu">url_parse</span>(url_wfs)</span>
<span id="cb5-2"><a href="#cb5-2"></a>url<span class="sc">$</span>query <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb5-3"><a href="#cb5-3"></a>  <span class="at">service =</span> <span class="st">"wfs"</span>,</span>
<span id="cb5-4"><a href="#cb5-4"></a>  <span class="at">request =</span> <span class="st">"GetFeature"</span>,</span>
<span id="cb5-5"><a href="#cb5-5"></a>  <span class="at">typename =</span> <span class="st">"IGN_5_CO:limitecantonal_5k"</span>,</span>
<span id="cb5-6"><a href="#cb5-6"></a>  <span class="at">srsName =</span> <span class="st">"EPSG:4326"</span></span>
<span id="cb5-7"><a href="#cb5-7"></a>  )</span>
<span id="cb5-8"><a href="#cb5-8"></a>request <span class="ot">&lt;-</span> <span class="fu">url_build</span>(url) </span>
<span id="cb5-9"><a href="#cb5-9"></a></span>
<span id="cb5-10"><a href="#cb5-10"></a>regiones <span class="ot">&lt;-</span> <span class="fu">read_sf</span>(request) <span class="sc">|&gt;</span> </span>
<span id="cb5-11"><a href="#cb5-11"></a>  <span class="fu">select</span>(</span>
<span id="cb5-12"><a href="#cb5-12"></a>    <span class="st">"CÓDIGO_DE_PROVINCIA"</span>,</span>
<span id="cb5-13"><a href="#cb5-13"></a>    <span class="st">"PROVINCIA"</span>,<span class="st">"CÓDIGO_CANTÓN"</span>,<span class="st">"CANTÓN"</span></span>
<span id="cb5-14"><a href="#cb5-14"></a>  )</span>
<span id="cb5-15"><a href="#cb5-15"></a><span class="fu">st_crs</span>(regiones) <span class="ot">&lt;-</span> <span class="fu">st_crs</span>(<span class="dv">4326</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>

<div class="no-row-height column-margin column-container"><div class="">
<p>Un agradecimiento a Manuel Eduardo Saavedra Núñez, quien, con un comentario en Facebook, nos hizo ver que el resultado de <code>read_sf(request)</code> contiene nombres de columnas duplicados. Por lo tanto, nos quedaremos desde el inicio solamente con las columnas que nos interesan.</p>
</div></div><p>Ahora, revisemos lo descargado: encontramos nombres de cantones, sus provincias correspondientes y <code>SHAPE</code>, el polígono que representa a cada cantón en el mapa.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a><span class="fu">glimpse</span>(regiones)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 84
Columns: 5
$ CÓDIGO_DE_PROVINCIA &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,…
$ PROVINCIA           &lt;chr&gt; "San José", "San José", "San José", "San José", "S…
$ CÓDIGO_CANTÓN       &lt;int&gt; 101, 102, 103, 104, 105, 106, 107, 108, 109, 110, …
$ CANTÓN              &lt;chr&gt; "San José", "Escazú", "Desamparados", "Puriscal", …
$ SHAPE               &lt;MULTIPOLYGON [°]&gt; MULTIPOLYGON (((-84.17302 9..., MULTI…</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a>x <span class="ot">&lt;-</span> <span class="fu">object.size</span>(regiones)</span>
<span id="cb8-2"><a href="#cb8-2"></a><span class="fu">print</span>(x, <span class="at">units =</span> <span class="st">"auto"</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>20.3 Mb</code></pre>
</div>
</div>
<p>Al mirar el peso del objeto <code>regiones</code>, notamos que es considerablemente grande. Esto se debe a que, para asegurar una cartografía precisa del país, el IGN emplea una precisión mucho mayor de la necesaria para la mayoría de los mapas que crearemos con ggplot2.</p>
<p>Para concluir este paso, crearemos un mapa con el paquete ggplot2, usando específicamente la geometría <code>geom_sf()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a><span class="fu">ggplot</span>(</span>
<span id="cb10-2"><a href="#cb10-2"></a>  <span class="at">data =</span> regiones</span>
<span id="cb10-3"><a href="#cb10-3"></a>) <span class="sc">+</span></span>
<span id="cb10-4"><a href="#cb10-4"></a>  <span class="fu">geom_sf</span>(<span class="at">color =</span> <span class="st">"white"</span>, <span class="at">fill =</span> <span class="st">"#365486"</span>) <span class="sc">+</span></span>
<span id="cb10-5"><a href="#cb10-5"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="001_mapa_cantones_cr_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" width="3200"></p>
</figure>
</div>
</div>
</div>
<ul>
<li><strong>Paso 5:</strong> Simplificar el mapa</li>
</ul>
<p>Dado que el mapa está formado por polígonos, podemos simplificar estos polígonos eliminando lados. Esto reduce la precisión, pero a la escala de un mapa común creado con <code>ggplot2</code>, será imperceptible. Sin embargo, lograremos reducir considerablemente el tamaño del objeto, facilitando el trabajo en equipos con recursos limitados.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a>regiones_simplificadas <span class="ot">&lt;-</span> <span class="fu">ms_simplify</span>(</span>
<span id="cb11-2"><a href="#cb11-2"></a>  <span class="at">input =</span> regiones,</span>
<span id="cb11-3"><a href="#cb11-3"></a>  <span class="at">keep =</span> <span class="fl">0.05</span>,</span>
<span id="cb11-4"><a href="#cb11-4"></a>  <span class="at">keep_shapes =</span> <span class="cn">FALSE</span></span>
<span id="cb11-5"><a href="#cb11-5"></a>)</span>
<span id="cb11-6"><a href="#cb11-6"></a></span>
<span id="cb11-7"><a href="#cb11-7"></a><span class="co"># eliminar la isla del coco</span></span>
<span id="cb11-8"><a href="#cb11-8"></a>regiones_simplificadas <span class="ot">&lt;-</span> <span class="fu">ms_filter_islands</span>(</span>
<span id="cb11-9"><a href="#cb11-9"></a>  <span class="at">input =</span> regiones_simplificadas,</span>
<span id="cb11-10"><a href="#cb11-10"></a>  <span class="at">min_area =</span> <span class="dv">24000000</span></span>
<span id="cb11-11"><a href="#cb11-11"></a>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a>x <span class="ot">&lt;-</span> <span class="fu">object.size</span>(regiones_simplificadas)</span>
<span id="cb12-2"><a href="#cb12-2"></a><span class="fu">print</span>(x, <span class="at">units =</span> <span class="st">"auto"</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>1.3 Mb</code></pre>
</div>
</div>
<ul>
<li><strong>Paso 6:</strong> Guardar los datos localmente</li>
</ul>
<p>Con los datos ya listos, procederemos a guardarlos localmente. Aunque es posible usar el formato shapefile o GeoJSON, en este caso optaremos por GeoJSON.</p>

<div class="no-row-height column-margin column-container"><div class="">
<p>Recomiendo la lectura del post “Limitaciones e inconvenientes del shapefile” <a href="https://www.gisandbeers.com/limitaciones-e-inconvenientes-del-shapefile/">Leer más</a>. ¡Gracias, Roberto, por tu excelente contenido!</p>
</div></div><div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a><span class="fu">write_sf</span>(</span>
<span id="cb14-2"><a href="#cb14-2"></a>  <span class="at">obj =</span> regiones_simplificadas, <span class="at">dsn =</span> <span class="st">"cantones_cr.geojson"</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li><strong>Paso 7:</strong> Leer archivos GeoJSON</li>
</ul>
<p>Si después de un tiempo deseamos utilizar nuevamente los datos, podemos leerlos fácilmente con la función <code>st_read()</code> de la librería <code>sf</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a>cantones <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="st">"cantones_cr.geojson"</span>, <span class="at">quiet =</span> <span class="cn">TRUE</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1"></a><span class="fu">ggplot</span>(</span>
<span id="cb16-2"><a href="#cb16-2"></a>  <span class="at">data =</span> cantones</span>
<span id="cb16-3"><a href="#cb16-3"></a>) <span class="sc">+</span></span>
<span id="cb16-4"><a href="#cb16-4"></a>  <span class="fu">geom_sf</span>(<span class="at">color =</span> <span class="st">"white"</span>, <span class="at">fill =</span> <span class="st">"#365486"</span>) <span class="sc">+</span></span>
<span id="cb16-5"><a href="#cb16-5"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="001_mapa_cantones_cr_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" width="3200"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="graficar-resultados-de-las-elecciones-municipales-2024" class="level2">
<h2 class="anchored" data-anchor-id="graficar-resultados-de-las-elecciones-municipales-2024">Graficar resultados de las elecciones municipales 2024</h2>
<p>Ahora que contamos con el “lienzo” para dibujar nuestros datos, agregaremos al mapa los resultados electorales del pasado 4 de febrero. Lo primero será leer los datos almacenados en formato <code>GeoJSON</code>, seleccionando únicamente las columnas que nos interesan: <code>provincia</code>, <code>canton</code> y <code>geometry</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a>cantones <span class="ot">&lt;-</span> <span class="fu">st_read</span>(</span>
<span id="cb17-2"><a href="#cb17-2"></a>  <span class="at">dsn =</span> <span class="st">"cantones_cr.geojson"</span>,</span>
<span id="cb17-3"><a href="#cb17-3"></a>  <span class="at">quiet =</span> <span class="cn">TRUE</span></span>
<span id="cb17-4"><a href="#cb17-4"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb17-5"><a href="#cb17-5"></a>  <span class="fu">clean_names</span>()</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1"></a><span class="fu">glimpse</span>(cantones)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 84
Columns: 5
$ codigo_de_provincia &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,…
$ canton              &lt;chr&gt; "San José", "Escazú", "Desamparados", "Puriscal", …
$ provincia           &lt;chr&gt; "San José", "San José", "San José", "San José", "S…
$ codigo_canton       &lt;int&gt; 101, 102, 103, 104, 105, 106, 107, 108, 109, 110, …
$ geometry            &lt;MULTIPOLYGON [°]&gt; MULTIPOLYGON (((-84.15569 9..., MULTI…</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1"></a>cantones <span class="ot">&lt;-</span> cantones <span class="sc">|&gt;</span> </span>
<span id="cb20-2"><a href="#cb20-2"></a>  <span class="fu">select</span>(</span>
<span id="cb20-3"><a href="#cb20-3"></a>    provincia, canton</span>
<span id="cb20-4"><a href="#cb20-4"></a>  )</span>
<span id="cb20-5"><a href="#cb20-5"></a></span>
<span id="cb20-6"><a href="#cb20-6"></a><span class="fu">glimpse</span>(cantones)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 84
Columns: 3
$ provincia &lt;chr&gt; "San José", "San José", "San José", "San José", "San José", …
$ canton    &lt;chr&gt; "San José", "Escazú", "Desamparados", "Puriscal", "Tarrazú",…
$ geometry  &lt;MULTIPOLYGON [°]&gt; MULTIPOLYGON (((-84.15569 9..., MULTIPOLYGON ((…</code></pre>
</div>
</div>
<p>Ahora vamos a leer los datos de los resultados electorales, enfocándonos en seleccionar solamente el nombre del cantón y el partido ganador en ese cantón. Afortunadamente, en Costa Rica los nombres de provincias y cantones son únicos y pueden servir como identificadores, una ventaja que no se extiende a los distritos.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1"></a>resultados_tse <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(</span>
<span id="cb22-2"><a href="#cb22-2"></a>  <span class="at">file =</span> <span class="st">"elecciones_municipales_2024.csv"</span>,</span>
<span id="cb22-3"><a href="#cb22-3"></a>  <span class="at">show_col_types =</span> <span class="cn">FALSE</span></span>
<span id="cb22-4"><a href="#cb22-4"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb22-5"><a href="#cb22-5"></a>  <span class="fu">clean_names</span>() <span class="sc">|&gt;</span> </span>
<span id="cb22-6"><a href="#cb22-6"></a>  <span class="fu">select</span>(canton, ganador)</span>
<span id="cb22-7"><a href="#cb22-7"></a><span class="fu">glimpse</span>(resultados_tse)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 84
Columns: 2
$ canton  &lt;chr&gt; "San José", "Escazú", "Desamparados", "Puriscal", "Tarrazú", "…
$ ganador &lt;chr&gt; "Juntos San José", "PNG", "PLN", "PLN", "PUSC", "PLN", "PLP", …</code></pre>
</div>
</div>
<p>Realizamos la unión de ambas tablas usando el nombre del cantón como clave y presentamos los resultados con <code>ggplot2</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1"></a>mapa <span class="ot">&lt;-</span> <span class="fu">left_join</span>(</span>
<span id="cb24-2"><a href="#cb24-2"></a>  <span class="at">x =</span> cantones,</span>
<span id="cb24-3"><a href="#cb24-3"></a>  <span class="at">y =</span> resultados_tse,</span>
<span id="cb24-4"><a href="#cb24-4"></a>  <span class="at">by =</span> <span class="fu">join_by</span>(canton <span class="sc">==</span> canton)</span>
<span id="cb24-5"><a href="#cb24-5"></a>)</span>
<span id="cb24-6"><a href="#cb24-6"></a></span>
<span id="cb24-7"><a href="#cb24-7"></a><span class="fu">glimpse</span>(mapa)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 84
Columns: 4
$ provincia &lt;chr&gt; "San José", "San José", "San José", "San José", "San José", …
$ canton    &lt;chr&gt; "San José", "Escazú", "Desamparados", "Puriscal", "Tarrazú",…
$ ganador   &lt;chr&gt; "Juntos San José", "PNG", "PLN", "PLN", "PUSC", "PLN", "PLP"…
$ geometry  &lt;MULTIPOLYGON [°]&gt; MULTIPOLYGON (((-84.15569 9..., MULTIPOLYGON ((…</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1"></a><span class="fu">ggplot</span>(</span>
<span id="cb26-2"><a href="#cb26-2"></a>  <span class="at">data =</span> mapa,</span>
<span id="cb26-3"><a href="#cb26-3"></a>  <span class="at">mapping =</span> <span class="fu">aes</span>(</span>
<span id="cb26-4"><a href="#cb26-4"></a>    <span class="at">fill =</span> ganador</span>
<span id="cb26-5"><a href="#cb26-5"></a>  )</span>
<span id="cb26-6"><a href="#cb26-6"></a>) <span class="sc">+</span></span>
<span id="cb26-7"><a href="#cb26-7"></a>  <span class="fu">geom_sf</span>(<span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb26-8"><a href="#cb26-8"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="001_mapa_cantones_cr_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid figure-img" width="3200"></p>
</figure>
</div>
</div>
</div>
<p>Buen intento, pero vemos un par de problemas: demasiadas etiquetas, colores muy similares y ese <code>NA</code>, ¿de dónde salió? Comencemos por ese <code>NA</code>; hagamos un filtro para ver cuál de los cantones tiene como ganador <code>NA</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1"></a>mapa <span class="sc">|&gt;</span> </span>
<span id="cb27-2"><a href="#cb27-2"></a>  <span class="fu">filter</span>(<span class="fu">is.na</span>(ganador))</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 1 feature and 3 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: -84.15433 ymin: 9.636876 xmax: -83.97105 ymax: 9.75103
Geodetic CRS:  WGS 84
  provincia             canton ganador                       geometry
1  San José León Cortés Castro    &lt;NA&gt; MULTIPOLYGON (((-83.98673 9...</code></pre>
</div>
</div>
<p>Vemos que es el cantón León Cortés Castro; en la gran mayoría de las ocasiones, esto se produce por dos razones: no hay datos para el cantón o en ambas tablas se usan nombres diferentes para el mismo cantón. Ya que estas son elecciones nacionales y participan todos los cantones, descartamos la primera opción, así que vamos a ver cómo aparece el nombre de León Cortés Castro en la tabla de resultados.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1"></a>resultados_tse <span class="sc">|&gt;</span> </span>
<span id="cb29-2"><a href="#cb29-2"></a>  <span class="fu">filter</span>(<span class="fu">str_detect</span>(canton, <span class="st">"León"</span>))</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 2
  canton      ganador      
  &lt;chr&gt;       &lt;chr&gt;        
1 León Cortés Frente Amplio</code></pre>
</div>
</div>
<p>Vemos que en la tabla de resultados se utiliza la forma “León Cortés”, una forma muy común de referirse al lugar pero no su nombre oficial. En este caso, modificaremos el nombre del cantón.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1"></a>resultados_tse <span class="ot">&lt;-</span> resultados_tse <span class="sc">|&gt;</span> </span>
<span id="cb31-2"><a href="#cb31-2"></a>  <span class="fu">mutate</span>(</span>
<span id="cb31-3"><a href="#cb31-3"></a>    <span class="at">canton =</span> <span class="fu">if_else</span>(</span>
<span id="cb31-4"><a href="#cb31-4"></a>      canton <span class="sc">==</span> <span class="st">"León Cortés"</span>,</span>
<span id="cb31-5"><a href="#cb31-5"></a>      <span class="st">"León Cortés Castro"</span>,</span>
<span id="cb31-6"><a href="#cb31-6"></a>      canton</span>
<span id="cb31-7"><a href="#cb31-7"></a>    )</span>
<span id="cb31-8"><a href="#cb31-8"></a>  )</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1"></a>mapa <span class="ot">&lt;-</span> <span class="fu">left_join</span>(</span>
<span id="cb32-2"><a href="#cb32-2"></a>  <span class="at">x =</span> cantones,</span>
<span id="cb32-3"><a href="#cb32-3"></a>  <span class="at">y =</span> resultados_tse,</span>
<span id="cb32-4"><a href="#cb32-4"></a>  <span class="at">by =</span> <span class="fu">join_by</span>(canton <span class="sc">==</span> canton)</span>
<span id="cb32-5"><a href="#cb32-5"></a>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Ahora repetimos el gráfico y vemos que ya no tenemos valores ausentes.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1"></a><span class="fu">ggplot</span>(</span>
<span id="cb33-2"><a href="#cb33-2"></a>  <span class="at">data =</span> mapa,</span>
<span id="cb33-3"><a href="#cb33-3"></a>  <span class="at">mapping =</span> <span class="fu">aes</span>(</span>
<span id="cb33-4"><a href="#cb33-4"></a>    <span class="at">fill =</span> ganador</span>
<span id="cb33-5"><a href="#cb33-5"></a>  )</span>
<span id="cb33-6"><a href="#cb33-6"></a>) <span class="sc">+</span></span>
<span id="cb33-7"><a href="#cb33-7"></a>  <span class="fu">geom_sf</span>(<span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb33-8"><a href="#cb33-8"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="001_mapa_cantones_cr_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid figure-img" width="3200"></p>
</figure>
</div>
</div>
</div>
<p>Para términos del ejemplo, vamos a simplificar la cantidad de partidos políticos agrupando como “Otros” aquellos que no tengan como mínimo 5 alcaldías a nivel nacional.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1"></a>mapa <span class="ot">&lt;-</span> mapa <span class="sc">|&gt;</span></span>
<span id="cb34-2"><a href="#cb34-2"></a>  <span class="fu">mutate</span>(</span>
<span id="cb34-3"><a href="#cb34-3"></a>    <span class="at">ganador =</span> <span class="fu">fct_lump_min</span>(ganador, <span class="at">min =</span> <span class="dv">5</span>,</span>
<span id="cb34-4"><a href="#cb34-4"></a>                           <span class="at">other_level =</span> <span class="st">"Otros"</span>)</span>
<span id="cb34-5"><a href="#cb34-5"></a>  )</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1"></a><span class="fu">library</span>(ggokabeito)</span>
<span id="cb35-2"><a href="#cb35-2"></a></span>
<span id="cb35-3"><a href="#cb35-3"></a><span class="fu">ggplot</span>(</span>
<span id="cb35-4"><a href="#cb35-4"></a>  <span class="at">data =</span> mapa,</span>
<span id="cb35-5"><a href="#cb35-5"></a>  <span class="at">mapping =</span> <span class="fu">aes</span>(</span>
<span id="cb35-6"><a href="#cb35-6"></a>    <span class="at">fill =</span> ganador</span>
<span id="cb35-7"><a href="#cb35-7"></a>  )</span>
<span id="cb35-8"><a href="#cb35-8"></a>) <span class="sc">+</span></span>
<span id="cb35-9"><a href="#cb35-9"></a>  <span class="fu">geom_sf</span>(<span class="at">color =</span> <span class="st">"white"</span>, <span class="at">linewidth =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb35-10"><a href="#cb35-10"></a>  <span class="fu">scale_fill_okabe_ito</span>() <span class="sc">+</span></span>
<span id="cb35-11"><a href="#cb35-11"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb35-12"><a href="#cb35-12"></a>  <span class="fu">theme</span>(</span>
<span id="cb35-13"><a href="#cb35-13"></a>    <span class="at">legend.position =</span> <span class="st">"bottom"</span></span>
<span id="cb35-14"><a href="#cb35-14"></a>  )</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="001_mapa_cantones_cr_files/figure-html/unnamed-chunk-25-1.png" class="img-fluid figure-img" width="3200"></p>
</figure>
</div>
</div>
</div>
<p>Listo, fueron muchos más pasos de los que creí inicialmente, pero espero que este ejemplo te pueda servir como referencia para mantener tus mapas actualizados. Resumen rápido:</p>
<ol type="1">
<li>Se crean nuevos cantones.</li>
<li>Los cantones cambian de nombre.</li>
<li>Es preferible usar fuentes oficiales del estado y no de sitios web de terceros.</li>
<li>Se debe tener cuidado con las faltas de ortografía o cambios de nombres al unir las tablas.</li>
</ol>
</section>
<section id="obeservaciones-finales" class="level2">
<h2 class="anchored" data-anchor-id="obeservaciones-finales">Obeservaciones finales</h2>
<p>Ya terminado este post, me puse a pensar que realmente no tengo ningún criterio formado sobre el tema de los nuevos cantones. ¿Es bueno para la administración del país? Pues no tengo idea. Me dejé a mí mismo de tarea leer más sobre el tema y creo que todos los residentes del país deberíamos tomar un par de minutos para pensarlo.</p>
<p>Laura Fernández Delgado, ministra de planificación nacional y política económica, en un oficio a los diputados 20 de febrero de 2024, dice:</p>
<blockquote class="blockquote">
<p>Las decisiones que tome la Asamblea Legislativa de creación de cantonatos pueden derivar en problemas de coordinación, de articulación y fragmentación del territorio; y adicionalmente, en ausencia de estudios técnicos y económicos pueden repercutir en una afectación a los ciudadanos habitantes de esos territorios <strong>derivada de la incapacidad para la prestación de los servicios públicos municipales por ausencia de sostenibilidad financiera</strong>, entre otros de estos nuevos cantones. <a href="#fn7" class="footnote-ref" id="fnref7" role="doc-noteref"><sup>7</sup></a></p>
</blockquote>
<p>Justo el día anterior 19 de febrero del 2024, en primer debate se aprobó el expediente 22643 para la creación del cantón Colorado<a href="#fn8" class="footnote-ref" id="fnref8" role="doc-noteref"><sup>8</sup></a> en Guanacaste y existen 6 proyectos de ley vigentes para crear nuevos cantones.</p>
<ol type="1">
<li><p>Expediente 24.062: Creación del Cantón de Cervantes, Cantón IX de la Provincia de Cartago.</p></li>
<li><p>Expediente 23.406: Creación del Cantón XVII de la Provincia de Alajuela, Peñas Blancas.</p></li>
<li><p>Expediente 23.403: Creación del Cantón Jicaral, Cantón XIV de la Provincia de Puntarenas.</p></li>
<li><p>Expediente 23.109: Creación del Cantón Cóbano.</p></li>
<li><p>Expediente 23.055: Creación del Cantón de Paquera, Cantón XIV de la Provincia de Puntarenas.</p></li>
<li><p>Expediente 22.874: Creación del Cantón Ojo de Agua, Cantón XVII de la Provincia de Alajuela.</p></li>
</ol>
<p>Así que menos mal que ya sabemos cómo tener el mapa actualizado, porque si por la fecha se saca el día, lo vamos a tener que hacer con frecuencia en los próximos años.</p>


</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Notas</h2>

<ol>
<li id="fn1"><p>Delfino.cr. (26 de abril de 2018). Expediente 20787: Reforma y Adiciones a la Ley N° 9440, Creación del Cantón XVI Río Cuarto de la Provincia de Alajuela, de 20 de Mayo de 2017. Delfino.cr. <a href="https://delfino.cr/asamblea/proyecto/20787">Leer más</a><a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>Delfino.cr. (25 de septiembre de 2019). Expediente 21618: Creación del Cantón de Monteverde, Cantón XII de la Provincia de Puntarenas. Delfino.cr. <a href="https://delfino.cr/asamblea/proyecto/21618">Leer más</a><a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>Delfino.cr. (21 de octubre de 2021). Expediente 22749: Creación del Cantón de Puerto Jiménez, Cantón XIII de la Provincia de Puntarenas. Delfino.cr. <a href="https://delfino.cr/asamblea/proyecto/22749">Leer más</a><a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn4"><p>República de Costa Rica. (16 de junio de 2010). Ley N° 8808: Declara oficial para efectos administrativos, la aprobación de la División Territorial Administrativa de la República N° 41548-MGP [Cambio de nombre del cantón de Alfaro Ruiz a Zarcero]. La Gaceta, N° 116. <a href="https://www.pgrweb.go.cr/scij/Busqueda/Normativa/Normas/nrm_texto_completo.aspx?param1=NRTC&amp;nValor1=1&amp;nValor2=88416&amp;nValor3=115607&amp;strTipM=TC">Leer más</a><a href="#fnref4" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn5"><p>Delfino.cr. (11 de febrero de 2015). Expediente 19469: Cambio de Denominación del Cantón XII, Valverde Vega, de la Provincia de Alajuela, para que en Adelante se Denomine Sarchí. Delfino.cr. <a href="https://delfino.cr/asamblea/proyecto/19469">Leer más</a><a href="#fnref5" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn6"><p>Presidencia de la República de Costa Rica. (11 de febrero de 2015). Cambio de nombre del Cantón VI de la provincia de Puntarenas para que en adelante se denomine Quepos. Recuperado de <a href="https://www.pgrweb.go.cr/scij/Busqueda/Normativa/Normas/nrm_texto_completo.aspx?param1=NRTC&amp;nValor1=1&amp;nValor2=79730&amp;nValor3=100935&amp;strTipM=TC">Leer más</a><a href="#fnref6" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn7"><p>San José, 20 de febrero del 2024 MIDEPLAN-DM-OF-0277-2024 A: Directorio Legislativo, Jefaturas de Fracción, Asamblea Legislativa de Costa Rica Asunto: Opinión de MIDEPLAN sobre el Primer Debate del Proyecto de Ley N°22.643, “Creación del Cantón Colorado, Cantón Duodécimo de la Provincia de Guanacaste”. Disponible en: <a href="https://d1qqtien6gys07.cloudfront.net/wp-content/uploads/2024/02/MIDEPLAN-DM-OF-0277-2024-Reaccion-del-MIDEPLAN-respecto-a-la-aprobacion-en-Primer-Debate-del-Proyecto-de-Ley-22.643-firmado-sellado.pdf">enlace</a><a href="#fnref7" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn8"><p>Delfino.cr. (19 de febrero de 2024). Expediente 22643: Creación del Cantón Colorado, Cantón Duodécimo de la Provincia de Guanacaste. Delfino.cr. <a href="https://delfino.cr/asamblea/proyecto/22643">Leer más</a><a href="#fnref8" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reutilización</h2><div class="quarto-appendix-contents"><div>Este blog publica su contenido bajo la Licencia Creative Commons Atribución-NoComercial (CC BY-NC 4.0). Esta licencia permite a los usuarios copiar, redistribuir, remezclar, transformar y construir a partir  del material, siempre que reconozcan debidamente la autoría y no lo utilicen para fines comerciales.  No es necesario solicitar permisos adicionales para usos que estén permitidos bajo esta licencia, siempre y cuando se cumplan estas condiciones.
<a rel="license" href="https://creativecommons.org/licenses/by-nc/4.0/deed.es">(Ver Licencia)</a></div></div></section><section class="quarto-appendix-contents" id="quarto-copyright"><h2 class="anchored quarto-appendix-heading">Derechos de autor</h2><div class="quarto-appendix-contents"><div>Copyright Aprende Tidyverse. 2024. Todos los derechos reservados.</div></div></section><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Cómo citar</h2><div><div class="quarto-appendix-secondary-label">BibTeX</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{aguero2024,
  author = {Aguero, Carlos},
  title = {Actualizando el mapa de cantones de Costa Rica con R},
  date = {2024-02-08},
  url = {https://aprendetidyverse.com/posts/001_mapa_cantones_cr.html},
  langid = {es}
}
</code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre><div class="quarto-appendix-secondary-label">Por favor, cita este trabajo como:</div><div id="ref-aguero2024" class="csl-entry quarto-appendix-citeas" role="listitem">
Aguero, Carlos. 2024. <span>“Actualizando el mapa de cantones de Costa
Rica con R.”</span> February 8, 2024. <a href="https://aprendetidyverse.com/posts/001_mapa_cantones_cr.html">https://aprendetidyverse.com/posts/001_mapa_cantones_cr.html</a>.
</div></div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copiado");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copiado");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/aprendetidyverse\.com");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<script src="https://utteranc.es/client.js" repo="quarto-dev/quarto-docs" issue-term="pathname" theme="github-light" crossorigin="anonymous" async="">
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Contenido <i class="fa-brands fa-creative-commons" aria-label="creative-commons"></i> 2024 por Aprende Tidyverse<br> Todo el contenido está licenciado bajo una Licencia Internacional Creative Commons Atribución-NoComercial 4.0 (CC BY-NC 4.0).</p>
</div>   
    <div class="nav-footer-center">

<div class="cookie-consent-footer"><a href="#" id="open_preferences_center">Cookie Preferences</a></div></div>
    <div class="nav-footer-right">
<p>Hecho con <i class="fa-brands fa-r-project" aria-label="r-project"></i> y <a href="https://quarto.org/">Quarto</a><br> <a href="https://github.com/aguerodev/aguerodev.github.io">Revisa el código fuente en <i class="fa-brands fa-github" aria-label="github"></i> GitHub</a></p>
</div>
  </div>
</footer>




</body></html>