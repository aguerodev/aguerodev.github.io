<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="es" xml:lang="es"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Carlos Agüero B">
<meta name="description" content="En este post aprenderemos cómo automatizar desde R la descarga, unificación y limpieza de datos sobre delitos en Costa Rica, obtenidos desde la plataforma del Poder Judicial.">

<title>Automatización de la descarga de datos de delitos en Costa Rica – Aprende Tidyverse</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../favicon.ico" rel="icon">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-abf7f27472d8b8900bc5088ecf17f93b.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-ff707baca8e29db79693c16bf0841941.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/quarto-contrib/fontawesome6-0.1.0/all.css" rel="stylesheet">
<link href="../site_libs/quarto-contrib/fontawesome6-0.1.0/latex-fontsize.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "Sin resultados",
    "search-matching-documents-text": "documentos encontrados",
    "search-copy-link-title": "Copiar el enlace en la búsqueda",
    "search-hide-matches-text": "Ocultar resultados adicionales",
    "search-more-match-text": "resultado adicional en este documento",
    "search-more-matches-text": "resultados adicionales en este documento",
    "search-clear-button-title": "Borrar",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancelar",
    "search-submit-button-title": "Enviar",
    "search-label": "Buscar"
  }
}</script>


<meta property="og:title" content="Automatización de la descarga de datos de delitos en Costa Rica">
<meta property="og:description" content="En este post aprenderemos cómo automatizar desde R la descarga, unificación y limpieza de datos sobre delitos en Costa Rica, obtenidos desde la plataforma del Poder Judicial.">
<meta property="og:image" content="https://aprendetidyverse.com/posts/images/oij.png">
<meta property="og:site_name" content="aprendetidyverse.com">
<meta property="og:locale" content="es_ES">
<meta property="og:image:height" content="968">
<meta property="og:image:width" content="1916">
<meta name="twitter:title" content="Automatización de la descarga de datos de delitos en Costa Rica">
<meta name="twitter:description" content="En este post aprenderemos cómo automatizar desde R la descarga, unificación y limpieza de datos sobre delitos en Costa Rica, obtenidos desde la plataforma del Poder Judicial.">
<meta name="twitter:image" content="https://aprendetidyverse.com/posts/images/oij.png">
<meta name="twitter:creator" content="@dev_aguero">
<meta name="twitter:site" content="@dev_aguero">
<meta name="twitter:image-height" content="968">
<meta name="twitter:image-width" content="1916">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../images/logo.png" alt="" class="navbar-logo">
    </a>
  </div>
            <div id="quarto-search" class="" title="Buscar"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Navegación de palanca" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html"> 
<span class="menu-text">Inicio</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-cursos" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Cursos</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-cursos">    
        <li class="dropdown-header">Programa de completo 5 cursos</li>
        <li>
    <a class="dropdown-item" href="../courses/fundamentos_R.html"><i class="bi bi-laptop" role="img">
</i> 
 <span class="dropdown-text">Fundamentos de R y Rstudio</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../courses/visualizacion_datos_R.html"><i class="bi bi-palette" role="img">
</i> 
 <span class="dropdown-text">Visualización de datos con R</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../courses/manipulacion_datos_R.html"><i class="bi bi-tools" role="img">
</i> 
 <span class="dropdown-text">Limpieza y Manipulación de datos con R</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../courses/introduccion_sql.html"><i class="bi bi-database" role="img">
</i> 
 <span class="dropdown-text">Introducción a SQL y su integración con R</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../courses/web_scraping.html"><i class="bi bi-globe" role="img">
</i> 
 <span class="dropdown-text">Web Scraping y Automatización con R</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="../posts.html"> 
<span class="menu-text">Blog</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/dev_aguero"> <i class="bi bi-twitter" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.instagram.com/aprende.tidyverse/"> <i class="bi bi-instagram" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.facebook.com/aprende.tidyverse"> <i class="bi bi-facebook" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/carlos-aguero-cr/"> <i class="bi bi-linkedin" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">En esta página</h2>
   
  <ul>
  <li><a href="#introducción-por-qué-hacer-esto" id="toc-introducción-por-qué-hacer-esto" class="nav-link active" data-scroll-target="#introducción-por-qué-hacer-esto">Introducción: ¿Por qué hacer esto?</a></li>
  <li><a href="#automatizar-la-descarga" id="toc-automatizar-la-descarga" class="nav-link" data-scroll-target="#automatizar-la-descarga">Automatizar la descarga</a>
  <ul class="collapse">
  <li><a href="#selenider-en-1-minuto" id="toc-selenider-en-1-minuto" class="nav-link" data-scroll-target="#selenider-en-1-minuto">Selenider en 1 minuto:</a></li>
  </ul></li>
  <li><a href="#problemas-con-el-archivo-descargado" id="toc-problemas-con-el-archivo-descargado" class="nav-link" data-scroll-target="#problemas-con-el-archivo-descargado">Problemas con el archivo descargado 😢</a></li>
  <li><a href="#limpieza-y-normalización-de-los-datos" id="toc-limpieza-y-normalización-de-los-datos" class="nav-link" data-scroll-target="#limpieza-y-normalización-de-los-datos">Limpieza y normalización de los datos</a></li>
  <li><a href="#y-ahora-qué" id="toc-y-ahora-qué" class="nav-link" data-scroll-target="#y-ahora-qué">¿Y ahora qué?</a></li>
  </ul>
</nav>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Automatización de la descarga de datos de delitos en Costa Rica</h1>
  </div>

<div>
  <div class="description">
    En este post aprenderemos cómo automatizar desde R la descarga, unificación y limpieza de datos sobre delitos en Costa Rica, obtenidos desde la plataforma del Poder Judicial.
  </div>
</div>

<div class="quarto-title-meta-author">
  <div class="quarto-title-meta-heading">Autor/a</div>
  <div class="quarto-title-meta-heading">Afiliación</div>
  
    <div class="quarto-title-meta-contents">
    <p class="author">Carlos Agüero B </p>
  </div>
  <div class="quarto-title-meta-contents">
        <p class="affiliation">
            <a href="https://aprendetidyverse.com/">
            Aprende Tidyverse
            </a>
          </p>
      </div>
  </div>

<div class="quarto-title-meta">

      
    <div>
    <div class="quarto-title-meta-heading">Fecha de publicación</div>
    <div class="quarto-title-meta-contents">
      <p class="date">4 de marzo de 2025</p>
    </div>
  </div>
  
    <div>
    <div class="quarto-title-meta-heading">Fecha de modificación</div>
    <div class="quarto-title-meta-contents">
      <p class="date-modified">4 de marzo de 2025</p>
    </div>
  </div>
    
  </div>
  


</header>


<meta property="og:title" content="Automatización de la descarga de datos de delitos en Costa Rica">
<meta property="og:description" content="En este post aprenderemos cómo automatizar desde R la descarga, unificación y limpieza de datos sobre delitos en Costa Rica, obtenidos desde la plataforma del Poder Judicial.">
<meta property="og:type" content="video.other">
<meta property="og:url" content="https://aprendetidyverse.com/automatizacion-delitos">
<meta property="og:image" content="https://aprendetidyverse.com/images/oij.png">
<meta property="og:site_name" content="Aprende Tidyverse">
<meta property="og:locale" content="es_ES">
<meta property="article:published_time" content="2025-03-04T00:00:00+00:00">
<meta property="article:modified_time" content="2025-03-04T00:00:00+00:00">
<!-- Open Graph Video Preview -->
<meta property="og:video" content="https://player.vimeo.com/video/710119524?badge=0&amp;autopause=0&amp;player_id=0&amp;app_id=58479">
<meta property="og:video:secure_url" content="https://player.vimeo.com/video/710119524?badge=0&amp;autopause=0&amp;player_id=0&amp;app_id=58479">
<meta property="og:video:type" content="text/html">
<meta property="og:video:width" content="1280">
<meta property="og:video:height" content="720">
<section id="introducción-por-qué-hacer-esto" class="level2">
<h2 class="anchored" data-anchor-id="introducción-por-qué-hacer-esto">Introducción: ¿Por qué hacer esto?</h2>
<p>Todos los días escuchamos en las noticias acerca del incremento en los homicidios y la inseguridad en Costa Rica. Por un lado, la dice que la inseguridad está fatal, por otro, algunos sostienen que “es solo percepción” y que “se matan entre ellos” (refiriéndose a los delincuentes). Entre tantos <em>dimes y diretes</em>, creo que este extracto del libro la sociedad del cansancio representa cómo nos podemos sentir.</p>
<blockquote class="blockquote">
<p>En la era digital, el exceso de información nos satura hasta el punto de la apatía; el bombardeo constante de datos nos impide distinguir lo esencial y nos sumerge en un estado de desconfianza generalizada. <span class="citation" data-cites="han2012">Han (<a href="#ref-han2012" role="doc-biblioref">2012</a>)</span></p>
</blockquote>
<p>Veamos algunos de esas noticias:</p>
<br>
<div class="iframely-embed">
<div class="iframely-responsive" style="height: 140px; padding-bottom: 0;">
<a href="https://semanariouniversidad.com/pais/con-880-homicidios-2024-cerro-como-el-segundo-ano-mas-violento-de-la-historia/" data-iframely-url="//cdn.iframe.ly/api/iframe?card=small&amp;url=http%3A%2F%2Fsemanariouniversidad.com%2Fpais%2Fcon-880-homicidios-2024-cerro-como-el-segundo-ano-mas-violento-de-la-historia%2F&amp;key=82791205449a6b87420b0f7a75017b28"></a>
</div>
</div>
<script async="" src="//cdn.iframe.ly/embed.js" charset="utf-8"></script>
<br> <iframe style="border-radius:12px" src="https://open.spotify.com/embed/episode/08JtqQzvLNuXolKz4gm4oF?utm_source=generator" width="100%" height="152" frameborder="0" allowfullscreen="" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" loading="lazy"></iframe> <br> <br>
<div class="iframely-embed">
<div class="iframely-responsive" style="height: 140px; padding-bottom: 0;">
<a href="https://www.nacion.com/sucesos/crimenes/costa-rica-supera-100-homicidios-en-apenas-42-dias/4IYB2XIVJVHJDDLVONXBPHJR7E/story/" data-iframely-url="//cdn.iframe.ly/api/iframe?card=small&amp;url=https%3A%2F%2Fwww.nacion.com%2Fsucesos%2Fcrimenes%2Fcosta-rica-supera-100-homicidios-en-apenas-42-dias%2F4IYB2XIVJVHJDDLVONXBPHJR7E%2Fstory%2F&amp;key=82791205449a6b87420b0f7a75017b28"></a>
</div>
</div>
<script async="" src="//cdn.iframe.ly/embed.js" charset="utf-8"></script>
<p><br></p>
<p>Creo que es fundamental que, como ciudadanos, tengamos acceso a la información para que podamos comprobar de manera independiente los datos que nos bombardean desde todas partes. No me malentiendan, no se trata de negar las instituciones ni de estar en contra de la prensa, para nada, sino de poder, dentro de lo posible, acceder a las fuentes y echar un vistazo a lo que pasa en el país, incluso más como un ejercicio de empatía que informativo.</p>
<p>Con esa idea en mente, surge este mini tutorial, en el cual mostraré, paso a paso, cómo utilizar R para descargar y unificar la información proporcionada por el <a href="https://pjenlinea3.poder-judicial.go.cr/estadisticasoij/">Poder Judicial</a>.</p>
</section>
<section id="automatizar-la-descarga" class="level2">
<h2 class="anchored" data-anchor-id="automatizar-la-descarga">Automatizar la descarga</h2>
<p>El primer problema se presentó cuando noté que la <a href="https://pjenlinea3.poder-judicial.go.cr/estadisticasoij/">plataforma</a> solo permite descargar los datos un año a la vez (o al menos a mí me da error si intento descargar varios años juntos). Hacerlo manualmente para 10 años no era mi opción preferida. Soy de ese tipo de persona que prefiere pasar dos horas automatizando una tarea que podría hacerse en 15 minutos manualmente. Eso debe tener un nombre o, como mínimo, estar tipificado en el DSM-5.</p>
<p>Para lograr esto, vamos a utilizar los paquetes <a href="https://ashbythorpe.github.io/selenider/index.html">selenider</a> y <a href="https://rstudio.github.io/chromote/">chromote</a>, una combinación que he venido probando desde hace poco con muy buenos resultados, nos permite hacer web scraping de forma sencilla y, además, resuelve muchos de los problemas que teníamos al trabajar con <a href="https://docs.ropensci.org/RSelenium/">RSelenium</a>.</p>
<section id="selenider-en-1-minuto" class="level3">
<h3 class="anchored" data-anchor-id="selenider-en-1-minuto">Selenider en 1 minuto:</h3>
<ol type="1">
<li>Levantas una sesión que controla el navegador por defecto, Chrome.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="fu">library</span>(selenider)</span>
<span id="cb1-2"><a href="#cb1-2"></a></span>
<span id="cb1-3"><a href="#cb1-3"></a>session <span class="ot">&lt;-</span> <span class="fu">selenider_session</span>(</span>
<span id="cb1-4"><a href="#cb1-4"></a>  <span class="st">"chromote"</span>,</span>
<span id="cb1-5"><a href="#cb1-5"></a>  <span class="at">timeout =</span> <span class="dv">10</span>,</span>
<span id="cb1-6"><a href="#cb1-6"></a>  <span class="at">options =</span> <span class="fu">chromote_options</span>(<span class="at">headless =</span> <span class="cn">FALSE</span>)</span>
<span id="cb1-7"><a href="#cb1-7"></a>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="2" type="1">
<li>Abrir una url</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a><span class="fu">open_url</span>(<span class="st">"https://www.r-project.org/"</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="3" type="1">
<li>Seleccionas elementos de la web usando CSS o XPath.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a><span class="co"># selecciona los elementos con el id css rStudioHeader</span></span>
<span id="cb3-2"><a href="#cb3-2"></a>header <span class="ot">&lt;-</span> <span class="fu">s</span>(<span class="st">"#rStudioHeader"</span>) </span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="3" type="1">
<li>Realizas acciones como clic, llenar información, hacer scroll, etc.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a><span class="fu">s</span>(<span class="st">".claseBoton"</span>) <span class="sc">|&gt;</span></span>
<span id="cb4-2"><a href="#cb4-2"></a>  <span class="fu">elem_click</span>()</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol type="1">
<li><code>elem_click()</code></li>
</ol>
<p>Realiza un clic en el elemento especificado.</p>
<ol start="2" type="1">
<li><code>elem_right_click()</code></li>
</ol>
<p>Ejecuta un clic derecho sobre el elemento.</p>
<ol start="3" type="1">
<li><code>elem_double_click()</code></li>
</ol>
<p>Realiza un doble clic en el elemento.</p>
<ol start="4" type="1">
<li><code>elem_hover()</code></li>
</ol>
<p>Posiciona el cursor sobre el elemento, simulando la acción de pasar el mouse por encima.</p>
<ol start="5" type="1">
<li><code>elem_scroll_to()</code></li>
</ol>
<p>Desplaza la vista hasta el elemento indicado, lo cual es útil si el elemento no está visible antes de realizar un clic o interacción.</p>
<p>Veamos cómo es el proceso manual para identificar qué es lo que debemos automatizar:</p>
<ol type="1">
<li>Indicar las fechas de inicio y fin.</li>
</ol>
<p><img src="images/fechas_oij.png" class="img-fluid" style="width:35.0%"></p>
<ol start="2" type="1">
<li>Indicar el lugar del suceso.</li>
</ol>
<p><img src="images/lugar_suceso.png" class="img-fluid" style="width:35.0%"></p>
<ol start="3" type="1">
<li>Seleccionar la categoría delictiva.</li>
</ol>
<p><img src="images/categoria_delictiva.png" class="img-fluid" style="width:35.0%"></p>
<ol start="4" type="1">
<li>Indicar si se trata de víctima policial.</li>
</ol>
<p><img src="images/victima_policial.png" class="img-fluid" style="width:35.0%"></p>
<ol start="5" type="1">
<li>Hacer clic en el botón de descargar Excel.</li>
</ol>
<p><img src="images/guardar_excel.png" class="img-fluid" style="width:35.0%"></p>
<blockquote class="blockquote">
<p>Acá me quedé pegado en un buen rato intentando como explicar el código, y llegué a la conclusión de que lo más razonable es un video corto.</p>
</blockquote>
<div style="padding:56.25% 0 0 0;position:relative;">
<iframe src="https://player.vimeo.com/video/710119524?badge=0&amp;autopause=0&amp;player_id=0&amp;app_id=58479" frameborder="0" allow="autoplay; fullscreen; picture-in-picture; clipboard-write; encrypted-media" style="position:absolute;top:0;left:0;width:100%;height:100%;" title="The Art of Work">
</iframe>
</div>
<script src="https://player.vimeo.com/api/player.js"></script>
<hr>
<div class="cell">
<details class="code-fold">
<summary>Puedes ver el código completo acá.</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a><span class="fu">library</span>(rvest)</span>
<span id="cb5-2"><a href="#cb5-2"></a><span class="fu">library</span>(selenider)</span>
<span id="cb5-3"><a href="#cb5-3"></a><span class="fu">library</span>(lubridate)</span>
<span id="cb5-4"><a href="#cb5-4"></a><span class="fu">library</span>(fs)</span>
<span id="cb5-5"><a href="#cb5-5"></a><span class="fu">library</span>(purrr)</span>
<span id="cb5-6"><a href="#cb5-6"></a><span class="fu">library</span>(janitor)</span>
<span id="cb5-7"><a href="#cb5-7"></a><span class="fu">library</span>(glue)</span>
<span id="cb5-8"><a href="#cb5-8"></a><span class="fu">library</span>(chromote)</span>
<span id="cb5-9"><a href="#cb5-9"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb5-10"><a href="#cb5-10"></a><span class="fu">library</span>(readr)</span>
<span id="cb5-11"><a href="#cb5-11"></a><span class="fu">library</span>(stringr)</span>
<span id="cb5-12"><a href="#cb5-12"></a></span>
<span id="cb5-13"><a href="#cb5-13"></a>wait_for_download <span class="ot">&lt;-</span> <span class="cf">function</span>(download_dir, filename, <span class="at">timeout =</span> <span class="dv">60</span>) {</span>
<span id="cb5-14"><a href="#cb5-14"></a>  start_time <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>()</span>
<span id="cb5-15"><a href="#cb5-15"></a>  file_path <span class="ot">&lt;-</span> <span class="fu">file.path</span>(download_dir, filename)</span>
<span id="cb5-16"><a href="#cb5-16"></a>  <span class="cf">while</span> (</span>
<span id="cb5-17"><a href="#cb5-17"></a>    <span class="fu">as.numeric</span>(<span class="fu">difftime</span>(<span class="fu">Sys.time</span>(), start_time, <span class="at">units =</span> <span class="st">"secs"</span>)) <span class="sc">&lt;=</span> timeout</span>
<span id="cb5-18"><a href="#cb5-18"></a>  ) {</span>
<span id="cb5-19"><a href="#cb5-19"></a>    <span class="cf">if</span> (</span>
<span id="cb5-20"><a href="#cb5-20"></a>      <span class="fu">file.exists</span>(file_path) <span class="sc">&amp;&amp;</span></span>
<span id="cb5-21"><a href="#cb5-21"></a>        <span class="fu">length</span>(<span class="fu">list.files</span>(download_dir, <span class="at">pattern =</span> <span class="st">"</span><span class="sc">\\</span><span class="st">.crdownload$"</span>)) <span class="sc">==</span> <span class="dv">0</span></span>
<span id="cb5-22"><a href="#cb5-22"></a>    ) {</span>
<span id="cb5-23"><a href="#cb5-23"></a>      <span class="fu">return</span>(<span class="cn">TRUE</span>)</span>
<span id="cb5-24"><a href="#cb5-24"></a>    }</span>
<span id="cb5-25"><a href="#cb5-25"></a>    <span class="fu">Sys.sleep</span>(<span class="dv">1</span>)</span>
<span id="cb5-26"><a href="#cb5-26"></a>  }</span>
<span id="cb5-27"><a href="#cb5-27"></a>  cli<span class="sc">::</span><span class="fu">cli_abort</span>(<span class="st">"Se acabó el tiempo de espera"</span>)</span>
<span id="cb5-28"><a href="#cb5-28"></a>}</span>
<span id="cb5-29"><a href="#cb5-29"></a></span>
<span id="cb5-30"><a href="#cb5-30"></a>download_dataset_pj <span class="ot">&lt;-</span> <span class="cf">function</span>(</span>
<span id="cb5-31"><a href="#cb5-31"></a>  <span class="at">date =</span> lubridate<span class="sc">::</span><span class="fu">today</span>(),</span>
<span id="cb5-32"><a href="#cb5-32"></a>  <span class="at">download_dir =</span> <span class="st">"data"</span>,</span>
<span id="cb5-33"><a href="#cb5-33"></a>  <span class="at">filename =</span> <span class="st">"Estadisticas.xls"</span></span>
<span id="cb5-34"><a href="#cb5-34"></a>) {</span>
<span id="cb5-35"><a href="#cb5-35"></a>  <span class="fu">dir.create</span>(download_dir, <span class="at">showWarnings =</span> <span class="cn">FALSE</span>, <span class="at">recursive =</span> <span class="cn">TRUE</span>)</span>
<span id="cb5-36"><a href="#cb5-36"></a>  full_path <span class="ot">&lt;-</span> <span class="fu">file.path</span>(download_dir, filename)</span>
<span id="cb5-37"><a href="#cb5-37"></a></span>
<span id="cb5-38"><a href="#cb5-38"></a>  session <span class="ot">&lt;-</span> <span class="fu">selenider_session</span>(</span>
<span id="cb5-39"><a href="#cb5-39"></a>    <span class="st">"chromote"</span>,</span>
<span id="cb5-40"><a href="#cb5-40"></a>    <span class="at">timeout =</span> <span class="dv">10</span>,</span>
<span id="cb5-41"><a href="#cb5-41"></a>    <span class="at">options =</span> <span class="fu">chromote_options</span>(<span class="at">headless =</span> <span class="cn">TRUE</span>)</span>
<span id="cb5-42"><a href="#cb5-42"></a>  )</span>
<span id="cb5-43"><a href="#cb5-43"></a>  session<span class="sc">$</span>driver<span class="sc">$</span>Browser<span class="sc">$</span><span class="fu">setDownloadBehavior</span>(</span>
<span id="cb5-44"><a href="#cb5-44"></a>    <span class="at">behavior =</span> <span class="st">"allow"</span>,</span>
<span id="cb5-45"><a href="#cb5-45"></a>    <span class="at">downloadPath =</span> <span class="fu">normalizePath</span>(download_dir)</span>
<span id="cb5-46"><a href="#cb5-46"></a>  )</span>
<span id="cb5-47"><a href="#cb5-47"></a></span>
<span id="cb5-48"><a href="#cb5-48"></a>  <span class="fu">open_url</span>(<span class="st">"https://pjenlinea3.poder-judicial.go.cr/estadisticasoij/"</span>)</span>
<span id="cb5-49"><a href="#cb5-49"></a></span>
<span id="cb5-50"><a href="#cb5-50"></a>  start_date <span class="ot">&lt;-</span> <span class="fu">format</span>(date, <span class="st">"%d/%m/%Y"</span>)</span>
<span id="cb5-51"><a href="#cb5-51"></a>  end_date <span class="ot">&lt;-</span> <span class="fu">update</span>(date, <span class="at">month =</span> <span class="dv">12</span>, <span class="at">day =</span> <span class="dv">31</span>)</span>
<span id="cb5-52"><a href="#cb5-52"></a>  end_date <span class="ot">&lt;-</span> <span class="fu">if_else</span>(end_date <span class="sc">&gt;</span> <span class="fu">today</span>(), <span class="fu">today</span>(), end_date)</span>
<span id="cb5-53"><a href="#cb5-53"></a>  end_date <span class="ot">&lt;-</span> <span class="fu">format</span>(end_date, <span class="st">"%d/%m/%Y"</span>)</span>
<span id="cb5-54"><a href="#cb5-54"></a></span>
<span id="cb5-55"><a href="#cb5-55"></a>  <span class="fu">execute_js_expr</span>(</span>
<span id="cb5-56"><a href="#cb5-56"></a>    <span class="st">"document.getElementById('txtFechaFinal').removeAttribute('readonly',0);"</span></span>
<span id="cb5-57"><a href="#cb5-57"></a>  )</span>
<span id="cb5-58"><a href="#cb5-58"></a>  <span class="fu">execute_js_expr</span>(<span class="fu">glue</span>(</span>
<span id="cb5-59"><a href="#cb5-59"></a>    <span class="st">"document.getElementById('txtFechaFinal').value = '{end_date}';"</span>,</span>
<span id="cb5-60"><a href="#cb5-60"></a>  ))</span>
<span id="cb5-61"><a href="#cb5-61"></a></span>
<span id="cb5-62"><a href="#cb5-62"></a>  <span class="fu">execute_js_expr</span>(</span>
<span id="cb5-63"><a href="#cb5-63"></a>    <span class="st">"document.getElementById('txtFechaInicio').removeAttribute('readonly',0);"</span></span>
<span id="cb5-64"><a href="#cb5-64"></a>  )</span>
<span id="cb5-65"><a href="#cb5-65"></a>  <span class="fu">execute_js_expr</span>(<span class="fu">glue</span>(</span>
<span id="cb5-66"><a href="#cb5-66"></a>    <span class="st">"document.getElementById('txtFechaInicio').value = '{start_date}';"</span>,</span>
<span id="cb5-67"><a href="#cb5-67"></a>  ))</span>
<span id="cb5-68"><a href="#cb5-68"></a></span>
<span id="cb5-69"><a href="#cb5-69"></a>  <span class="fu">execute_js_expr</span>(<span class="st">"document.getElementById('chbTodoPais').click();"</span>)</span>
<span id="cb5-70"><a href="#cb5-70"></a>  <span class="fu">execute_js_expr</span>(<span class="st">"document.getElementById('chbTodoDelitos').click();"</span>)</span>
<span id="cb5-71"><a href="#cb5-71"></a>  <span class="fu">execute_js_expr</span>(<span class="st">"document.getElementById('chbTodaVictima').click();"</span>)</span>
<span id="cb5-72"><a href="#cb5-72"></a></span>
<span id="cb5-73"><a href="#cb5-73"></a>  <span class="fu">execute_js_expr</span>(<span class="st">"document.getElementById('btnExcel').click();"</span>)</span>
<span id="cb5-74"><a href="#cb5-74"></a></span>
<span id="cb5-75"><a href="#cb5-75"></a>  <span class="fu">wait_for_download</span>(download_dir, filename)</span>
<span id="cb5-76"><a href="#cb5-76"></a></span>
<span id="cb5-77"><a href="#cb5-77"></a>  new_filename <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"delitos_"</span>, <span class="fu">format</span>(date, <span class="st">"%Y-%m-%d"</span>), <span class="st">".html"</span>)</span>
<span id="cb5-78"><a href="#cb5-78"></a>  new_path <span class="ot">&lt;-</span> <span class="fu">file.path</span>(download_dir, new_filename)</span>
<span id="cb5-79"><a href="#cb5-79"></a>  fs<span class="sc">::</span><span class="fu">file_move</span>(full_path, new_path)</span>
<span id="cb5-80"><a href="#cb5-80"></a></span>
<span id="cb5-81"><a href="#cb5-81"></a>  <span class="fu">return</span>(new_path)</span>
<span id="cb5-82"><a href="#cb5-82"></a>}</span>
<span id="cb5-83"><a href="#cb5-83"></a></span>
<span id="cb5-84"><a href="#cb5-84"></a>.years <span class="ot">&lt;-</span> <span class="fu">ymd</span>(<span class="st">"2025-01-01"</span>) <span class="sc">-</span> <span class="fu">years</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">11</span>)</span>
<span id="cb5-85"><a href="#cb5-85"></a></span>
<span id="cb5-86"><a href="#cb5-86"></a>df <span class="ot">&lt;-</span> <span class="fu">map</span>(</span>
<span id="cb5-87"><a href="#cb5-87"></a>  .years,</span>
<span id="cb5-88"><a href="#cb5-88"></a>  \(x) {</span>
<span id="cb5-89"><a href="#cb5-89"></a>    .file <span class="ot">&lt;-</span> <span class="fu">download_dataset_pj</span>(<span class="at">date =</span> x)</span>
<span id="cb5-90"><a href="#cb5-90"></a>    df <span class="ot">&lt;-</span> <span class="fu">read_html</span>(.file) <span class="sc">|&gt;</span></span>
<span id="cb5-91"><a href="#cb5-91"></a>      <span class="fu">html_table</span>()</span>
<span id="cb5-92"><a href="#cb5-92"></a>    df <span class="ot">&lt;-</span> df[[<span class="dv">1</span>]]</span>
<span id="cb5-93"><a href="#cb5-93"></a>    <span class="fu">return</span>(df)</span>
<span id="cb5-94"><a href="#cb5-94"></a>  },</span>
<span id="cb5-95"><a href="#cb5-95"></a>  <span class="at">.progress =</span> <span class="cn">TRUE</span></span>
<span id="cb5-96"><a href="#cb5-96"></a>) <span class="sc">|&gt;</span></span>
<span id="cb5-97"><a href="#cb5-97"></a>  <span class="fu">list_rbind</span>()</span>
<span id="cb5-98"><a href="#cb5-98"></a></span>
<span id="cb5-99"><a href="#cb5-99"></a>df <span class="sc">|&gt;</span></span>
<span id="cb5-100"><a href="#cb5-100"></a>  <span class="fu">clean_names</span>() <span class="sc">|&gt;</span></span>
<span id="cb5-101"><a href="#cb5-101"></a>  <span class="fu">mutate</span>(</span>
<span id="cb5-102"><a href="#cb5-102"></a>    <span class="fu">across</span>(<span class="fu">where</span>(is.character), str_to_title),</span>
<span id="cb5-103"><a href="#cb5-103"></a>    <span class="at">fecha =</span> <span class="fu">ymd</span>(fecha)</span>
<span id="cb5-104"><a href="#cb5-104"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb5-105"><a href="#cb5-105"></a>  readr<span class="sc">::</span><span class="fu">write_rds</span>(<span class="fu">glue</span>(<span class="st">"data/delitos_{today()}.rds"</span>))</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="problemas-con-el-archivo-descargado" class="level2">
<h2 class="anchored" data-anchor-id="problemas-con-el-archivo-descargado">Problemas con el archivo descargado 😢</h2>
<p>Luego de hacer la descarga apareció un problema. Al intentar abrir el archivo desde R, me encontré con un error, el archivo parecía corrupto o mal formateado. Era raro, porque si abría el archivo directamente desde Excel, todo funcionaba bien.</p>
<p>Revisando el código fuente de la web, pude encontrar que el archivo se genera a partir de una tabla <code>HTML</code> que se codifica en <code>Base64</code>, asignándole la extensión <code>.xls</code> y un MIME type de Excel <em>(Excel viejito).</em> Esto quiere decir que, aunque se pretende que sea un archivo de Excel, el contenido real es HTML y no el formato binario nativo de Excel (xls). Excel, que siempre que puede resuelve, logra detectar ese contenido y mostrar la tabla correctamente, pero el paquete <code>readxl</code>, que utiliza la librería <code>libxls</code>, requiere específicamente el formato binario de Excel para poder abrirlo. Por eso, al intentar abrirlo en R se produce el error <em>libxls error: Unable to open file</em>, porque, <strong>sorpresa, ¡no es un archivo de Excel!</strong></p>
<p>La solución fue sencilla, si se trata de un archivo <code>HTML</code>, basta con cambiarle la extensión de <code>.xls</code> a <code>.html</code> y usar la función <code>read_html</code> del paquete <code>rvest</code>. Una vez resuelto esto, quedó completamente automatizado el proceso de descarga de 10 años de registros en un clic.</p>
</section>
<section id="limpieza-y-normalización-de-los-datos" class="level2">
<h2 class="anchored" data-anchor-id="limpieza-y-normalización-de-los-datos">Limpieza y normalización de los datos</h2>
<p>A partir de aquí, el trabajo de limpieza es muy corto. Se normalizan los nombres de las columnas y, además, se ajustan las variables de tipo texto para evitar tenerlas únicamente en mayúsculas.</p>
<p>Aquí, alguien podría preguntarse: ¿por qué, entonces, no descargar directamente el archivo <code>.csv</code> y listo? Pasa que, por algún motivo, al archivo <code>CSV</code> le falta la columna <code>distrito</code>. Asumo que está relacionado con la forma en que se genera a partir de la tabla HTML original, pero, la verdad, no lo investigué.</p>
<p>Puedes descargar los datos en el siguiente enlace <a href="../data/delitos_2025-03-03.zip">descargar datos</a></p>
</section>
<section id="y-ahora-qué" class="level2">
<h2 class="anchored" data-anchor-id="y-ahora-qué">¿Y ahora qué?</h2>
<p>Esta sería la primera parte del trabajo. Ahora que tenemos los datos, estamos listos para realizar un análisis. En el siguiente post hablaremos sobre el tema de los homicidios en Costa Rica, su evolución, y podremos salir de la duda que inició todo: ¿es realmente el aumento de la inseguridad solo un tema de percepción (como hace un tiempo decía un ministro en un podcast) Spoiler:</p>
<p><img src="https://mystickermania.com/cdn/stickers/memes/bugs-bunnys-no-meme-512x512.png" class="img-fluid" style="width:35.0%"></p>
<p>Finalmente, un reconocimiento especial al Poder Judicial por el esfuerzo y la transparencia de poner estos datos a disposición de la ciudadanía, sin embargo, es importante mencionar que la plataforma todavía tiene puntos destacables de mejora.</p>
<p>¡Nos vemos en ese próximo post!</p>



</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">Referencias</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-han2012" class="csl-entry" role="listitem">
Han, Byung-Chul. 2012. <em>La sociedad del cansancio</em>. Barcelona: Herder Editorial.
</div>
</div></section><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Cómo citar</h2><div><div class="quarto-appendix-secondary-label">BibTeX</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{agüero_b2025,
  author = {Agüero B, Carlos},
  title = {Automatización de la descarga de datos de delitos en Costa
    Rica},
  date = {2025-03-04},
  url = {https://aprendetidyverse.com/posts/003_descargar_delitos_costarica.html},
  langid = {es}
}
</code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre><div class="quarto-appendix-secondary-label">Por favor, cita este trabajo como:</div><div id="ref-agüero_b2025" class="csl-entry quarto-appendix-citeas" role="listitem">
Agüero B, Carlos. 2025. <span>“Automatización de la descarga de datos de
delitos en Costa Rica.”</span> March 4, 2025. <a href="https://aprendetidyverse.com/posts/003_descargar_delitos_costarica.html">https://aprendetidyverse.com/posts/003_descargar_delitos_costarica.html</a>.
</div></div></section></div></main> <!-- /main -->
<script defer="" data-domain="aprendetidyverse.com" src="https://rstudio-plausible.n5hlxm.easypanel.host/js/script.js"></script>
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copiado");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copiado");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/aprendetidyverse\.com");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Contenido <i class="fa-brands fa-creative-commons" aria-label="creative-commons"></i> 2024 por Aprende Tidyverse<br> Todo el contenido está licenciado bajo una Licencia Internacional Creative Commons Atribución-NoComercial 4.0 (<a href="https://creativecommons.org/licenses/by-nc/4.0/deed.es">CC BY-NC 4.0</a>).</p>
</div>   
    <div class="nav-footer-center">
      <ul class="footer-items list-unstyled">
    <li class="nav-item">
    <a class="nav-link" href="../terminos.html">
<p>Términos y Condiciones</p>
</a>
  </li>  
    <li class="nav-item">
    <a class="nav-link" href="../codigo_conducta.html">
<p>Código de conducta</p>
</a>
  </li>  
</ul>
    </div>
    <div class="nav-footer-right">
<p>Hecho con <i class="fa-solid fa-heart" aria-label="heart"></i> desde Costa Rica usando <i class="fa-brands fa-r-project" aria-label="r-project"></i> y <a href="https://quarto.org/">Quarto</a><br> <a href="https://github.com/aguerodev/aguerodev.github.io">Revisa el código fuente en <i class="fa-brands fa-github" aria-label="github"></i> GitHub</a></p>
</div>
  </div>
</footer>




</body></html>