[
  {
    "objectID": "posts/002_custom_legend_ggplot2.html",
    "href": "posts/002_custom_legend_ggplot2.html",
    "title": "Creando leyendas personalizadas en ggplot2",
    "section": "",
    "text": "Hola a todos!! una pequeña advertencia: este documento aún está en construcción. Puedes intentar utilizarlo, pero ten en cuenta que algunas cosas aún podrían no funcionar bien. Recomiendo esperar a la versión final.\n\n\n\n\nlibrary(ggplot2)\nlibrary(grid)\nlibrary(ggh4x)\nlibrary(ggrepel)\nlibrary(colorspace)\n\n\ncirculos &lt;- circleGrob(\n  r = 0.07,\n  x = c(0.5, 0.35),\n  y = c(0.5,0.5),\n  gp = gpar(lwd = 1)\n)\n\nlineas &lt;- segmentsGrob(\n  x0 = c(0.5,0.35),\n  x1 = c(0.5,0.35),\n  y0 = c(0.35,0.65),\n  y1 = c(0.42,0.58),\n  gp =  gpar(lwd = 1)\n)\n\ntexto &lt;- textGrob(\n  label = c(\"Lower than start\",\"Higher than start\"),\n  x = c(0.5,0.35),\n  y = c(0.3, 0.75),\n  gp = gpar(lwd = 2, fontsize = 12),\n  )\n\nlegend1 &lt;- gTree(children = gList(circulos, lineas,texto))\ngrid.draw(legend1)\n\n\n\n\n\n\n\n\n\nggplot() +\n  guides(\n    custom = guide_custom(\n    width = unit(5,\"cm\"),\n    height = unit(3,\"cm\"),\n    grob = legend1,\n    order = 1\n  )) + theme(\n    legend.position = \"top\",\n    legend.justification = \"center\",\n    legend.margin = margin(t = -10,b = -20,0,0),\n    plot.margin = margin(t = 10,10,10,10)\n  )\n\n\n\n\n\n\n\n\n\nrect1 &lt;- roundrectGrob(\n  r= unit(0.5, \"snpc\"),\n  x = 0.10,\n  y = 0.5,\n  width = 0.2,\n  height =  0.065,\n  gp = gpar(lty = 0, fill = \"#b4d6f0\")\n)\n\nrect2 &lt;- roundrectGrob(\n  r = unit(0.5, \"snpc\"),\n  x = 0.325,\n  y = 0.5,\n  width = 0.25,\n  height =  0.065,\n  gp = gpar(lty = 0, fill = \"#76bbe8\")\n)\n\nrect3 &lt;- roundrectGrob(\n  r = unit(0.5, \"snpc\"),\n  x = 0.575,\n  y = 0.5,\n  width = 0.25,\n  height = 0.065,\n  gp = gpar(lty = 0, fill = \"#2598dd\")\n)\n\nrect4 &lt;- roundrectGrob(\n  r = unit(0.5, \"snpc\"),\n  x = 0.825,\n  y = 0.5,\n  width = 0.25,\n  height = 0.065,\n  gp = gpar(lty = 0, fill = \"#673c8e\")\n)\n\npoint1 &lt;- circleGrob(\n  r = 0.05,\n  x = c(0.02,0.2,0.45,0.70),\n  y = c(0.5,0.5,0.5,0.5,0.5),\n  gp = gpar(lty = 0, fill = c(\"#b2d9f9\",\"#559dd7\",\"#1d70c9\",\"#09217a\"))\n)\n\nstick1 &lt;- segmentsGrob(\n  x0 =c(0.02,0.2,0.45,0.70),\n  x1 = c(0.02,0.2,0.45,0.70),\n  y0 = c(0.65,0.42,0.65,0.42),\n  y1 = c(0.58,0.35,0.58,0.35),\n  gp =  gpar(lwd = 2)\n)\n\nlabel1 &lt;- textGrob(\n  label = c(\"Baby\\nBoomers\",\"Gen X\", \"Milenials\", \"Gen Z\"),\n  x = c(0.02,0.2,0.45,0.70),\n  y = c(0.8,0.3, 0.75, 0.3),\n  gp = gpar(lwd = 2, fontsize = 12, lineheight = 0.7))\n\ncircle1 &lt;- circleGrob(\n  r = 0.080,\n  x = c(0.02,0.2,0.45,0.70),\n  y = c(0.5,0.5,0.5,0.5),\n  gp = gpar(lty = 1, fill = NA)\n)\n\nlegend2 &lt;- gTree(children = gList(rect1, rect2, rect3,rect4,\n                                 point1,stick1,label1,circle1))\ngrid.draw(legend2)\n\n\n\n\n\n\n\n\n\nggplot() +\n  guides(\n    custom = guide_custom(\n    width = unit(5,\"cm\"),\n    height = unit(3,\"cm\"),\n    grob = legend2,\n    order = 1\n  )) + theme(\n    legend.position = \"top\",\n    legend.justification = \"center\",\n    legend.margin = margin(t = -10,b = -20,0,0),\n    plot.margin = margin(t = 10,10,10,10)\n  )\n\n\n\n\n\n\n\n\n\n\nCódigo\ndf1 &lt;- tibble::tribble(\n                             ~fecha,                 ~valor,\n               1975.99610136452,    30.306338028169,\n               1976.77582846004,   31.4007042253521,\n               1978.49122807018,   31.9478873239437,\n               1978.72514619883,   33.2767605633803,\n               1979.19298245614,   34.3711267605634,\n                 1979.738791423,   36.0908450704225,\n               1980.36257309942,   37.1070422535211,\n               1981.37621832359,   36.0908450704225,\n               1982.31189083821,   35.7,\n               1983.63742690058,   36.4035211267606,\n                1984.5730994152,   37.2633802816901,\n               1985.27485380117,   38.9049295774648,\n               1985.82066276803,   40.0774647887324,\n                1986.6783625731,   42.7352112676056,\n               1986.28849902534,   41.3281690140845,\n               1987.30214424951,   44.2204225352113,\n               1987.92592592593,   45.3929577464789,\n               1989.56335282651,   45.9401408450704,\n               1990.49902534113,   47.7380281690141,\n               1989.95321637427,    46.956338028169,\n                1991.2007797271,   49.3014084507042,\n               1991.66861598441,   51.0211267605634,\n               1992.05847953216,   51.9591549295775,\n               1994.24171539961,   54.2260563380282,\n               1994.24171539961,   54.2260563380282,\n               1995.56725146199,   54.8514084507042,\n               1995.56725146199,   54.8514084507042,\n               1996.50292397661,   55.7112676056338,\n               1997.90643274854,   56.2584507042254,\n               1998.99805068226,   56.1,\n               2000.40155945419,   55.7112676056338,\n               2000.40155945419,   55.7112676056338,\n               2001.57115009747,   56.6492957746479,\n               2003.05263157895,   56.3366197183098,\n               2004.06627680312,   55.9457746478873,\n               2004.06627680312,   55.9457746478873,\n                2005.3918128655,   56.8056338028169,\n               2006.48343079922,   56.0239436619718,\n               2006.48343079922,   56.0239436619718,\n               2007.34113060429,   57.1964788732394,\n               2008.19883040936,    58.369014084507,\n               2009.21247563353,   58.9943661971831,\n               2010.77192982456,   59.0725352112676,\n               2011.86354775828,   58.1345070422535,\n               2012.56530214425,   56.9,\n               2013.34502923977,   56.4147887323944,\n               2013.34502923977,   56.4147887323944,\n               2014.82651072125,    57.430985915493,\n               2016.85380116959,   56.8056338028169,\n               2016.85380116959,   56.8056338028169,\n               2018.02339181287,   55.5549295774648,\n               2018.49122807018,   54.3042253521127,\n               2018.80311890838,   53.1316901408451,\n               2018.80311890838,   53.1316901408451,\n               2019.19298245614,    52.506338028169,\n               2019.19298245614,    52.506338028169,\n               2020.28460038986,    51.880985915493,\n               2020.28460038986,    51.880985915493,\n               2020.75243664717,   50.3957746478873,\n               2020.75243664717,   50.3957746478873,\n               2020.90838206628,   49.2232394366197,\n               2020.90838206628,   49.2232394366197,\n               2021.06432748538,   48.1288732394366,\n               2021.06432748538,   48.1288732394366,\n               2022,   46.8\n             )|&gt; \n  mutate(\n    fecha = round(fecha),\n    fecha = ymd(paste0(fecha,\"-01-01\"))\n  ) |&gt; \n  summarise(\n    valor = round(mean(valor),1),\n    .by = fecha\n  ) |&gt; \n  mutate(\n    pregunta = \"Expect graduate or\\nprofessional degree\"\n  )\n\n\n\n\nCódigo\ndf2 &lt;- tibble::tribble(\n                            ~fecha,                 ~valor,\n              1976.40358744395,   48.1413978494624,\n              1976.83408071749,   49.2682795698925,\n              1977.55156950673,   50.1134408602151,\n              1978.62780269058,   50.6064516129032,\n              1979.20179372197,   51.5924731182796,\n              1979.34529147982,   52.5784946236559,\n              1979.63228699552,   53.6349462365591,\n              1979.99103139013,    54.902688172043,\n              1980.42152466368,   55.8887096774194,\n              1981.13901345291,   55.9591397849462,\n              1982,   56.1,\n               1983.5067264574,   54.1279569892473,\n               1984.7264573991,   53.9870967741935,\n              1985.30044843049,    54.902688172043,\n              1985.87443946188,   56.1704301075269,\n              1986.59192825112,    57.297311827957,\n              1986.87892376682,   58.2129032258065,\n               1987.7399103139,    59.058064516129,\n              1988.60089686099,   59.9736559139785,\n              1989.31838565022,   60.3962365591398,\n              1989.82062780269,   61.7344086021505,\n              1990.25112107623,   62.9317204301075,\n              1991.54260089686,   63.4247311827957,\n              1992.04484304933,   64.9741935483871,\n              1992.83408071749,   65.8193548387097,\n              1993.98206278027,   66.1010752688172,\n              1995.56053811659,    66.241935483871,\n              1996.42152466368,   67.2983870967742,\n              1997.13901345291,   67.8618279569892,\n              1998            ,   69.2,\n              1999.79372197309,    69.763440860215,\n              2000.22421524664,   70.7494623655914,\n              2001.51569506726,   70.4677419354839,\n              2002.66367713004,    69.833870967742,\n              2003.38116591928,    68.636559139785,\n              2004.74439461883,   68.7069892473118,\n              2005.39013452915,    69.763440860215,\n              2006.32286995516,   68.7774193548387,\n              2007.61434977578,   68.9182795698925,\n               2008.2600896861,   68.1435483870968,\n              2009.19282511211,   68.7774193548387,\n              2010.48430493274,   68.3548387096774,\n              2011,   68.4252688172043,\n              2012.           ,   61.1,\n              2013.42600896861,   64.4532258064516,\n              2013.64125560538,   65.3263440860215,\n              2013.78475336323,   64.1994623655914,\n              2013.92825112108,   62.7908602150538,\n              2014.21524663677,   61.3822580645161,\n              2015.43497757848,   61.9456989247312,\n              2016.86995515695,    62.086559139785,\n              2018.37668161435,   62.2274193548387,\n              2019.23766816144,   61.3822580645161,\n              2019.81165919282,    60.255376344086,\n              2020.52914798206,   58.6354838709677,\n              2021.31838565022,   57.0155913978495,\n              2022            ,   52.1\n            ) |&gt; \n  mutate(\n    fecha = round(fecha),\n    fecha = ymd(paste0(fecha,\"-01-01\"))\n  ) |&gt; \n  summarise(\n    valor = round(mean(valor),1),\n    .by = fecha\n  ) |&gt; \n  mutate(\n    pregunta = \"Expect professional job\"\n  )\n\n\n\n\nCódigo\ndf3 &lt;- tibble::tribble(\n                         ~fecha,                 ~valor,\n           1976.04830917874,   47.2409090909091,\n           1977.05314009662,               48.4,\n           1978.21256038647,              49.25,\n           1979.75845410628,   49.0181818181818,\n           1980.45410628019,   51.0272727272727,\n           1981.45410628019,   53.0272727272727,\n           1982,   53.5,\n           1983.46859903382,   55.8954545454545,\n           1984.24154589372,   57.1318181818182,\n           1984.70531400966,   58.2909090909091,\n           1985.71014492754,   58.7545454545455,\n           1986.56038647343,   59.7590909090909,\n           1987.33333333333,   60.9954545454545,\n           1988.49275362319,   61.8454545454545,\n           1989.42028985507,   62.4636363636364,\n           1990.27053140097,   62.9272727272727,\n           1991.42995169082,   63.6227272727273,\n            1992.3574879227,   62.6181818181818,\n            1993.2077294686,   61.3045454545455,\n           1994.21256038647,   60.6863636363636,\n           1995.44927536232,   60.3772727272727,\n           1996.1,   60.6090909090909,\n           1998,   62.0,\n           1999.77777777778,   63.0818181818182,\n           2000.93719806763,   63.6227272727273,\n           2001.86473429952,   62.5409090909091,\n           2002.86956521739,   61.6136363636364,\n           2003.25603864734,   60.3772727272727,\n           2003.71980676329,   59.1409090909091,\n           2005.11111111111,   59.1409090909091,\n           2006.27053140097,   59.2954545454545,\n           2007.42995169082,   58.7545454545455,\n           2008.51207729469,   58.1363636363636,\n            2009,   57.1318181818182,\n            201,   57.1318181818182,\n           2011.1,   56.6681818181818,\n           2012,   59.6,\n           2013.38164251208,   58.7545454545455,\n           2013.45893719807,   59.6045454545455,\n            2014.7729468599,   58.9863636363636,\n           2015.54589371981,   57.9818181818182,\n           2016.55072463768,   56.8227272727273,\n           2017.71014492754,   54.8909090909091,\n           2017.71014492754,   54.8909090909091,\n           2018.48309178744,   53.5772727272727,\n           2019.10144927536,   52.4181818181818,\n           2019.10144927536,   52.4181818181818,\n           2020.02898550725,   52.7272727272727,\n           2020.02898550725,   52.7272727272727,\n            2020.4154589372,   53.8863636363636,\n           2021,   54.6,\n           2022,   54.6\n         )|&gt; \n  mutate(\n    fecha = round(fecha),\n    fecha = ymd(paste0(fecha,\"-01-01\"))\n  ) |&gt; \n  summarise(\n    valor = round(mean(valor),1),\n    .by = fecha\n  ) |&gt; \n  mutate(\n    pregunta = \"Expect own more\\nthan parents\"\n  )\n\n\n\n\nCódigo\nlibrary(tidyverse)\n\n\n\ndf &lt;- bind_rows(df1, df2, df3) |&gt; \n  mutate(\n    generacion = case_when(\n      between(year(fecha),1976,1981) ~ \"Baby\\nBoomers\",\n      between(year(fecha),1982,1998) ~ \"Gen X\",\n      between(year(fecha),1999,2010) ~ \"Milenials\",\n      between(year(fecha),2011,2023) ~ \"Gen Z\",\n      .default = NA_character_\n    )\n  )\n\ndf &lt;- df |&gt; \n  mutate(\n    label = if_else(\n      condition = year(fecha) %in% c(1982, 1998,2011,2022),\n      true = paste0(valor,\"%\"),\n      false = NA\n    ),\n    pregunta = fct_relevel(pregunta,\"Expect own more\\nthan parents\", after = Inf)\n  ) |&gt; \n  mutate(\n    dir_label = if_else(\n      condition = tail(valor,1) - head(valor,1) &lt; 0,\n      true = \"abajo\",\n      false = \"arriba\"\n    ),\n    .by = c(pregunta, generacion)\n  ) \n\n\n\nformat_date &lt;- \\(x){\n  x &lt;- year(x)\n  if_else(x%%1000 != 0,\n          paste0(\"'\",x%%100),\n          as.character(x))\n}\n\n\nggplot(\n  data = df,\n  mapping = aes(\n    x = fecha,\n    y = valor,\n    color = generacion,\n    label = label,\n    group = 1\n  )\n) +\n  labs(\n    title = \"Future outcome expectations among U.S. 12th graders\",\n    y = \"\",\n    x = \"\"\n  ) +\n  geom_line(linewidth = 2.5, lineend = \"round\") +\n  geom_point(\n    data = filter(df, !is.na(label)),\n    mapping = aes(\n      color = stage(\n        start = generacion,\n        after_scale = darken(color, 0.2)\n        )\n    ),\n    size = 2.5\n  ) +\n  geom_point(\n    data = filter(df, !is.na(label)),\n    color = \"black\",\n    fill = NA,\n    shape = 21,\n    size = 5\n  ) +\n  geom_text_repel(\n    direction = \"y\",\n    color = \"black\",\n    nudge_y = if_else(\n      df$dir_label == \"arriba\",\n      true = 8,\n      false = -8\n    ),\n    hjust = 0.5,\n    fontface = \"bold\",\n    size = 4.5,\n    point.padding = 0.7\n  ) +\n  scale_color_manual(\n    values = c(\n      \"Baby\\nBoomers\" = \"#b4d6f0\",\n      \"Gen X\" = \"#76bbe8\",\n      \"Milenials\" = \"#2598dd\",\n      \"Gen Z\" = \"#673c8e\"\n    ),\n    guide = \"none\"\n  ) +\n  scale_y_continuous(\n    breaks = c(25,50,75),\n    expand = expand_scale(mult = c(0.1,0.25)),\n    labels = \\(x) paste0(x,\"%\")\n  ) +\n  scale_x_date(\n    labels = format_date,\n    minor_breaks = ymd(\"1976-01-01\") + years(0:45),\n    guide = \"axis_minor\",\n    expand = expand_scale(mult = c(0.05,0.1))\n  ) +\n  facet_wrap(~pregunta)+\n  guides(\n    custom2 = guide_custom(\n      width = unit(4,\"cm\"),\n      height = unit(3,\"cm\"),\n      grob = legend1,\n      order = 2\n    ),\n    custom = guide_custom(\n    width = unit(5,\"cm\"),\n    height = unit(3,\"cm\"),\n    grob = legend2,\n    order = 1\n  )) +\n  theme_minimal(base_size = 16)+\n  theme(\n    legend.position = \"top\",\n    legend.justification = \"center\",\n    legend.margin = margin(t = -5, b = -30,0),\n    plot.margin = margin(10,10,10,10),\n    plot.title = element_text(\n      face = \"bold\",\n      hjust = 0.45,\n      size = 16,\n      margin = margin(b = 15, t = 10)\n      ),\n    strip.text = element_text(\n      size = 16,\n      margin = margin(b = 5, t = 15)),\n    panel.grid.major.x = element_blank(),\n    panel.grid.minor.x = element_blank(),\n    panel.grid.minor.y = element_blank(),\n    axis.ticks.x = element_line(),\n    axis.ticks.length = unit(5,\"pt\"),\n    ggh4x.axis.ticks.length.minor = rel(0.5)\n  )\n\n\n\n\n\nReutilizaciónEste blog libera su contenido bajo la Licencia Creative Commons CC0, permitiendo a los usuarios copiar, modificar, distribuir y utilizar  todo el trabajo, ya sea para propósitos comerciales o no, sin necesidad de pedir permiso o proporcionar atribución al autor.\n(Ver Licencia)Derechos de autorCopyright Aprende Tidyverse. 2024. Todos los derechos reservados."
  },
  {
    "objectID": "posts/003_30_days_chart_challenge_d1.html",
    "href": "posts/003_30_days_chart_challenge_d1.html",
    "title": "30 days chart challenge 1/30",
    "section": "",
    "text": "Hola a todos!! una pequeña advertencia: este documento aún está en construcción. Puedes intentar utilizarlo, pero ten en cuenta que algunas cosas aún podrían no funcionar bien. Recomiendo esperar a la versión final.\n\n\n\n\nlibrary(tidyverse)\n\n── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──\n✔ dplyr     1.1.4     ✔ readr     2.1.5\n✔ forcats   1.0.0     ✔ stringr   1.5.1\n✔ ggplot2   3.5.0     ✔ tibble    3.2.1\n✔ lubridate 1.9.3     ✔ tidyr     1.3.1\n✔ purrr     1.0.2     \n── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n✖ dplyr::filter() masks stats::filter()\n✖ dplyr::lag()    masks stats::lag()\nℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors\n\nlibrary(rvest)\n\n\nAttaching package: 'rvest'\n\nThe following object is masked from 'package:readr':\n\n    guess_encoding\n\nlibrary(janitor)\n\n\nAttaching package: 'janitor'\n\nThe following objects are masked from 'package:stats':\n\n    chisq.test, fisher.test\n\nlibrary(waffle)\nlibrary(glue)\nlibrary(ggtext)\n\n\ndf &lt;- tibble::tribble(\n  ~\"provincia\", ~\"url\",\n  \"San José\", \"https://www.tse.go.cr/juris/relevantes/1658-E11-2024.html\",\n  \"Alajuela\", \"https://www.tse.go.cr/juris/relevantes/2156-E11-2024.html\",\n  \"Cartago\", \"https://www.tse.go.cr/juris/relevantes/2157-E11-2024.html\",\n  \"Heredia\", \"https://www.tse.go.cr/juris/relevantes/2158-E11-2024.html\",\n  \"Guanacaste\", \"https://www.tse.go.cr/juris/relevantes/2159-E11-2024.html\",\n  \"Puntarenas\", \"https://www.tse.go.cr/juris/relevantes/2160-E11-2024.html\",\n  \"Limón\", \"https://www.tse.go.cr/juris/relevantes/2161-E11-2024.html\"\n  )\n\n\nresultados &lt;- map(transpose(df), \\(x){\n  read_html(x$url) |&gt; \n  html_table(na.strings = \"-\", trim = TRUE, header = TRUE) |&gt; \n  map(\\(x){\n    x |&gt; \n      pivot_longer(\n        cols = -`PARTIDO POLÍTICO`,\n        names_to = \"canton\",\n        values_to = \"votos\",\n        ) |&gt; \n      clean_names() |&gt; \n      mutate(\n        votos = parse_number(votos, locale = locale(grouping_mark = \" \")),\n        canton = str_to_title(canton),\n        partido_politico = str_squish(partido_politico),\n        partido_politico = str_to_title(partido_politico)\n      ) |&gt; \n      filter(\n        partido_politico != \"Total Votos Válidos\"\n      ) |&gt; \n      drop_na() |&gt; \n      select(canton, partido_politico, votos)\n  }) |&gt; \n    list_rbind() |&gt; \n    add_column(\n      provincia = x$provincia,\n      .before = 1\n    )\n}) |&gt; \n  list_rbind()\n\n\ndf_plot &lt;- resultados |&gt; \n  mutate(\n    p = votos/sum(votos),\n    .by = c(canton)\n  ) |&gt; \n  filter(\n    canton == \"San José\"\n  ) |&gt; \n  mutate(\n    n = round(p*100),\n    color = \"partido\",\n    partido_politico = str_wrap(partido_politico, 15),\n    partido_politico = str_replace(partido_politico, \"\\\\n\",\"&lt;br&gt;\"),\n    partido_politico = fct_lump_lowfreq(\n      partido_politico,\n      w = votos,\n      other_level = \"Otros\"\n    ),\n    partido_politico = glue(\"&lt;b&gt;{partido_politico}&lt;/b&gt; ({n}%)\"),\n    partido_politico = fct_reorder(partido_politico, votos, .desc = TRUE)\n  )|&gt; \n  group_by(canton, partido_politico) |&gt; \n  group_modify(~ add_row(.x, n = 100-.x$n, color = \"todos\"))\n\n\nggplot(\n  data = df_plot, \n  aes(fill = color, values = n)\n) +\n  geom_waffle(\n    color = \"white\", \n    size = .8, \n    n_rows = 10,\n    flip = TRUE\n  ) +\n  facet_wrap(~partido_politico) +\n  scale_fill_manual(\n    values = c(\n      \"partido\" = \"#FFCC70\",\n      \"todos\" = \"#E3E1D9\"\n    ),\n    labels = c(\"Votos del partido\",\"Total de votos\")\n  ) +\n  labs(\n    title = \"Resultados electorales municipales\",\n    subtitle = \"Porcentaje de votos por partido político para el cantón\\nde San José, Costa Rica, 2024.\",\n    fill = \"\",\n    caption = \"Fuente: Tribunal Supremo de Elecciones\") +\n  coord_equal() +\n  theme_void() +\n  theme(\n    plot.title = element_text(\n      size = 18,\n      face = \"bold\",\n      family = \"Roboto\"\n    ), \n    legend.text = element_text(size = 16),\n    legend.box.margin = margin(b = 10),\n    plot.subtitle = element_text(\n      size = 16\n    ),\n    strip.text = element_markdown(\n      hjust = 0,\n      margin = margin(l = 5),\n      size = 12,\n      vjust = 0\n    ),\n    legend.position = \"top\",\n    legend.justification = \"left\",\n    legend.margin = margin(t = 20),\n    plot.margin = margin(5,b = 10,5,5)\n  )\n\n\n\n\n\n\n\n\n\nggsave(\"plot_elecciones_d1.jpg\", dpi = 400, width = 8.51, height = 11.3)\n\n\n\n\nReutilizaciónEste blog libera su contenido bajo la Licencia Creative Commons CC0, permitiendo a los usuarios copiar, modificar, distribuir y utilizar  todo el trabajo, ya sea para propósitos comerciales o no, sin necesidad de pedir permiso o proporcionar atribución al autor.\n(Ver Licencia)Derechos de autorCopyright Aprende Tidyverse. 2024. Todos los derechos reservados."
  },
  {
    "objectID": "posts.html",
    "href": "posts.html",
    "title": "Aprende Tidyverse",
    "section": "",
    "text": "La comunidad de usuarios de R me ha permitido conectar con personas interesantes de todo el mundo, algo que valoro enormemente. Si tienes una idea de proyecto, especialmente si está relacionado con datos de Costa Rica, me encantaría ayudarte en lo que sea posible.\nPara charlar o preguntar, escríbeme a carlos.aguero@aprendetidyverse.com. También puedes encontrarme en LinkedIn o en Twitter (sí, sé que ahora se llama X, pero me resisto a cambiarle el nombre; simplemente no me gusta). ¡Espero tu mensaje!"
  },
  {
    "objectID": "posts.html#ponte-en-contacto",
    "href": "posts.html#ponte-en-contacto",
    "title": "Aprende Tidyverse",
    "section": "",
    "text": "La comunidad de usuarios de R me ha permitido conectar con personas interesantes de todo el mundo, algo que valoro enormemente. Si tienes una idea de proyecto, especialmente si está relacionado con datos de Costa Rica, me encantaría ayudarte en lo que sea posible.\nPara charlar o preguntar, escríbeme a carlos.aguero@aprendetidyverse.com. También puedes encontrarme en LinkedIn o en Twitter (sí, sé que ahora se llama X, pero me resisto a cambiarle el nombre; simplemente no me gusta). ¡Espero tu mensaje!"
  },
  {
    "objectID": "posts.html#post-recientes",
    "href": "posts.html#post-recientes",
    "title": "Aprende Tidyverse",
    "section": "Post Recientes",
    "text": "Post Recientes"
  },
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "Aprende Tidyverse",
    "section": "",
    "text": "Aprende Tidyverse es una iniciativa que busca contribuir a la comunidad hispanohablante de usuarios de R, ofreciendo de forma gratuita cursos, tutoriales, guías paso a paso y todo lo que se nos ocurra por el camino. ¿Lo mejor? Aprendemos juntos y, ¿por qué no?, nos divertimos en el proceso."
  },
  {
    "objectID": "index.html#curso-r-para-ciencia-de-datos",
    "href": "index.html#curso-r-para-ciencia-de-datos",
    "title": "Aprende Tidyverse",
    "section": "Curso R para ciencia de datos",
    "text": "Curso R para ciencia de datos\nPuedes inscribirte por un precio desde los $0 USD hasta los $120 USD. Nuestro instructor y asistentes están listos para guiarte en tu proceso de aprendizaje. Simplemente completa el formulario de inscripción y recibirás en tu correo electrónico toda la información necesaria para comenzar la sesión.\n\nPróxima apertura: jueves 23 de mayo del 2024\n\nLecciones: jueves y sábados\nCosta Rica/México: 6:00 p.m.\nColombia: 7:00 p.m.\nArgentina: 9:00 p.m.\n\n\nDescuentos de hasta el 75% para estudiantes y académicos. Si tu situación económica o restricciones de tu país no te permiten hacer un pago en línea por el curso, siéntete en total libertad de llevarlo totalmente gratis.\nVer los detalles del curso"
  },
  {
    "objectID": "index.html#ponte-en-contacto",
    "href": "index.html#ponte-en-contacto",
    "title": "Aprende Tidyverse",
    "section": "Ponte en contacto",
    "text": "Ponte en contacto\nLa comunidad de usuarios de R me ha permitido conectar con personas interesantes de todo el mundo, algo que valoro enormemente. Si tienes una idea de proyecto, especialmente si está relacionado con datos de Costa Rica, me encantaría ayudarte en lo que sea posible.\nPara charlar o preguntar, escríbeme a carlos.aguero@aprendetidyverse.com. También puedes encontrarme en LinkedIn o en Twitter (sí, sé que ahora se llama X, pero me resisto a cambiarle el nombre; simplemente no me gusta). ¡Espero tu mensaje!"
  },
  {
    "objectID": "index.html#post-recientes",
    "href": "index.html#post-recientes",
    "title": "Aprende Tidyverse",
    "section": "Post Recientes",
    "text": "Post Recientes"
  },
  {
    "objectID": "courses/index.html",
    "href": "courses/index.html",
    "title": "Curso: R para ciencia de datos",
    "section": "",
    "text": "Queremos iniciar con una premisa fundamental: cualquiera que te prometa convertirte en un experto en R o en cualquier lenguaje de programación en tan solo unos meses o semanas, simplemente no está siendo sincero. Dominar una herramienta tan poderosa como R no es una tarea que se pueda tomar a la ligera; no hay atajos, solamente práctica, práctica y más práctica.\nNuestro objetivo es claro: transformarte de un principiante absoluto en un practicante competente que comprenda los principios básicos del lenguaje R y pueda aplicar estos conocimientos a problemas del mundo real. Más que memorizar comandos o seguir tutoriales de manera mecánica, te enseñaremos a pensar como un programador, a enfrentarte a los desafíos de manera analítica y a desarrollar soluciones efectivas.\nEl curso tiene una duración de 6 semanas cada semana ofrecemos dos clase en vivo con una duración de aproximadamente 2 horas (quedará grabada por si no puedes asistir a la lección). Después de cada clase, los estudiantes se autoevalúan resolviendo una serie de ejercicios interactivos cortos, y en caso de tener dudas, pueden asistir a sesión de práctica grupales en donde junto con el instructor se resuelven dudas y ejercicios para verificar que están comprendiendo el material y aclarar dudas. El curso es 100% online y puedes verlo en vivo o en diferido."
  },
  {
    "objectID": "courses/index.html#cómo-inscribirme",
    "href": "courses/index.html#cómo-inscribirme",
    "title": "Curso: R para ciencia de datos",
    "section": "¿Cómo inscribirme?",
    "text": "¿Cómo inscribirme?\nPuedes inscribirte por un precio desde los $0 USD hasta los $120 USD. Nuestro instructor y asistentes están listos para guiarte en tu proceso de aprendizaje. Simplemente completa el formulario de inscripción y recibirás en tu correo electrónico toda la información necesaria para comenzar la sesión.\n\nPróxima apertura: jueves 23 de mayo del 2024\n\nLecciones: jueves y sábados\nCosta Rica/México: 6:00 p.m.\nColombia: 7:00 p.m.\nArgentina: 9:00 p.m.\n\n\nDescuentos de hasta el 75% para estudiantes y académicos. Si tu situación económica o restricciones de tu país no te permiten hacer un pago en línea por el curso, siéntete en total libertad de llevarlo totalmente gratis.\nInscribirte ahora"
  },
  {
    "objectID": "courses/index.html#conoce-al-instructor",
    "href": "courses/index.html#conoce-al-instructor",
    "title": "Curso: R para ciencia de datos",
    "section": "Conoce al instructor",
    "text": "Conoce al instructor\nMi nombre es Carlos Agüero B, desde el 2016, me dedico a enseñar a profesionales, en su mayoría no programadores, cómo analizar datos utilizando el lenguaje R.\nHe tenido la increíble oportunidad de formarme como instructor certificado por RStudio para la enseñanza de Tidyverse y Shiny y, recientemente, unirme la comunidad de instructores de The Carpentries. En estos 8 años de experiencia, he impartido más de 70 cursos relacionados con el lenguaje R a más de 600 estudiantes a lo largo de toda América Latina."
  },
  {
    "objectID": "courses/index.html#comentarios-de-otros-estudintes",
    "href": "courses/index.html#comentarios-de-otros-estudintes",
    "title": "Curso: R para ciencia de datos",
    "section": "Comentarios de otros estudintes",
    "text": "Comentarios de otros estudintes\n\n\n\n\nPuedes leer los comentarios originales y otros más en mi perfil de linkedin"
  },
  {
    "objectID": "courses/index.html#preguntas-frecuentes-faq",
    "href": "courses/index.html#preguntas-frecuentes-faq",
    "title": "Curso: R para ciencia de datos",
    "section": "Preguntas Frecuentes (FAQ)",
    "text": "Preguntas Frecuentes (FAQ)\nSi tienes dudas puedes escribir a carlos.aguero@aprendetidyverse.com o programar una 🎥 Reunión en Zoom de 15 minutos para resolver dudas y revisar temas de interés. ¡Asegura que el curso cumpla con tus expectativas!\n\n\n¿Debo tener conocimientos de R para llevar el curso?\n\nEs recomendable tener una mínima experiencia en el lenguaje. Si no la tienes, no te preocupes, puedes empezar aquí y tanto el instructor como los asistentes harán lo posible por ayudarte a ponerte al día. No será fácil, pero nos comprometemos a estar disponibles para apoyarte en este proceso.\n\n\n\n¿Qué pasa si debo abandonar el curso?\n\nEntendemos que pueden surgir imprevistos. No te preocupes, puedes dejar el curso en cualquier momento y retomarlo en la siguiente apertura.\n\n\n\n¿Qué temas puedo preguntar en las sesiones con el instructor?\n\nLos temas en las sesiones de seguimiento deben estar relacionados estrictamente con el contenido del curso. Si deseas revisar temas de tu trabajo o algún proyecto universitario, este no sería el espacio adecuado. Sin embargo, puedes escribir a carlos.aguero@aprendetidyverse.com y con gusto veremos cómo podemos ayudarte."
  },
  {
    "objectID": "courses/index.html#contenido-del-curso",
    "href": "courses/index.html#contenido-del-curso",
    "title": "Curso: R para ciencia de datos",
    "section": "Contenido del curso",
    "text": "Contenido del curso\n\n\nClase 1: Descubriendo R y el Tidyverse\n\nEsta clase te introduce a R y el conjunto de herramientas del Tidyverse. Aquí aprenderás a configurar tu espacio de trabajo en RStudio, cómo leer archivos .csv y empezarás a jugar con tus datos, dándoles un primer vistazo y creando visualizaciones sencillas.\n\n\n\nClase 2: Comenzamos a explorar los datos\n\nEn esta clase, te adentrarás en el corazón de dplyr y tidyr, donde la magia de la manipulación de datos realmente sucede. Aprenderás a filtrar, seleccionar, y transformar tus datos para revelar las historias ocultas que tienen para contar.\n\n\n\nClase 3: Inicia en la visualización de Datos\n\nAquí, vas a llevar tus habilidades de visualización al siguiente nivel, usando ggplot2 para crear tus primeros gráfico. Aprenderás sobre escalas, facetas, y cómo personalizar tus gráficos para que destaquen y se adapte a tus necesidades.\n\n\n\nClase 4: Lectura y limpieza de datos\n\nEsta clase te enseñará a ser capaz de leer datos almacenados en CSV, Excel, SPSS, entre otros. Ya sea que estés trabajando con texto, números, fechas, o cualquier otro tipo, aprenderás las habilidades para manejarlos todos con eficiencia.\n\n\n\nClase 5: El arte de trabajar con textos y fechas\n\nLas expresiones regulares y el manejo de fechas pueden parecer hechizos complicados, pero después de esta clase, serán herramientas poderosas en tu arsenal. Aprenderás a limpiar y filtrar tus datos de manera eficiente con los paquetes stringr y lubridate convirtiendo el caos en orden con solo unas pocas líneas de código.\n\n\n\nClase 6: Entendiendo los datos relacionales\n\nEn esta clase te enseña a unir diferentes conjuntos de datos para descubrir conexiones ocultas. Dominarás los joins y aprenderás sobre las llaves y las relaciones, lo que te permitirá combinar datos de fuentes diversas para obtener insights más profundos.\n\n\n\nClase 7: Explorando con gráficos avanzados\n\nCon ggplot2 y plotly, esta clase aprenderás a crear gráficos interactivos y explorar datos geoespaciales, llevando tus habilidades narrativas a nuevas dimensiones.\n\n\n\nClase 8: Conecta R con el mundo las bases de datos SQL\n\nAquí, R se encuentra con el poder de las bases de datos SQL. Aprenderás a realizar consultas SQL directamente desde R, lo que te permite acceder a y manipular grandes conjuntos de datos almacenados en bases de datos de manera eficiente.\n\n\n\nClase 9: La Elegancia de la programación funcional\n\nCon purrr, transformarás tu enfoque de manejar datos. Aprenderás a escribir funciones personalizadas y a iterar sobre tus datos de formas que hacen que el código no solo sea más limpio, sino también más expresivo.\n\n\n\nClase 10: Extrayendo datos de la web\n\nEl web scraping y las APIs abren un universo de datos disponibles en internet. Esta clase te equipará con las herramientas para recoger estos datos como rvest y httr2, permitiéndote responder preguntas que antes parecían inalcanzables.\n\n\n\nClase 11: Creando documento con quarto\n\nCon Quarto, aprenderás a combinar tu análisis con narrativas en reportes dinámicos, haciendo que tus hallazgos no solo sean comprensibles, sino también atractivos para tu audiencia. Es la habilidad de contar una historia cautivadora, donde los datos son los personajes principales.\n\n\n\nClase 12: Administrando tus proyectos en RStudio\n\nFinalmente, dominarás el arte de gestionar proyectos de datos con Git, GitHub, y entornos virtuales renv. Esto te asegura que tus proyectos sean reproducibles, colaborativos, y organizados.\n\nAprovecha esta oportunidad única para sumergirte en el mundo de la ciencia de datos con R. Inscríbete ahora y paga un precio justo, acorde a tus posibilidades, desde $120 USD hasta $0.\nInscribirte ahora"
  },
  {
    "objectID": "courses/index.html#ponte-en-contacto",
    "href": "courses/index.html#ponte-en-contacto",
    "title": "Curso: R para ciencia de datos",
    "section": "Ponte en contacto",
    "text": "Ponte en contacto\nLa comunidad de usuarios de R me ha permitido conectar con personas interesantes de todo el mundo, algo que valoro enormemente. Si tienes una idea de proyecto, especialmente si está relacionado con datos de Costa Rica, me encantaría ayudarte en lo que sea posible.\nPara charlar o preguntar, escríbeme a carlos.aguero@aprendetidyverse.com. También puedes encontrarme en LinkedIn o en Twitter (sí, sé que ahora se llama X, pero me resisto a cambiarle el nombre; simplemente no me gusta). ¡Espero tu mensaje!"
  },
  {
    "objectID": "lunes_pr.html",
    "href": "lunes_pr.html",
    "title": "¿Estás lidiando con problemas en R?",
    "section": "",
    "text": "“Los Forjadores” de Gustave Courbet, 1853.\n¿Estás lidiando con problemas en R o simplemente tienes dudas que no puedes resolver? ¡Estoy aquí para ayudarte! Todos los lunes a las 7:00 p.m., dedicaré una hora completa para contestar preguntas y brindar asistencia con cualquier desafío que estés enfrentando en R. Esta es tu oportunidad de obtener ayuda personalizada y consejos prácticos para superar esos obstáculos que te impiden avanzar."
  },
  {
    "objectID": "lunes_pr.html#detalles-del-evento",
    "href": "lunes_pr.html#detalles-del-evento",
    "title": "¿Estás lidiando con problemas en R?",
    "section": "Detalles del Evento:",
    "text": "Detalles del Evento:\n\n¿Cuándo? Todos los lunes, de 7:00 p.m. a 8:00 p.m. hora de Costa Rica (UTC-6)\n¿Dónde? Las sesiones se realizan en la plataforma Zoom.\n\nRegístrate gratis"
  },
  {
    "objectID": "posts/001_mapa_cantones_cr.html",
    "href": "posts/001_mapa_cantones_cr.html",
    "title": "Actualizando el mapa de cantones de Costa Rica con R",
    "section": "",
    "text": "A inicios de 2024 en Costa Rica, se realizaron elecciones municipales. Una vez publicados los resultados, tuve la idea de replicar un gráfico sencillo: un mapa con ggplot2 de los cantones de Costa Rica, y pintar en colores el partido político que ha ganado en cada una de las regiones. Para ahorrar tiempo hago una búsqueda rápida en google “shapefile cantones Costa Rica” al descargar los datos y ejecutar mi código, resulta que me hacen falta cantones. Después de un par de segundos de duda, recordé que en los últimos años se han creado nuevos cantones. Río Cuarto1 se separa del cantón de Grecia, Monteverde2 de Puntarenas, y uno para mi muy sonado, ya que está muy cerca de donde vivo, Puerto Jiménez3 se separa de Golfito y pasa a ser un cantón.\nSi a esto le sumamos que algunos cantones han cambiado de nombre, Alfaro Ruiz ahora es conocido como Zarcero4, Valverde Vega se ha transformado en Sarchí5, y Aguirre ha pasado a llamarse Quepos6. En este punto, algo que creí serían 10 líneas de código, un problema de copiar y pegar, se convertía en algo más interesante. Así que en esta guia veremos cómo realizar un gráfico actualizado de los cantones de Costa Rica, utilizando como fuente de datos los servicios del Instituto Geográfico Nacional."
  },
  {
    "objectID": "posts/001_mapa_cantones_cr.html#obtener-datos-actualizados-del-ign",
    "href": "posts/001_mapa_cantones_cr.html#obtener-datos-actualizados-del-ign",
    "title": "Actualizando el mapa de cantones de Costa Rica con R",
    "section": "Obtener datos actualizados del IGN",
    "text": "Obtener datos actualizados del IGN\n\nAnte de comenzar\nVerifica que tengas instalados los siguientes paquetes:\n\nlibrary(tidyverse)\nlibrary(sf)\nlibrary(httr2)\nlibrary(ows4R)\nlibrary(rmapshaper)\nlibrary(janitor)\n\n\n\n\n\n\n\nSi en Windows tienes errores al instalar alguno de los paquetes, quizás falte instalar Rtools. Descárgalo de este enlace y reinicia antes de intentar de nuevo.\n\n\n\n\n\nDescargar datos del IGN\nEl Instituto Geográfico Nacional es la principal fuente de cartografía en Costa Rica, ofreciendo datos geoespaciales actualizados. Para obtener un shapefile específico para nuestro mapa, recurriremos al servicio WFS en R, enfocándonos en la división cantonal.\n\nPaso 1: Acceder al IGN\n\nVisita la página de servicios OGC del IGN. En la sección de nodos locales, selecciona el servicio IGN Cartografía 1:5mil CO.\n\n\nPaso 2: Identificar la URL del Servicio WFS\n\nA continuación, localizaremos la URL del servicio WFS que utilizaremos, tal como se muestra en la imagen adjunta.\n\n\nPaso 3: Identificar las capas disponibles\n\nMediante el uso del paquete ows4R en R, consultaremos los identificadores de las capas disponibles. Esto nos permitirá seleccionar y descargar la capa adecuada, ya sea a nivel de provincia, cantón o distrito.\n\nurl_wfs &lt;- \"https://geos.snitcr.go.cr/be/IGN_5_CO/wfs?\"\n\n\nbwk_client &lt;- WFSClient$new(\n  url = url_wfs,\n  serviceVersion = \"2.0.0\"\n)\n\nas_tibble(bwk_client$getFeatureTypes(pretty = TRUE))\n\n# A tibble: 4 × 2\n  name                         title                                            \n  &lt;chr&gt;                        &lt;chr&gt;                                            \n1 IGN_5_CO:curvas_5000_2017    Curvas de nivel cada 10 metros 1:5.000 año 2017 …\n2 IGN_5_CO:limitedistrital_5k  DTA (Límite Distrital)                           \n3 IGN_5_CO:limitecantonal_5k   Límite Cantonal                                  \n4 IGN_5_CO:limiteprovincial_5k Límite Provincial                                \n\n\n\n\nEl código para usar servicios WFS proviene del post “Spatial WFS Services” por Thierry Onkelinx, Hans Van Calster, y Floris Vanderhaeghe. Leer más\n\nAdaptamos funciones para migrar a httr2 desde httr. Consulta httr2 para detalles.\n\nPaso 4: Descargar los datos\n\nPara descargar los cantones de Costa Rica, utilizaremos la capa denominada IGN_5_CO:limitecantonal_5k.\n\nurl &lt;- url_parse(url_wfs)\nurl$query &lt;- list(\n  service = \"wfs\",\n  request = \"GetFeature\",\n  typename = \"IGN_5_CO:limitecantonal_5k\",\n  srsName = \"EPSG:4326\"\n  )\nrequest &lt;- url_build(url) \n\nregiones &lt;- read_sf(request) |&gt; \n  select(\n    \"CÓDIGO_DE_PROVINCIA\",\n    \"PROVINCIA\",\"CÓDIGO_CANTÓN\",\"CANTÓN\"\n  )\nst_crs(regiones) &lt;- st_crs(4326)\n\n\n\nUn agradecimiento a Manuel Eduardo Saavedra Núñez, quien, con un comentario en Facebook, nos hizo ver que el resultado de read_sf(request) contiene nombres de columnas duplicados. Por lo tanto, nos quedaremos desde el inicio solamente con las columnas que nos interesan.\nAhora, revisemos lo descargado: encontramos nombres de cantones, sus provincias correspondientes y SHAPE, el polígono que representa a cada cantón en el mapa.\n\nglimpse(regiones)\n\nRows: 84\nColumns: 5\n$ CÓDIGO_DE_PROVINCIA &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,…\n$ PROVINCIA           &lt;chr&gt; \"San José\", \"San José\", \"San José\", \"San José\", \"S…\n$ CÓDIGO_CANTÓN       &lt;int&gt; 101, 102, 103, 104, 105, 106, 107, 108, 109, 110, …\n$ CANTÓN              &lt;chr&gt; \"San José\", \"Escazú\", \"Desamparados\", \"Puriscal\", …\n$ SHAPE               &lt;MULTIPOLYGON [°]&gt; MULTIPOLYGON (((-84.17302 9..., MULTI…\n\n\n\nx &lt;- object.size(regiones)\nprint(x, units = \"auto\")\n\n20.3 Mb\n\n\nAl mirar el peso del objeto regiones, notamos que es considerablemente grande. Esto se debe a que, para asegurar una cartografía precisa del país, el IGN emplea una precisión mucho mayor de la necesaria para la mayoría de los mapas que crearemos con ggplot2.\nPara concluir este paso, crearemos un mapa con el paquete ggplot2, usando específicamente la geometría geom_sf().\n\nggplot(\n  data = regiones\n) +\n  geom_sf(color = \"white\", fill = \"#365486\") +\n  theme_minimal()\n\n\n\n\n\n\n\n\n\nPaso 5: Simplificar el mapa\n\nDado que el mapa está formado por polígonos, podemos simplificar estos polígonos eliminando lados. Esto reduce la precisión, pero a la escala de un mapa común creado con ggplot2, será imperceptible. Sin embargo, lograremos reducir considerablemente el tamaño del objeto, facilitando el trabajo en equipos con recursos limitados.\n\nregiones_simplificadas &lt;- ms_simplify(\n  input = regiones,\n  keep = 0.05,\n  keep_shapes = FALSE\n)\n\n# eliminar la isla del coco\nregiones_simplificadas &lt;- ms_filter_islands(\n  input = regiones_simplificadas,\n  min_area = 24000000\n)\n\n\nx &lt;- object.size(regiones_simplificadas)\nprint(x, units = \"auto\")\n\n1.3 Mb\n\n\n\nPaso 6: Guardar los datos localmente\n\nCon los datos ya listos, procederemos a guardarlos localmente. Aunque es posible usar el formato shapefile o GeoJSON, en este caso optaremos por GeoJSON.\n\n\nRecomiendo la lectura del post “Limitaciones e inconvenientes del shapefile” Leer más. ¡Gracias, Roberto, por tu excelente contenido!\n\nwrite_sf(\n  obj = regiones_simplificadas, dsn = \"cantones_cr.geojson\")\n\n\nPaso 7: Leer archivos GeoJSON\n\nSi después de un tiempo deseamos utilizar nuevamente los datos, podemos leerlos fácilmente con la función st_read() de la librería sf.\n\ncantones &lt;- st_read(\"cantones_cr.geojson\", quiet = TRUE)\n\n\nggplot(\n  data = cantones\n) +\n  geom_sf(color = \"white\", fill = \"#365486\") +\n  theme_minimal()"
  },
  {
    "objectID": "posts/001_mapa_cantones_cr.html#graficar-resultados-de-las-elecciones-municipales-2024",
    "href": "posts/001_mapa_cantones_cr.html#graficar-resultados-de-las-elecciones-municipales-2024",
    "title": "Actualizando el mapa de cantones de Costa Rica con R",
    "section": "Graficar resultados de las elecciones municipales 2024",
    "text": "Graficar resultados de las elecciones municipales 2024\nAhora que contamos con el “lienzo” para dibujar nuestros datos, agregaremos al mapa los resultados electorales del pasado 4 de febrero. Lo primero será leer los datos almacenados en formato GeoJSON, seleccionando únicamente las columnas que nos interesan: provincia, canton y geometry.\n\ncantones &lt;- st_read(\n  dsn = \"cantones_cr.geojson\",\n  quiet = TRUE\n  ) |&gt; \n  clean_names()\n\n\nglimpse(cantones)\n\nRows: 84\nColumns: 5\n$ codigo_de_provincia &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,…\n$ canton              &lt;chr&gt; \"San José\", \"Escazú\", \"Desamparados\", \"Puriscal\", …\n$ provincia           &lt;chr&gt; \"San José\", \"San José\", \"San José\", \"San José\", \"S…\n$ codigo_canton       &lt;int&gt; 101, 102, 103, 104, 105, 106, 107, 108, 109, 110, …\n$ geometry            &lt;MULTIPOLYGON [°]&gt; MULTIPOLYGON (((-84.15569 9..., MULTI…\n\n\n\ncantones &lt;- cantones |&gt; \n  select(\n    provincia, canton\n  )\n\nglimpse(cantones)\n\nRows: 84\nColumns: 3\n$ provincia &lt;chr&gt; \"San José\", \"San José\", \"San José\", \"San José\", \"San José\", …\n$ canton    &lt;chr&gt; \"San José\", \"Escazú\", \"Desamparados\", \"Puriscal\", \"Tarrazú\",…\n$ geometry  &lt;MULTIPOLYGON [°]&gt; MULTIPOLYGON (((-84.15569 9..., MULTIPOLYGON ((…\n\n\nAhora vamos a leer los datos de los resultados electorales, enfocándonos en seleccionar solamente el nombre del cantón y el partido ganador en ese cantón. Afortunadamente, en Costa Rica los nombres de provincias y cantones son únicos y pueden servir como identificadores, una ventaja que no se extiende a los distritos.\n\nresultados_tse &lt;- read_csv(\n  file = \"elecciones_municipales_2024.csv\",\n  show_col_types = FALSE\n  ) |&gt; \n  clean_names() |&gt; \n  select(canton, ganador)\nglimpse(resultados_tse)\n\nRows: 84\nColumns: 2\n$ canton  &lt;chr&gt; \"San José\", \"Escazú\", \"Desamparados\", \"Puriscal\", \"Tarrazú\", \"…\n$ ganador &lt;chr&gt; \"Juntos San José\", \"PNG\", \"PLN\", \"PLN\", \"PUSC\", \"PLN\", \"PLP\", …\n\n\nRealizamos la unión de ambas tablas usando el nombre del cantón como clave y presentamos los resultados con ggplot2.\n\nmapa &lt;- left_join(\n  x = cantones,\n  y = resultados_tse,\n  by = join_by(canton == canton)\n)\n\nglimpse(mapa)\n\nRows: 84\nColumns: 4\n$ provincia &lt;chr&gt; \"San José\", \"San José\", \"San José\", \"San José\", \"San José\", …\n$ canton    &lt;chr&gt; \"San José\", \"Escazú\", \"Desamparados\", \"Puriscal\", \"Tarrazú\",…\n$ ganador   &lt;chr&gt; \"Juntos San José\", \"PNG\", \"PLN\", \"PLN\", \"PUSC\", \"PLN\", \"PLP\"…\n$ geometry  &lt;MULTIPOLYGON [°]&gt; MULTIPOLYGON (((-84.15569 9..., MULTIPOLYGON ((…\n\n\n\nggplot(\n  data = mapa,\n  mapping = aes(\n    fill = ganador\n  )\n) +\n  geom_sf(color = \"white\") +\n  theme_minimal()\n\n\n\n\n\n\n\n\nBuen intento, pero vemos un par de problemas: demasiadas etiquetas, colores muy similares y ese NA, ¿de dónde salió? Comencemos por ese NA; hagamos un filtro para ver cuál de los cantones tiene como ganador NA.\n\nmapa |&gt; \n  filter(is.na(ganador))\n\nSimple feature collection with 1 feature and 3 fields\nGeometry type: MULTIPOLYGON\nDimension:     XY\nBounding box:  xmin: -84.15433 ymin: 9.636876 xmax: -83.97105 ymax: 9.75103\nGeodetic CRS:  WGS 84\n  provincia             canton ganador                       geometry\n1  San José León Cortés Castro    &lt;NA&gt; MULTIPOLYGON (((-83.98673 9...\n\n\nVemos que es el cantón León Cortés Castro; en la gran mayoría de las ocasiones, esto se produce por dos razones: no hay datos para el cantón o en ambas tablas se usan nombres diferentes para el mismo cantón. Ya que estas son elecciones nacionales y participan todos los cantones, descartamos la primera opción, así que vamos a ver cómo aparece el nombre de León Cortés Castro en la tabla de resultados.\n\nresultados_tse |&gt; \n  filter(str_detect(canton, \"León\"))\n\n# A tibble: 1 × 2\n  canton      ganador      \n  &lt;chr&gt;       &lt;chr&gt;        \n1 León Cortés Frente Amplio\n\n\nVemos que en la tabla de resultados se utiliza la forma “León Cortés”, una forma muy común de referirse al lugar pero no su nombre oficial. En este caso, modificaremos el nombre del cantón.\n\nresultados_tse &lt;- resultados_tse |&gt; \n  mutate(\n    canton = if_else(\n      canton == \"León Cortés\",\n      \"León Cortés Castro\",\n      canton\n    )\n  )\n\n\nmapa &lt;- left_join(\n  x = cantones,\n  y = resultados_tse,\n  by = join_by(canton == canton)\n)\n\nAhora repetimos el gráfico y vemos que ya no tenemos valores ausentes.\n\nggplot(\n  data = mapa,\n  mapping = aes(\n    fill = ganador\n  )\n) +\n  geom_sf(color = \"white\") +\n  theme_minimal()\n\n\n\n\n\n\n\n\nPara términos del ejemplo, vamos a simplificar la cantidad de partidos políticos agrupando como “Otros” aquellos que no tengan como mínimo 5 alcaldías a nivel nacional.\n\nmapa &lt;- mapa |&gt;\n  mutate(\n    ganador = fct_lump_min(ganador, min = 5,\n                           other_level = \"Otros\")\n  )\n\n\nlibrary(ggokabeito)\n\nggplot(\n  data = mapa,\n  mapping = aes(\n    fill = ganador\n  )\n) +\n  geom_sf(color = \"white\", linewidth = 0.5) +\n  scale_fill_okabe_ito() +\n  theme_minimal() +\n  theme(\n    legend.position = \"bottom\"\n  )\n\n\n\n\n\n\n\n\nListo, fueron muchos más pasos de los que creí inicialmente, pero espero que este ejemplo te pueda servir como referencia para mantener tus mapas actualizados. Resumen rápido:\n\nSe crean nuevos cantones.\nLos cantones cambian de nombre.\nEs preferible usar fuentes oficiales del estado y no de sitios web de terceros.\nSe debe tener cuidado con las faltas de ortografía o cambios de nombres al unir las tablas."
  },
  {
    "objectID": "posts/001_mapa_cantones_cr.html#obeservaciones-finales",
    "href": "posts/001_mapa_cantones_cr.html#obeservaciones-finales",
    "title": "Actualizando el mapa de cantones de Costa Rica con R",
    "section": "Obeservaciones finales",
    "text": "Obeservaciones finales\nYa terminado este post, me puse a pensar que realmente no tengo ningún criterio formado sobre el tema de los nuevos cantones. ¿Es bueno para la administración del país? Pues no tengo idea. Me dejé a mí mismo de tarea leer más sobre el tema y creo que todos los residentes del país deberíamos tomar un par de minutos para pensarlo.\nLaura Fernández Delgado, ministra de planificación nacional y política económica, en un oficio a los diputados 20 de febrero de 2024, dice:\n\nLas decisiones que tome la Asamblea Legislativa de creación de cantonatos pueden derivar en problemas de coordinación, de articulación y fragmentación del territorio; y adicionalmente, en ausencia de estudios técnicos y económicos pueden repercutir en una afectación a los ciudadanos habitantes de esos territorios derivada de la incapacidad para la prestación de los servicios públicos municipales por ausencia de sostenibilidad financiera, entre otros de estos nuevos cantones. 7\n\nJusto el día anterior 19 de febrero del 2024, en primer debate se aprobó el expediente 22643 para la creación del cantón Colorado8 en Guanacaste y existen 6 proyectos de ley vigentes para crear nuevos cantones.\n\nExpediente 24.062: Creación del Cantón de Cervantes, Cantón IX de la Provincia de Cartago.\nExpediente 23.406: Creación del Cantón XVII de la Provincia de Alajuela, Peñas Blancas.\nExpediente 23.403: Creación del Cantón Jicaral, Cantón XIV de la Provincia de Puntarenas.\nExpediente 23.109: Creación del Cantón Cóbano.\nExpediente 23.055: Creación del Cantón de Paquera, Cantón XIV de la Provincia de Puntarenas.\nExpediente 22.874: Creación del Cantón Ojo de Agua, Cantón XVII de la Provincia de Alajuela.\n\nAsí que menos mal que ya sabemos cómo tener el mapa actualizado, porque si por la fecha se saca el día, lo vamos a tener que hacer con frecuencia en los próximos años.\n\n\n\n\n\n\nEste blog libera su contenido bajo la Licencia Creative Commons CC0, permitiendo a los usuarios copiar, modificar, distribuir y utilizar todo el trabajo, ya sea para propósitos comerciales o no, sin necesidad de pedir permiso o proporcionar atribución al autor."
  },
  {
    "objectID": "posts/001_mapa_cantones_cr.html#footnotes",
    "href": "posts/001_mapa_cantones_cr.html#footnotes",
    "title": "Actualizando el mapa de cantones de Costa Rica con R",
    "section": "Notas",
    "text": "Notas\n\n\nDelfino.cr. (26 de abril de 2018). Expediente 20787: Reforma y Adiciones a la Ley N° 9440, Creación del Cantón XVI Río Cuarto de la Provincia de Alajuela, de 20 de Mayo de 2017. Delfino.cr. Leer más↩︎\nDelfino.cr. (25 de septiembre de 2019). Expediente 21618: Creación del Cantón de Monteverde, Cantón XII de la Provincia de Puntarenas. Delfino.cr. Leer más↩︎\nDelfino.cr. (21 de octubre de 2021). Expediente 22749: Creación del Cantón de Puerto Jiménez, Cantón XIII de la Provincia de Puntarenas. Delfino.cr. Leer más↩︎\nRepública de Costa Rica. (16 de junio de 2010). Ley N° 8808: Declara oficial para efectos administrativos, la aprobación de la División Territorial Administrativa de la República N° 41548-MGP [Cambio de nombre del cantón de Alfaro Ruiz a Zarcero]. La Gaceta, N° 116. Leer más↩︎\nDelfino.cr. (11 de febrero de 2015). Expediente 19469: Cambio de Denominación del Cantón XII, Valverde Vega, de la Provincia de Alajuela, para que en Adelante se Denomine Sarchí. Delfino.cr. Leer más↩︎\nPresidencia de la República de Costa Rica. (11 de febrero de 2015). Cambio de nombre del Cantón VI de la provincia de Puntarenas para que en adelante se denomine Quepos. Recuperado de Leer más↩︎\nSan José, 20 de febrero del 2024 MIDEPLAN-DM-OF-0277-2024 A: Directorio Legislativo, Jefaturas de Fracción, Asamblea Legislativa de Costa Rica Asunto: Opinión de MIDEPLAN sobre el Primer Debate del Proyecto de Ley N°22.643, “Creación del Cantón Colorado, Cantón Duodécimo de la Provincia de Guanacaste”. Disponible en: enlace↩︎\nDelfino.cr. (19 de febrero de 2024). Expediente 22643: Creación del Cantón Colorado, Cantón Duodécimo de la Provincia de Guanacaste. Delfino.cr. Leer más↩︎"
  },
  {
    "objectID": "posts/004_30_days_chart_challenge_d2.html",
    "href": "posts/004_30_days_chart_challenge_d2.html",
    "title": "30 days chart challenge 2/30",
    "section": "",
    "text": "colores &lt;- list(\n  amarillo = \"#FFCC70\",\n  gris = \"#E3E1D9\"\n)\n\n\nlibrary(tidyverse)\nlibrary(janitor)\nlibrary(haven)\nlibrary(glue)\n\n\nfile &lt;- \"datos/DEFU2022PAD.sav\"\ndatos &lt;- read_sav(file)\nfecha = str_extract(basename(file), \"\\\\d+\")\ndatos &lt;- datos |&gt;\n  select(des_causa) |&gt;\n  add_column(fecha = fecha, .before = 1) |&gt;\n  separate_wider_delim(\n    cols = des_causa,\n    delim = \" - \",\n    names = c(\"codigo_cie\", \"descripcion\"),\n    too_many = \"merge\"\n  )\n\n\ndf_plot &lt;- datos |&gt;\n  mutate(\n    causa_muerte = case_when(\n      str_detect(codigo_cie, \"^I[0-5]\") ~ \"Enfermedades\\ndel corazón\",\n      str_detect(codigo_cie, \"^(C|D0[0-4])\") ~ \"Cáncer\",\n      str_detect(codigo_cie, \"^V|^W|^Y\") ~ \"Accidentes\",\n      str_detect(codigo_cie, \"^J(4[0-7]|6[0-6])\") ~ \"Enfermedades\\nrespiratorias\",\n      str_detect(codigo_cie, \"^I6\") ~ \"Derrame cerebral\",\n      str_detect(codigo_cie, \"^G3[0-1]\") ~ \"Alzheimer\",\n      str_detect(codigo_cie, \"^E1[0-4]\") ~ \"Diabetes\",\n      str_detect(codigo_cie, \"^(J09|J1[0-8])\") ~ \"Influenza/neumonía\",\n      str_detect(codigo_cie, \"^N1[7-9]\") ~ \"Enfermedad renal\",\n      str_detect(codigo_cie, \"^X7[0-9]\") ~ \"Suicidio\",\n      TRUE ~ \"Otras causas\\n(836 causas distintas)\"\n   )\n  ) |&gt; \n  count(causa_muerte) |&gt; \n  mutate(\n    p = n/sum(n),\n    causa_muerte = fct_reorder(causa_muerte, n)\n  )\n\n\nlibrary(scales) \n\nggplot(\n  data = df_plot,\n  mapping = aes(\n    y = causa_muerte,\n    x = n,\n    label = comma(n)\n  )\n) +\n  geom_col(\n    fill = \"#A34343\"\n  ) +\n  geom_text(\n    hjust = if_else(df_plot$n &gt; 1500, 1.2,-.08),\n    color = if_else(df_plot$n &gt; 1500, \"white\",\"black\"),\n    size = 14/.pt,\n    fontface = \"bold\"\n  ) +\n  scale_x_continuous(\n    labels = scales::comma_format()\n  ) +\n  labs(\n    y = \"\",\n    x = \"Cantidad de casos\",\n    title = \"Principales Causas de muerte en Costa Rica\",\n    subtitle = \"Cantidad de defunciones por causa de muerte ocurridas e inscritas en el país en 2022.\",\n    caption = str_wrap('Fuente: Instituto Nacional de Estadística y Censos (INEC), Área de Censos y Encuestas, Unidad de Estadísticas Demográficas. \"Costa Rica: Total de defunciones 2022, Defunciones ocurridas e inscritas en el país en 2022\".',100)\n  ) +\n  theme_minimal(base_size = 16, base_family = \"Roboto\") +\n  theme(\n    plot.title = element_text(\n      size = 18,\n      face = \"bold\",\n      family = \"Roboto\"\n    ), \n    legend.text = element_text(size = 16),\n    plot.subtitle = element_text(\n      size = 14\n    ),\n    plot.caption = element_text(\n      hjust = 0\n    )\n  )\n\n\n\n\n\n\n\n\n\nggsave(\"plot_elecciones_d2.jpg\", dpi = 400)\n\n\n\n\nReutilizaciónEste blog libera su contenido bajo la Licencia Creative Commons CC0, permitiendo a los usuarios copiar, modificar, distribuir y utilizar  todo el trabajo, ya sea para propósitos comerciales o no, sin necesidad de pedir permiso o proporcionar atribución al autor.\n(Ver Licencia)Derechos de autorCopyright Aprende Tidyverse. 2024. Todos los derechos reservados."
  }
]